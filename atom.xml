<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>点滴记忆</title>
  
  <subtitle>你知道的越多，你不知道的越多</subtitle>
  <link href="https://blog.quickso.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.quickso.cn/"/>
  <updated>2026-02-06T14:28:39.323Z</updated>
  <id>https://blog.quickso.cn/</id>
  
  <author>
    <name>木子欢儿</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Pritunl-OPENVPN-Docker部署</title>
    <link href="https://blog.quickso.cn/2026/02/06/Pritunl-OPENVPN-Docker%E9%83%A8%E7%BD%B2/"/>
    <id>https://blog.quickso.cn/2026/02/06/Pritunl-OPENVPN-Docker%E9%83%A8%E7%BD%B2/</id>
    <published>2026-02-06T13:52:46.000Z</published>
    <updated>2026-02-06T14:28:39.323Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Pritunl是一款图形化的OpenVPN软件，提供一个友好的图形WebUI界面，对传统OpenVPN服务端与客户端复杂的安装配置流程进行了极大的简化，并且通过图形界面可以进行人员管理、参数配置，给予用户非常大的便捷性，适合openvpn入门配置。</p></blockquote><h3 id="1-安装Docker"><a href="#1-安装Docker" class="headerlink" title="1.安装Docker"></a>1.安装Docker</h3><p><a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn/</a></p><h3 id="2-docker-compose-部署"><a href="#2-docker-compose-部署" class="headerlink" title="2.docker-compose 部署"></a>2.docker-compose 部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> openvpn<br><span class="hljs-built_in">cd</span> openvpn/<br>nano docker-compose.yml<br></code></pre></td></tr></table></figure><p>docker-compose.yml 内容</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile">services:<br>  mongo:<br>    image: mongo:<span class="hljs-number">4.4</span><br>    container_name: pritunl-db<br>    volumes:<br>      - ./mongo_data:/data/db<br><br>  pritunl:<br>    image: goofball222/pritunl<br>    container_name: pritunl-server<br>    privileged: true<br>    depends_on:<br>      - mongo<br>    ports:<br>      - <span class="hljs-string">&quot;8833:443&quot;</span>      <span class="hljs-comment"># 将宿主机的 8833 映射到容器的 Web 端口 443</span><br>      - <span class="hljs-string">&quot;1194:1194/udp&quot;</span> <span class="hljs-comment"># VPN 流量端口</span><br>    environment:<br>      - TZ=Asia/Shanghai<br>    volumes:<br>      - /etc/localtime:/etc/localtime:ro<br>    restart: always<br></code></pre></td></tr></table></figure><h3 id="3-启动与初始化"><a href="#3-启动与初始化" class="headerlink" title="3.启动与初始化"></a>3.启动与初始化</h3><h4 id="第一步：启动容器"><a href="#第一步：启动容器" class="headerlink" title="第一步：启动容器"></a>第一步：启动容器</h4><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker-compose up -d</span><br></code></pre></td></tr></table></figure><h4 id="第二步：获取初始设置-Key"><a href="#第二步：获取初始设置-Key" class="headerlink" title="第二步：获取初始设置 Key"></a>第二步：获取初始设置 Key</h4><p>容器启动后，你需要一个 Setup Key 来关联数据库：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">docker <span class="hljs-built_in">exec</span> pritunl-server pritunl setup-<span class="hljs-built_in">key</span><br></code></pre></td></tr></table></figure><p><strong>复制这串代码</strong>，在浏览器访问 <code>https://你的服务器IP</code>，将其粘贴到初始化界面。</p><h4 id="第三步：获取默认登录凭据"><a href="#第三步：获取默认登录凭据" class="headerlink" title="第三步：获取默认登录凭据"></a>第三步：获取默认登录凭据</h4><p>Pritunl 默认会生成一个随机的用户名和密码：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">docker exec pritunl-<span class="hljs-keyword">server</span> pritunl <span class="hljs-keyword">default</span>-<span class="hljs-keyword">password</span><br></code></pre></td></tr></table></figure><p>登录后，请务必第一时间修改密码并设置正式的 <strong>Web 控制台端口</strong>。</p><blockquote><p>确保你的服务器防火墙允许传入连接到 <code>9443</code> (HTTPS Web UI) 和 <code>1194</code> (OpenVPN) 端口</p></blockquote><h3 id="4-配置"><a href="#4-配置" class="headerlink" title="4.配置"></a>4.配置</h3><p>登录后台后（默认地址 <code>https://你的服务器IP</code>），按照以下逻辑顺序操作：</p><h3 id="1-创建组织-Organization"><a href="#1-创建组织-Organization" class="headerlink" title="1. 创建组织 (Organization)"></a>1. 创建组织 (Organization)</h3><p>Pritunl 以组织为单位管理用户。</p><ul><li>点击 <strong>Users</strong> 标签页。</li><li>点击 <strong>Add Organization</strong>，取个名字（如 <code>Dev_Team</code>）。</li></ul><h3 id="2-添加用户-User"><a href="#2-添加用户-User" class="headerlink" title="2. 添加用户 (User)"></a>2. 添加用户 (User)</h3><p><strong>（避坑）这里的用户其实就是你的设备</strong></p><ul><li>在刚创建的组织右侧点击 <strong>Add User</strong>。</li><li>输入用户名（Name）例如：NAS，Phone，PC。</li><li><strong>PIN 码</strong>（可选）：如果设置了 PIN，用户连接时需要输入该密码。</li></ul><h3 id="3-创建服务器-Server"><a href="#3-创建服务器-Server" class="headerlink" title="3. 创建服务器 (Server)"></a>3. 创建服务器 (Server)</h3><p>这是定义 VPN 协议和网段的地方。</p><ul><li>点击 <strong>Servers</strong> 标签页，点击 <strong>Add Server</strong>。</li><li><strong>Name</strong>: 建议与用途相关（如 <code>OpenVPN</code>）。</li><li><strong>Protocol</strong>: 默认 <code>udp</code>（根据实际情况选择，可选TCP）。</li><li><strong>Port</strong>:  <code>1194</code>（记得在防火墙&#x2F;安全组开放此端口的 UDP 权限）。</li><li><strong>Virtual Network</strong>: 内部虚拟网段（默认 <code>10.1.0.0/24</code> 即可，只要不与你内网冲突）。</li></ul><h3 id="4-关联与启动"><a href="#4-关联与启动" class="headerlink" title="4. 关联与启动"></a>4. 关联与启动</h3><ul><li><strong>Attach Organization</strong>: 在 Server 卡片上点击该按钮，选择你之前创建的组织。</li><li><strong>Start Server</strong>: 点击 <strong>Start Server</strong> 按钮。当状态变绿，VPN 服务就正式运行了。</li></ul><hr><h2 id="第二部分：下载与安装客户端"><a href="#第二部分：下载与安装客户端" class="headerlink" title="第二部分：下载与安装客户端"></a>第二部分：下载与安装客户端</h2><p>Pritunl 官方提供了非常好用的跨平台客户端。</p><h3 id="1-桌面端-Windows-macOS-Linux"><a href="#1-桌面端-Windows-macOS-Linux" class="headerlink" title="1. 桌面端 (Windows &#x2F; macOS &#x2F; Linux)"></a>1. 桌面端 (Windows &#x2F; macOS &#x2F; Linux)</h3><ul><li><strong>下载地址</strong>: <a href="https://client.pritunl.com/">client.pritunl.com</a></li><li><strong>安装</strong>:<ul><li><strong>Windows&#x2F;macOS</strong>: 下载安装包后一路“下一步”即可。</li><li><strong>Linux</strong>: 官网提供了针对 Ubuntu、Debian、Arch 等发行版的仓库配置命令。</li></ul></li></ul><h3 id="2-移动端-iOS-Android"><a href="#2-移动端-iOS-Android" class="headerlink" title="2. 移动端 (iOS &#x2F; Android)"></a>2. 移动端 (iOS &#x2F; Android)</h3><p>Pritunl 官方目前<strong>没有</strong>专门的移动 App，但它完美兼容 <strong>OpenVPN</strong> 协议。</p><ul><li>去应用商店下载：<strong>OpenVPN Connect</strong>。</li></ul><hr><h2 id="第三部分：导入配置并连接"><a href="#第三部分：导入配置并连接" class="headerlink" title="第三部分：导入配置并连接"></a>第三部分：导入配置并连接</h2><h3 id="方式-A：使用-URI-链接（最推荐，最快）"><a href="#方式-A：使用-URI-链接（最推荐，最快）" class="headerlink" title="方式 A：使用 URI 链接（最推荐，最快）"></a>方式 A：使用 URI 链接（最推荐，最快）</h3><ol><li>在 Pritunl 后台 <strong>Users</strong> 页面，找到对应的用户。</li><li>点击用户右侧的 <strong>Links</strong> 图标（类似链接的符号）。</li><li>点击 <strong>Temporary Profile URI</strong> 旁边的复制按钮（该链接 24 小时内有效）。</li><li>打开 Pritunl 客户端，点击右下角的 <strong>Import Profile URI</strong>，粘贴链接，点击 <strong>Import</strong>。</li><li>点击 <strong>Connect</strong>。</li></ol><h3 id="方式-B：下载配置文件-ovpn"><a href="#方式-B：下载配置文件-ovpn" class="headerlink" title="方式 B：下载配置文件 (.ovpn)"></a>方式 B：下载配置文件 (<code>.ovpn</code>)</h3><ol><li>在 <strong>Users</strong> 页面点击用户右侧的下载图标，下载 <code>.tar</code> 压缩包并解压得到 <code>.ovpn</code> 文件。</li><li><strong>桌面端</strong>: 直接将 <code>.ovpn</code> 文件拖入 Pritunl 客户端。</li><li><strong>移动端</strong>: 将 <code>.ovpn</code> 文件发送到手机，用 <strong>OpenVPN Connect</strong> 软件打开。</li></ol><h3 id="Linux客户端部署（Debian为例）"><a href="#Linux客户端部署（Debian为例）" class="headerlink" title="Linux客户端部署（Debian为例）"></a>Linux客户端部署（Debian为例）</h3><h5 id="安装OpenVPN客户端"><a href="#安装OpenVPN客户端" class="headerlink" title="安装OpenVPN客户端"></a>安装OpenVPN客户端</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> openvpn<br></code></pre></td></tr></table></figure><h5 id="下载xxx-ovpn文件到-etc-openvpn-client"><a href="#下载xxx-ovpn文件到-etc-openvpn-client" class="headerlink" title="下载xxx.ovpn文件到  &#x2F;etc&#x2F;openvpn&#x2F;client&#x2F;"></a>下载xxx.ovpn文件到  &#x2F;etc&#x2F;openvpn&#x2F;client&#x2F;</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/openvpn/client/<br>wget https://vpn.xxx.com:8833/xxx/xxx.key --no-check-certificate<br><span class="hljs-built_in">mv</span> xxx.key myvpn.ovpn<br></code></pre></td></tr></table></figure><h5 id="测试一下能否链接"><a href="#测试一下能否链接" class="headerlink" title="测试一下能否链接"></a>测试一下能否链接</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">openvpn --config <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/my</span>vpn.ovpn<br></code></pre></td></tr></table></figure><h5 id="为了开机自启，不用输入密码直接登录，需要下面操作"><a href="#为了开机自启，不用输入密码直接登录，需要下面操作" class="headerlink" title="为了开机自启，不用输入密码直接登录，需要下面操作"></a><strong>为了开机自启，不用输入密码直接登录</strong>，需要下面操作</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span><br></code></pre></td></tr></table></figure><p>编辑密码文件</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">nano <span class="hljs-keyword">pass</span>.txt<br></code></pre></td></tr></table></figure><p>格式</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">用户名<br>pin<br></code></pre></td></tr></table></figure><p>例如</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">NAS</span><br><span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure><p>修改权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 600 pass.txt<br><span class="hljs-built_in">chown</span> root:root pass.txt<br></code></pre></td></tr></table></figure><p>然后修改你的.ovpn文件内容</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">nano <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/my</span>vpn.ovpn<br></code></pre></td></tr></table></figure><p>加上我们刚才添加的密码文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">auth-user-pass <span class="hljs-regexp">/etc/</span>openvpn<span class="hljs-regexp">/client/</span>pass.txt<br></code></pre></td></tr></table></figure><h5 id="Systemctl-开机自启配置文件"><a href="#Systemctl-开机自启配置文件" class="headerlink" title="Systemctl 开机自启配置文件"></a>Systemctl 开机自启配置文件</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo nano <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>openvpn-client.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">Description</span>=OpenVPN Client<br><span class="hljs-attr">After</span>=network.target<br><span class="hljs-attr">Wants</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=simple<br><span class="hljs-attr">ExecStart</span>=/usr/sbin/openvpn --config /etc/openvpn/client/vpn.ovpn<br><span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure<br><span class="hljs-attr">RestartSec</span>=<span class="hljs-number">5</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>重新加载配置并启用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> openvpn-client.service<br><span class="hljs-built_in">sudo</span> systemctl start openvpn-client.service<br><span class="hljs-built_in">sudo</span> systemctl status openvpn-client.service<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过 Docker 部署 Pritunl，你可以在几分钟内搭建起一套支持多用户、多组织的 VPN 系统。Pritunl 的可视化界面能极大降低运维成本。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Pritunl是一款图形化的OpenVPN软件，提供一个友好的图形WebUI界面，对传统OpenVPN服务端与客户端复杂的安装配置流程进行了极大的简化，并且通过图形界面可以进行人员管理、参数配置，给予用户非常大的便捷性，适合openvpn入门配置。</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Docker" scheme="https://blog.quickso.cn/tags/Docker/"/>
    
    <category term="OpenVPN" scheme="https://blog.quickso.cn/tags/OpenVPN/"/>
    
  </entry>
  
  <entry>
    <title>RustFS对象存储Docker部署</title>
    <link href="https://blog.quickso.cn/2025/12/27/RustFS%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8Docker%E9%83%A8%E7%BD%B2/"/>
    <id>https://blog.quickso.cn/2025/12/27/RustFS%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8Docker%E9%83%A8%E7%BD%B2/</id>
    <published>2025-12-27T01:35:12.000Z</published>
    <updated>2026-02-06T13:40:34.768Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RustFS-简介"><a href="#RustFS-简介" class="headerlink" title="RustFS 简介"></a>RustFS 简介</h1><p>RustFS是使用目前全球最流行的、内存安全的Rust语言开发的 <code>高性能</code> ， <code>分布式</code>对象存储软件。RustFS 同时具备简单、高效的特点，也是一种高效、开源、自由、可以进行本地私有云部署的对象存储解决方案。RustFS 100% 兼容 S3 协议，使用 Apache2 许可证发行的开源软件。RustFS 使用目前全世界最受欢迎的、内存安全的语言 Rust 语言编写。 它是由全世界优秀的工程师参与并贡献的一款对于商用友好的分布式对象存储产品，RustFS 可以平替非常多非友好开源协议的对象存储产品。</p><p>官方网站:</p><p><a href="https://rustfs.com.cn/">https://rustfs.com.cn/</a></p><p>官方文档:</p><p><a href="https://docs.rustfs.com.cn/">https://docs.rustfs.com.cn/</a></p><h2 id="一、前置准备"><a href="#一、前置准备" class="headerlink" title="一、前置准备"></a>一、前置准备</h2><p><strong>主机要求</strong></p><ul><li>已安装 Docker（≥ 20.10）并能正常拉取镜像与运行容器</li><li>本地路径 <code>/mnt/rustfs/data</code>（或自定义路径）用于挂载对象数据</li></ul><p><strong>网络与防火墙</strong></p><ul><li>确保宿主机 9000\9001 端口对外开放（或自定义端口一致）</li></ul><h2 id="运行-RustFS-容器"><a href="#运行-RustFS-容器" class="headerlink" title="运行 RustFS 容器"></a>运行 RustFS 容器</h2><p>RustFS SNSD Docker 运行方式，结合上述镜像与配置，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建 data 和 logs 文件夹</span><br><span class="hljs-built_in">mkdir</span> -p /mnt/rustfs &amp;&amp; <span class="hljs-built_in">cd</span> /mnt/rustfs<br><span class="hljs-built_in">mkdir</span> -p data logs<br><br> <span class="hljs-comment"># 修改权限</span><br> <span class="hljs-built_in">chown</span> -R 10001:10001 data logs<br><br> <span class="hljs-comment"># Docker RUN</span><br> docker run -d -p 9000:9000 -p 9001:9001 -v /mnt/rustfs/data:/data -v /mnt/rustfs/logs:/logs rustfs/rustfs:latest<br></code></pre></td></tr></table></figure><p>各参数说明：</p><ul><li><code>-p 9000:9000</code>：映射宿主机 9000 Endpoint端口到容器</li><li><code>-p 9001:9001</code>：映射宿主机 9001 Console端口到容器</li><li><code>-v /mnt/rustfs/data:/data</code>：挂载数据卷</li><li><code>--name rustfs_local</code>：容器自定义名称</li><li><code>-d</code>：后台运行</li></ul><h3 id="完整参数配置示例"><a href="#完整参数配置示例" class="headerlink" title="完整参数配置示例"></a>完整参数配置示例</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livescript">docker run -d <span class="hljs-string">\</span><br>  --name rustfs_container <span class="hljs-string">\</span><br>  -p <span class="hljs-number">9000</span>:<span class="hljs-number">9000</span> <span class="hljs-string">\</span><br>  -p <span class="hljs-number">9001</span>:<span class="hljs-number">9001</span> <span class="hljs-string">\</span><br>  -v /mnt/rustfs/data:/data <span class="hljs-string">\</span><br>  -e RUSTFS_ACCESS_KEY=admin <span class="hljs-string">\</span><br>  -e RUSTFS_SECRET_KEY=修改成你的密码 <span class="hljs-string">\</span><br>  -e RUSTFS_CONSOLE_ENABLE=<span class="hljs-literal">true</span> <span class="hljs-string">\</span><br>  -e RUSTFS_SERVER_DOMAINS=s3.example.com <span class="hljs-string">\</span><br>  rustfs/rustfs:latest <span class="hljs-string">\</span><br>  --address :<span class="hljs-number">9000</span> <span class="hljs-string">\</span><br>  --console-enable <span class="hljs-string">\</span><br>  --server-domains s3.example.com <span class="hljs-string">\</span><br>  --access-key admin <span class="hljs-string">\</span><br>  --secret-key 修改成你的密码 <span class="hljs-string">\</span><br>  /data<br></code></pre></td></tr></table></figure><h4 id="Docker-Compose-配置"><a href="#Docker-Compose-配置" class="headerlink" title="Docker Compose 配置"></a>Docker Compose 配置</h4><p>创建 <code>docker-compose.yml</code> 文件：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">rustfs</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rustfs/rustfs:latest</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">rustfs-server</span><br>    <span class="hljs-attribute">security_opt</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;no-new-privileges:true&quot;</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9000:9000&quot;   # S3 API 对外端口</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;9001:9001&quot;   # 控制台对外端口</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-comment"># 数据卷（多个路径用逗号分隔）</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_VOLUMES=/data/rustfs0</span><br>      <span class="hljs-comment"># API 和控制台监听地址</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_ADDRESS=0.0.0.0:9000</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_CONSOLE_ADDRESS=0.0.0.0:9001</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_CONSOLE_ENABLE=true</span><br>      <span class="hljs-comment"># CORS 设置，控制台与 S3 API 都放开来源</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_CORS_ALLOWED_ORIGINS=*</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_CONSOLE_CORS_ALLOWED_ORIGINS=*</span><br>      <span class="hljs-comment"># 访问密钥（生产环境请修改为强密码）</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_ACCESS_KEY=admin</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_SECRET_KEY=改为你的密码</span><br>      <span class="hljs-comment"># 日志级别</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">RUSTFS_OBS_LOGGER_LEVEL=info</span><br><br>    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-comment"># 存储数据卷（请根据实际情况修改路径）</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./deploy/data/pro:/data</span><br>      <span class="hljs-comment"># 日志目录</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./deploy/logs:/app/logs</span><br><br>    <span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">rustfs-network</span><br>    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attribute">healthcheck</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">test</span><span class="hljs-punctuation">:</span> <span class="hljs-string">[&quot;CMD&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;curl -f http://localhost:9000/health &amp;&amp; curl -f http://localhost:9001/health&quot;]</span><br>      <span class="hljs-attribute">interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attribute">timeout</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attribute">retries</span><span class="hljs-punctuation">:</span> <span class="hljs-string">3</span><br>      <span class="hljs-attribute">start_period</span><span class="hljs-punctuation">:</span> <span class="hljs-string">40s</span><br><br><span class="hljs-attribute">networks</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">rustfs-network</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">bridge</span><br>    <span class="hljs-attribute">ipam</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">config</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">subnet: 172.20.0.0/16</span><br></code></pre></td></tr></table></figure><p>启动服务：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker compose up -d</span><br></code></pre></td></tr></table></figure><p>通过 <code>http://localhost:9000</code> 访问，默认用户名和密码均为 <code>rustfsadmin</code>。</p><h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><ul><li><strong>访问方式</strong>：<ul><li>S3 API 端：<code>https://s3.example.com</code> (端口 9000)</li><li>控制台端：<code>https://console.example.com</code> (端口 9001)</li></ul></li><li><strong>特性</strong>：支持 HTTPS、CORS、健康检查</li></ul><h4 id="Nginx-反向代理配置"><a href="#Nginx-反向代理配置" class="headerlink" title="Nginx 反向代理配置"></a>Nginx 反向代理配置</h4><h5 id="S3-API-端配置"><a href="#S3-API-端配置" class="headerlink" title="S3 API 端配置"></a>S3 API 端配置</h5><p>为 S3 API 创建 Nginx 配置文件（如 <code>/www/server/panel/vhost/nginx/s3.example.com.conf</code>）：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># S3 API 负载均衡配置</span><br>upstream rustfs &#123;<br>    least_conn;<br>    server <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9000</span>;  <span class="hljs-comment"># S3 API 服务端口</span><br>&#125;<br><br><span class="hljs-comment"># HTTP 重定向到 HTTPS</span><br>server &#123;<br>    listen <span class="hljs-number">80</span>;<br>    listen [::]:<span class="hljs-number">80</span>;<br>    server_name s3.example.com;  <span class="hljs-comment"># 替换为你的 S3 API 域名</span><br><br>    return <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span><span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-comment"># HTTPS 主配置</span><br>server &#123;<br>    listen <span class="hljs-number">443</span> ssl;<br>    listen [::]:<span class="hljs-number">443</span> ssl;<br>    http2 on;<br>    server_name s3.example.com;  <span class="hljs-comment"># 替换为你的 S3 API 域名</span><br><br>    <span class="hljs-comment"># SSL 证书配置（请替换为实际证书路径）</span><br>    ssl_certificate     <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>s3.example.com/fullchain.pem;<br>    ssl_certificate_key <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>s3.example.com/privkey.pem;<br>    ssl_protocols       TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>    ssl_ciphers         EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+<span class="hljs-number">3</span>DES:RSA+<span class="hljs-number">3</span>DES:!MD5;<br>    ssl_prefer_server_ciphers on;<br>    ssl_session_cache   shared:SSL:<span class="hljs-number">10</span>m;<br>    ssl_session_timeout <span class="hljs-number">10</span>m;<br>    add_header Strict-Transport-Security <span class="hljs-string">&quot;max-age=31536000&quot;</span>;<br><br>    <span class="hljs-comment"># 反向代理 RustFS S3 API</span><br>    location / &#123;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP         <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        proxy_set_header X-Forwarded-Port  <span class="hljs-variable">$server_port</span>;<br>        proxy_set_header X-Forwarded-Host  <span class="hljs-variable">$host</span>;<br><br>        <span class="hljs-comment"># 关键配置：禁用 HEAD 请求转换，避免 S3 V4 签名失效</span><br>        proxy_cache_convert_head off;<br>        proxy_connect_timeout <span class="hljs-number">300</span>;<br>        proxy_http_version <span class="hljs-number">1.1</span>;<br>        proxy_set_header Connection <span class="hljs-string">&quot;&quot;</span>;<br><br>        proxy_pass http:<span class="hljs-regexp">//</span>rustfs;  <span class="hljs-comment"># 代理到 S3 API</span><br>    &#125;<br><br>    <span class="hljs-comment"># 日志配置（请根据实际情况修改路径）</span><br>    access_log  <span class="hljs-regexp">/www/</span>wwwlogs/s3.example.com.log;<br>    error_log   <span class="hljs-regexp">/www/</span>wwwlogs/s3.example.com.error.log;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="控制台端配置"><a href="#控制台端配置" class="headerlink" title="控制台端配置"></a>控制台端配置</h5><p>为控制台创建 Nginx 配置文件（如 <code>/www/server/panel/vhost/nginx/console.example.com.conf</code>）：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 控制台负载均衡配置</span><br>upstream rustfs-console &#123;<br>    least_conn;<br>    server <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9001</span>;  <span class="hljs-comment"># 控制台服务端口</span><br>&#125;<br><br><span class="hljs-comment"># HTTP 重定向到 HTTPS</span><br>server &#123;<br>    listen <span class="hljs-number">80</span>;<br>    listen [::]:<span class="hljs-number">80</span>;<br>    server_name console.example.com;  <span class="hljs-comment"># 替换为你的控制台域名</span><br><br>    return <span class="hljs-number">301</span> https:<span class="hljs-regexp">//</span><span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-comment"># HTTPS 主配置</span><br>server &#123;<br>    listen <span class="hljs-number">443</span> ssl;<br>    listen [::]:<span class="hljs-number">443</span> ssl;<br>    http2 on;<br>    server_name console.example.com;  <span class="hljs-comment"># 替换为你的控制台域名</span><br><br>    <span class="hljs-comment"># SSL 证书配置（请替换为实际证书路径）</span><br>    ssl_certificate     <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>console.example.com/fullchain.pem;<br>    ssl_certificate_key <span class="hljs-regexp">/www/</span>server<span class="hljs-regexp">/panel/</span>vhost<span class="hljs-regexp">/cert/</span>console.example.com/privkey.pem;<br>    ssl_protocols       TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>    ssl_ciphers         EECDH+CHACHA20:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+<span class="hljs-number">3</span>DES:RSA+<span class="hljs-number">3</span>DES:!MD5;<br>    ssl_prefer_server_ciphers on;<br>    ssl_session_cache   shared:SSL:<span class="hljs-number">10</span>m;<br>    ssl_session_timeout <span class="hljs-number">10</span>m;<br>    add_header Strict-Transport-Security <span class="hljs-string">&quot;max-age=31536000&quot;</span>;<br><br>    <span class="hljs-comment"># 反向代理 RustFS 控制台</span><br>    location / &#123;<br>        proxy_set_header Host <span class="hljs-variable">$host</span>;<br>        proxy_set_header X-Real-IP         <span class="hljs-variable">$remote_addr</span>;<br>        proxy_set_header X-Forwarded-For   <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>        proxy_set_header X-Forwarded-Port  <span class="hljs-variable">$server_port</span>;<br>        proxy_set_header X-Forwarded-Host  <span class="hljs-variable">$host</span>;<br><br>        <span class="hljs-comment"># 禁用 HEAD 请求转换</span><br>        proxy_cache_convert_head off;<br>        proxy_connect_timeout <span class="hljs-number">300</span>;<br>        proxy_http_version <span class="hljs-number">1.1</span>;<br>        proxy_set_header Connection <span class="hljs-string">&quot;&quot;</span>;<br><br>        proxy_pass http:<span class="hljs-regexp">//</span>rustfs-console;  <span class="hljs-comment"># 代理到控制台</span><br>    &#125;<br><br>    <span class="hljs-comment"># 日志配置（请根据实际情况修改路径）</span><br>    access_log  <span class="hljs-regexp">/www/</span>wwwlogs/console.example.com.log;<br>    error_log   <span class="hljs-regexp">/www/</span>wwwlogs/console.example.com.error.log;<br>&#125;<br></code></pre></td></tr></table></figure><p>重载 Nginx 配置：</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">nginx <span class="hljs-punctuation">-</span>t <span class="hljs-meta">&amp;&amp; nginx -s reload</span><br></code></pre></td></tr></table></figure><h2 id="测试S3"><a href="#测试S3" class="headerlink" title="测试S3"></a>测试S3</h2><p>这里使用S3cmd</p><p>S3cmd 是一个用于操作 Amazon S3 和其他兼容 S3 的云存储服务的命令行工具。它提供了广泛的命令，允许用户上传、下载、同步和管理存储在 S3 上的文件。</p><h3 id="使用包管理器安装"><a href="#使用包管理器安装" class="headerlink" title="使用包管理器安装"></a>使用包管理器安装</h3><p>在大多数 Linux 发行版中，您可以使用包管理器来安装 S3cmd。以下是在几种常见 Linux 发行版上安装 S3cmd 的命令。</p><p>对于基于 Debian 的系统（如 Ubuntu），您可以使用 <code>apt-get</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get update<br><span class="hljs-built_in">sudo</span> apt-get install s3cmd<br></code></pre></td></tr></table></figure><p>对于基于 Red Hat 的系统（如 CentOS），您可以使用 <code>yum</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> yum install s3cmd<br></code></pre></td></tr></table></figure><p>对于基于 Arch Linux 的系统，您可以使用 <code>pacman</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> pacman -S s3cmd<br></code></pre></td></tr></table></figure><h2 id="配置-S3cmd"><a href="#配置-S3cmd" class="headerlink" title="配置 S3cmd"></a>配置 S3cmd</h2><p>在安装完 S3cmd 之后，您需要对其进行配置，以便连接到您的 S3 存储服务。配置 S3cmd 涉及设置您的 AWS 访问密钥 ID 和秘密访问密钥，这些是您在 AWS 账户中创建的访问权限凭证。</p><h3 id="运行配置向导"><a href="#运行配置向导" class="headerlink" title="运行配置向导"></a>运行配置向导</h3><p>最简单的方法是运行 S3cmd 的配置向导。在命令行中输入以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd --configure<br></code></pre></td></tr></table></figure><p>该命令将启动一个交互式配置程序，提示您输入所需的配置信息，包括：</p><ul><li>S3 服务端点（写入<code>s3.example.com</code>）</li><li>访问密钥 ID</li><li>秘密访问密钥</li><li>默认存储桶名称</li><li>是否使用 HTTPS</li><li>是否启用服务端加密等</li></ul><p>参考</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs vhdl">root@iv-ydya2ilgcgqc6ilqbabf:~# s3cmd <span class="hljs-comment">--configure</span><br><br>Enter <span class="hljs-keyword">new</span> values <span class="hljs-keyword">or</span> accept defaults <span class="hljs-keyword">in</span> brackets <span class="hljs-keyword">with</span> Enter.<br>Refer <span class="hljs-keyword">to</span> user manual <span class="hljs-keyword">for</span> detailed description <span class="hljs-keyword">of</span> <span class="hljs-keyword">all</span> options.<br><br><span class="hljs-keyword">Access</span> key <span class="hljs-keyword">and</span> Secret key are your identifiers <span class="hljs-keyword">for</span> Amazon S3. Leave them empty <span class="hljs-keyword">for</span> using the env variables.<br><span class="hljs-keyword">Access</span> Key: admin<br>Secret Key: passwd<br><span class="hljs-keyword">Default</span> Region [US]:<br><br><span class="hljs-keyword">Use</span> <span class="hljs-string">&quot;s3.amazonaws.com&quot;</span> <span class="hljs-keyword">for</span> S3 Endpoint <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> modify it <span class="hljs-keyword">to</span> the target Amazon S3.<br>S3 Endpoint [s3.amazonaws.com]: s3.xxx.cn<br><br><span class="hljs-keyword">Use</span> <span class="hljs-string">&quot;%(bucket)s.s3.amazonaws.com&quot;</span> <span class="hljs-keyword">to</span> the target Amazon S3. <span class="hljs-string">&quot;%(bucket)s&quot;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&quot;%(location)s&quot;</span> vars can be used<br><span class="hljs-keyword">if</span> the target S3 system supports dns based buckets.<br>DNS-style bucket+hostname:<span class="hljs-keyword">port</span> template <span class="hljs-keyword">for</span> accessing a bucket [%(bucket)s.s3.amazonaws.com]:<br><br>Encryption password <span class="hljs-keyword">is</span> used <span class="hljs-keyword">to</span> protect your files from reading<br>by unauthorized persons <span class="hljs-keyword">while</span> <span class="hljs-keyword">in</span> transfer <span class="hljs-keyword">to</span> S3<br>Encryption password: passwd<br>Path <span class="hljs-keyword">to</span> GPG program [/usr/bin/gpg]:<br><br><span class="hljs-keyword">When</span> using secure HTTPS protocol <span class="hljs-keyword">all</span> communication <span class="hljs-keyword">with</span> Amazon S3<br>servers <span class="hljs-keyword">is</span> <span class="hljs-keyword">protected</span> from <span class="hljs-number">3</span>rd party eavesdropping. This method <span class="hljs-keyword">is</span><br>slower than plain HTTP, <span class="hljs-keyword">and</span> can only be proxied <span class="hljs-keyword">with</span> Python <span class="hljs-number">2.7</span> <span class="hljs-keyword">or</span> newer<br><span class="hljs-keyword">Use</span> HTTPS protocol [Yes]:<br><br><span class="hljs-keyword">On</span> some networks <span class="hljs-keyword">all</span> internet <span class="hljs-keyword">access</span> must go through a HTTP proxy.<br>Try setting it here <span class="hljs-keyword">if</span> you can<span class="hljs-symbol">&#x27;t</span> connect <span class="hljs-keyword">to</span> S3 directly<br>HTTP Proxy server name:<br><br><span class="hljs-keyword">New</span> settings:<br>  <span class="hljs-keyword">Access</span> Key: admin<br>  Secret Key: passwd<br>  <span class="hljs-keyword">Default</span> Region: US<br>  S3 Endpoint: s3.quickso.cn<br>  DNS-style bucket+hostname:<span class="hljs-keyword">port</span> template <span class="hljs-keyword">for</span> accessing a bucket: %(bucket)s.s3.amazonaws.com<br>  Encryption password: passwd<br>  Path <span class="hljs-keyword">to</span> GPG program: /usr/bin/gpg<br>  <span class="hljs-keyword">Use</span> HTTPS protocol: <span class="hljs-literal">True</span><br>  HTTP Proxy server name:<br>  HTTP Proxy server <span class="hljs-keyword">port</span>: <span class="hljs-number">0</span><br><br>Test <span class="hljs-keyword">access</span> <span class="hljs-keyword">with</span> supplied credentials? [Y/n] y<br>Please <span class="hljs-keyword">wait</span>, attempting <span class="hljs-keyword">to</span> list <span class="hljs-keyword">all</span> buckets...<br>Success. Your <span class="hljs-keyword">access</span> key <span class="hljs-keyword">and</span> secret key worked fine :-)<br><br>Now verifying that encryption works...<br>Success. Encryption <span class="hljs-keyword">and</span> decryption worked fine :-)<br><br>Save settings? [y/N] y<br><span class="hljs-keyword">Configuration</span> saved <span class="hljs-keyword">to</span> &#x27;/root/.s3cfg&#x27;<br>root@iv-ydya2ilgcgqc6ilqbabf:~# s3cmd ls<br><span class="hljs-number">2025</span>-<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">01</span>:<span class="hljs-number">19</span>  s3://test<br><br></code></pre></td></tr></table></figure><p>出于安全考虑，您的配置文件应该只有您自己能够读写。设置适当的文件权限可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 600 ~/.s3cfg<br></code></pre></td></tr></table></figure><p>这样，您就完成了 S3cmd 的基本配置，可以开始使用它来管理您的 S3 存储桶了</p><h2 id="基本命令与操作"><a href="#基本命令与操作" class="headerlink" title="基本命令与操作"></a>基本命令与操作</h2><p>S3cmd 提供了一系列命令，用于执行与 Amazon S3 存储桶相关的各种操作。以下是一些常用的 S3cmd 命令及其基本用法。</p><h3 id="1-列出存储桶"><a href="#1-列出存储桶" class="headerlink" title="1 列出存储桶"></a>1 列出存储桶</h3><p>要列出所有可用的存储桶，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd <span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p>这将显示您有权访问的所有存储桶的列表。</p><h3 id="2-上传文件"><a href="#2-上传文件" class="headerlink" title="2 上传文件"></a>2 上传文件</h3><p>要将文件上传到存储桶，使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd put /path/to/your/file s3://bucket-name/file-name<br></code></pre></td></tr></table></figure><p>请将 <code>/path/to/your/file</code> 替换为您要上传的文件的本地路径，将 <code>bucket-name</code> 替换为您的 S3 存储桶名称，将 <code>file-name</code> 替换为您希望文件在 S3 上保存的名称。</p><h3 id="3-下载文件"><a href="#3-下载文件" class="headerlink" title="3 下载文件"></a>3 下载文件</h3><p>要从存储桶下载文件，使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd get s3://bucket-name/file-name /path/to/your/local/directory<br></code></pre></td></tr></table></figure><p>请将 <code>bucket-name</code> 和 <code>file-name</code> 替换为存储桶名称和文件名称，将 <code>/path/to/your/local/directory</code> 替换为您希望保存下载文件的本地路径。</p><h3 id="4-删除文件"><a href="#4-删除文件" class="headerlink" title="4 删除文件"></a>4 删除文件</h3><p>要删除存储桶中的文件，使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd <span class="hljs-built_in">rm</span> s3://bucket-name/file-name<br></code></pre></td></tr></table></figure><p>请确保在执行此操作之前正确地确认了文件名称，因为此操作是不可逆的。</p><h3 id="5-同步文件"><a href="#5-同步文件" class="headerlink" title="5 同步文件"></a>5 同步文件</h3><p>S3cmd 的同步功能允许您同步本地目录与 S3 存储桶中的内容。以下是如何使用该命令的示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd <span class="hljs-built_in">sync</span> /path/to/your/local/directory s3://bucket-name/<br></code></pre></td></tr></table></figure><p>这个命令会检查本地目录和 S3 存储桶中的文件，并根据需要上传或下载文件以保持同步。</p><h3 id="6-查看文件信息"><a href="#6-查看文件信息" class="headerlink" title="6 查看文件信息"></a>6 查看文件信息</h3><p>要查看存储在 S3 上的文件的元数据，可以使用以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">s3cmd info s3://bucket-name/file-name<br></code></pre></td></tr></table></figure><p>这将显示关于指定文件的信息，包括其大小、存储类、ETag 等。</p><p>通过掌握这些基本命令，您可以开始有效地管理您的 S3 存储桶中的文件。S3cmd 还有更多高级功能，如批量删除、复制对象、设置权限等，可以通过查阅官方文档来了解这些高级用法。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;RustFS-简介&quot;&gt;&lt;a href=&quot;#RustFS-简介&quot; class=&quot;headerlink&quot; title=&quot;RustFS 简介&quot;&gt;&lt;/a&gt;RustFS 简介&lt;/h1&gt;&lt;p&gt;RustFS是使用目前全球最流行的、内存安全的Rust语言开发的 &lt;code&gt;高性能</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="对象存储" scheme="https://blog.quickso.cn/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/"/>
    
    <category term="Docker" scheme="https://blog.quickso.cn/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>Debian12上使用K3s部署Kubernetes集群</title>
    <link href="https://blog.quickso.cn/2025/12/26/Debian12%E4%B8%8A%E4%BD%BF%E7%94%A8K3s%E9%83%A8%E7%BD%B2Kubernetes%E9%9B%86%E7%BE%A4/"/>
    <id>https://blog.quickso.cn/2025/12/26/Debian12%E4%B8%8A%E4%BD%BF%E7%94%A8K3s%E9%83%A8%E7%BD%B2Kubernetes%E9%9B%86%E7%BE%A4/</id>
    <published>2025-12-26T14:15:36.000Z</published>
    <updated>2026-02-06T13:40:34.760Z</updated>
    
    <content type="html"><![CDATA[<p>这里使用两个主机 2h2g 40GB存储</p><p>Master （192.168.10.101），Node0 （192.168.10.103）</p><h2 id="1-准备工作（两台主机均需执行）"><a href="#1-准备工作（两台主机均需执行）" class="headerlink" title="1. 准备工作（两台主机均需执行）"></a>1. 准备工作（两台主机均需执行）</h2><p>在开始之前，确保两台机器可以互相通信，并且防火墙允许必要的流量。</p><ul><li><p><strong>更新系统：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update &amp;&amp; <span class="hljs-built_in">sudo</span> apt upgrade -y<br></code></pre></td></tr></table></figure></li><li><p><strong>停止并禁用防火墙（可选，但建议初学者操作以避免连接问题）：</strong> Debian 默认可能没有启用 <code>ufw</code>，但如果有，请确保开放端口 <code>6443</code>（API Server）和 <code>10250</code>（Kubelet Metrics）。</p></li><li><p><strong>确认主机名：</strong> 建议分别设置主机名为 <code>master</code> 和 <code>node0</code> 方便识别。</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">sudo</span> <span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">master</span>  <span class="hljs-comment"># 在101上执行</span><br><span class="hljs-string">sudo</span> <span class="hljs-string">hostnamectl</span> <span class="hljs-built_in">set-hostname</span> <span class="hljs-string">node0</span>   <span class="hljs-comment"># 在103上执行</span><br></code></pre></td></tr></table></figure></li></ul><hr><h2 id="2-部署-Master-节点-192-168-10-101"><a href="#2-部署-Master-节点-192-168-10-101" class="headerlink" title="2. 部署 Master 节点 (192.168.10.101)"></a>2. 部署 Master 节点 (192.168.10.101)</h2><p>在 Master 节点上，我们将运行安装脚本并将其配置为集群的主控节点。</p><ol><li><p><strong>执行安装命令：</strong></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">curl -sfL https://<span class="hljs-built_in">get</span>.k3s.io | <span class="hljs-keyword">sh</span> -<br><br># 中国用户，可以使用以下方法加速安装：<br><br>curl -sfL https://rancher-mirror.rancher.<span class="hljs-keyword">cn</span>/k3s/k3s-install.<span class="hljs-keyword">sh</span> | INSTALL_K3S_MIRROR=<span class="hljs-keyword">cn</span> <span class="hljs-keyword">sh</span> -<br></code></pre></td></tr></table></figure></li><li><p><strong>获取 Node Token：</strong> 安装完成后，你需要获取一个“令牌”，用于将 Node0 加入集群。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> /var/lib/rancher/k3s/server/node-token<br></code></pre></td></tr></table></figure><p><strong>复制保存这个字符串</strong>，稍后在 Node0 上会用到。</p></li><li><p><strong>检查状态：</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo kubectl <span class="hljs-built_in">get</span> nodes<br></code></pre></td></tr></table></figure><p>此时你应该能看到 <code>master</code> 节点处于 <code>Ready</code> 状态。</p></li></ol><hr><h2 id="3-部署-Node-节点-192-168-10-103"><a href="#3-部署-Node-节点-192-168-10-103" class="headerlink" title="3. 部署 Node 节点 (192.168.10.103)"></a>3. 部署 Node 节点 (192.168.10.103)</h2><p>现在切换到 Node0 主机，将其作为工作节点连接到 Master。</p><ol><li><p><strong>执行安装命令：</strong> 请将下方命令中的 <code>&lt;MASTER_TOKEN&gt;</code> 替换为你刚才在 Master 上获取的字符串。</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">curl -sfL <span class="hljs-keyword">https</span>://<span class="hljs-built_in">get</span>.k3s.io | K3S_URL=<span class="hljs-keyword">https</span>://<span class="hljs-number">192.168</span><span class="hljs-number">.10</span><span class="hljs-number">.101</span>:<span class="hljs-number">6443</span> \<br>K3S_TOKEN=&lt;MASTER_TOKEN&gt; sh -<br></code></pre></td></tr></table></figure></li></ol><hr><h2 id="4-验证集群状态"><a href="#4-验证集群状态" class="headerlink" title="4. 验证集群状态"></a>4. 验证集群状态</h2><p>回到 <strong>Master 节点</strong>，运行以下命令验证 Node0 是否已成功加入：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo kubectl <span class="hljs-built_in">get</span> nodes<br></code></pre></td></tr></table></figure><p><strong>预期输出：</strong></p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">sudo kubectl get nodes<br>NAME     STATUS   ROLES                  AGE   <span class="hljs-keyword">VERSION</span><br><span class="hljs-keyword">master</span>   <span class="hljs-title">Ready</span>    control-plane,<span class="hljs-keyword">master</span>   <span class="hljs-title">32m</span>   v1.<span class="hljs-number">33.6</span>+k3s1<br>node0    Ready    <span class="hljs-tag">&lt;none&gt;</span>                 <span class="hljs-number">30m</span>   v1.<span class="hljs-number">33.6</span>+k3s1<br></code></pre></td></tr></table></figure><h3 id="配置国内镜像"><a href="#配置国内镜像" class="headerlink" title="配置国内镜像"></a>配置国内镜像</h3><p><strong>Master节点</strong></p><p>创建或编辑配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> nano /etc/rancher/k3s/registries.yaml<br></code></pre></td></tr></table></figure><p>填入</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">mirrors</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">docker.io</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">endpoint</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;https://docker.1ms.run&quot;</span><br>  <span class="hljs-attribute">registry.k8s.io</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">endpoint</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;https://k8s.m.daocloud.io&quot;</span><br></code></pre></td></tr></table></figure><p>重启K3s</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart k3s<br></code></pre></td></tr></table></figure><p><strong>Node节点</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mkdir</span> -p /etc/rancher/k3s<br><span class="hljs-built_in">sudo</span> nano /etc/rancher/k3s/registries.yaml<br></code></pre></td></tr></table></figure><p>配置完成</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl restart k3s-agent<br></code></pre></td></tr></table></figure><h3 id="如何卸载K3s"><a href="#如何卸载K3s" class="headerlink" title="如何卸载K3s"></a>如何卸载K3s</h3><p>如果需要重新开始：</p><ul><li><strong>Master:</strong> <code>sudo /usr/local/bin/k3s-uninstall.sh</code></li><li><strong>Node:</strong> <code>sudo /usr/local/bin/k3s-agent-uninstall.sh</code></li></ul><h3 id="部署-Nginx-验证集群"><a href="#部署-Nginx-验证集群" class="headerlink" title="部署 Nginx 验证集群"></a>部署 Nginx 验证集群</h3><p>我们创建一个简单的 Nginx 服务，并使用 K3s 自带的 <code>ServiceLB</code> 让它在 80 端口跑起来。</p><ol><li><p><strong>在 Master 节点上创建配置文件：</strong></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">nano nginx-<span class="hljs-keyword">test</span>.yaml<br></code></pre></td></tr></table></figure></li><li><p><strong>粘贴以下内容：</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-deployment</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">matchLabels:</span><br>      <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span> <span class="hljs-comment"># 会在两个节点上各跑一个</span><br>  <span class="hljs-attr">template:</span><br>    <span class="hljs-attr">metadata:</span><br>      <span class="hljs-attr">labels:</span><br>        <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">spec:</span><br>      <span class="hljs-attr">containers:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">nginx</span><br>        <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:latest</span><br>        <span class="hljs-attr">ports:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">80</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span><br><span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">nginx-service</span><br><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">selector:</span><br>    <span class="hljs-attr">app:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">LoadBalancer</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span><br>      <span class="hljs-attr">port:</span> <span class="hljs-number">80</span><br>      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure></li><li><p><strong>应用配置：</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> kubectl apply -f nginx-test.yaml<br></code></pre></td></tr></table></figure></li><li><p><strong>验证：</strong> 等待几分钟后，访问 <code>http://192.168.10.101</code> 或 <code>192.168.10.103</code>，你应该能看到 Nginx 的欢迎页面。</p></li></ol><h2 id="5-安装管理面板-Portainer"><a href="#5-安装管理面板-Portainer" class="headerlink" title="5.安装管理面板 (Portainer)"></a>5.安装管理面板 (Portainer)</h2><p>对于 K3s 这种轻量级集群，<strong>Portainer</strong> 是最推荐的面板。它比官方 Dashboard 更美观，比 Rancher 更省资源。</p><ol><li><p><strong>创建 Portainer 命名空间：</strong></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">sudo kubectl create <span class="hljs-keyword">namespace</span> <span class="hljs-symbol">portainer</span><br></code></pre></td></tr></table></figure></li><li><p><strong>使用 Helm 或直接使用 Manifest 安装：</strong> 这里我们使用最简单的官方远程脚本安装：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo kubectl apply -n portainer -f https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/portainer/</span>k8s<span class="hljs-regexp">/master/</span>deploy<span class="hljs-regexp">/manifests/</span>portainer/portainer-lb.yaml<br></code></pre></td></tr></table></figure><p><strong>验证与访问</strong></p><ol><li><p><strong>检查 Pod 运行状态：</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> pods -n portainer<br></code></pre></td></tr></table></figure><p>等待状态变为 <code>Running</code>。</p></li><li><p><strong>获取访问端口：</strong> Portainer 默认映射了两个端口：</p><ul><li><strong>HTTP:</strong> <code>30777</code></li><li><strong>HTTPS:</strong> <code>30779</code> (推荐使用)</li></ul></li><li><p><strong>浏览器访问：</strong> 打开浏览器，输入 Master 或 Node 的 IP 地址：</p><ul><li><code>https://192.168.10.101:30779</code></li><li><code>https://192.168.10.103:30779</code></li></ul></li></ol><blockquote><p><strong>注意：</strong> 初次登录需要你在 12 分钟内设置管理员密码，否则出于安全考虑，Portainer 服务会自动停止，届时需要重启 Pod。</p></blockquote></li></ol><h2 id="6-拓展"><a href="#6-拓展" class="headerlink" title="6.拓展"></a>6.拓展</h2><h2 id="kubernetes-常用命令"><a href="#kubernetes-常用命令" class="headerlink" title="kubernetes 常用命令"></a>kubernetes 常用命令</h2><h3 id="1-基础信息查询-Get-Describe"><a href="#1-基础信息查询-Get-Describe" class="headerlink" title="1. 基础信息查询 (Get &amp; Describe)"></a>1. 基础信息查询 (Get &amp; Describe)</h3><p>这些命令用于查看集群资源的运行状态。</p><ul><li><strong>查看资源列表：</strong><ul><li><code>kubectl get nodes</code> (查看节点状态)</li><li><code>kubectl get pods -A</code> (查看所有命名空间的 Pod)</li><li><code>kubectl get svc</code> (查看服务)</li><li><code>kubectl get ns</code> (查看命名空间)</li></ul></li><li><strong>查看详细描述：</strong><ul><li><code>kubectl describe pod &lt;pod-name&gt;</code> (当 Pod 状态异常时，常用此命令查看错误事件)</li></ul></li><li><strong>查看日志：</strong><ul><li><code>kubectl logs &lt;pod-name&gt;</code> (查看容器标准输出日志)</li><li><code>kubectl logs -f &lt;pod-name&gt;</code> (持续跟踪日志)</li></ul></li></ul><hr><h3 id="2-资源创建与修改-Apply-Edit"><a href="#2-资源创建与修改-Apply-Edit" class="headerlink" title="2. 资源创建与修改 (Apply &amp; Edit)"></a>2. 资源创建与修改 (Apply &amp; Edit)</h3><p>K8s 推荐使用“声明式”管理资源。</p><ul><li><strong>通过文件创建&#x2F;更新：</strong><ul><li><code>kubectl apply -f &lt;filename.yaml&gt;</code> (最常用的部署命令)</li></ul></li><li><strong>直接编辑运行中的资源：</strong><ul><li><code>kubectl edit deployment &lt;deployment-name&gt;</code></li></ul></li><li><strong>临时修改镜像：</strong><ul><li><code>kubectl set image deployment/&lt;name&gt; &lt;container-name&gt;=&lt;new-image&gt;:&lt;tag&gt;</code></li></ul></li></ul><hr><h3 id="3-故障排除与调试-Debug"><a href="#3-故障排除与调试-Debug" class="headerlink" title="3. 故障排除与调试 (Debug)"></a>3. 故障排除与调试 (Debug)</h3><p>当应用出现问题时，这些工具能帮你进入内部查看。</p><ul><li><strong>进入 Pod 内部：</strong><ul><li><code>kubectl exec -it &lt;pod-name&gt; -- /bin/bash</code></li></ul></li><li><strong>端口转发：</strong> (将本地端口映射到集群内部)<ul><li><code>kubectl port-forward &lt;pod-name&gt; 8080:80</code></li></ul></li><li><strong>查看资源占用 (需安装 Metrics Server)：</strong><ul><li><code>kubectl top node</code></li><li><code>kubectl top pod</code></li></ul></li></ul><hr><h3 id="4-扩缩容与滚动更新-Scale-Rollout"><a href="#4-扩缩容与滚动更新-Scale-Rollout" class="headerlink" title="4. 扩缩容与滚动更新 (Scale &amp; Rollout)"></a>4. 扩缩容与滚动更新 (Scale &amp; Rollout)</h3><p>管理应用的副本数量和发布版本。</p><ul><li><strong>手动扩缩容：</strong><ul><li><code>kubectl scale deployment &lt;name&gt; --replicas=5</code></li></ul></li><li><strong>查看更新状态：</strong><ul><li><code>kubectl rollout status deployment/&lt;name&gt;</code></li></ul></li><li><strong>版本回滚：</strong><ul><li><code>kubectl rollout undo deployment/&lt;name&gt;</code> (回滚到上一个版本)</li></ul></li></ul><hr><h3 id="5-常用技巧与别名"><a href="#5-常用技巧与别名" class="headerlink" title="5. 常用技巧与别名"></a>5. 常用技巧与别名</h3><p>为了提高效率，建议在你的终端配置文件（如 <code>.bashrc</code> 或 <code>.zshrc</code>）中添加别名：</p><blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">alias</span> k=<span class="hljs-string">&#x27;kubectl&#x27;</span><br></code></pre></td></tr></table></figure></blockquote><p><strong>常用缩写对照表：</strong></p><table><thead><tr><th><strong>全称</strong></th><th><strong>缩写</strong></th></tr></thead><tbody><tr><td><code>pods</code></td><td><code>po</code></td></tr><tr><td><code>nodes</code></td><td><code>no</code></td></tr><tr><td><code>deployments</code></td><td><code>deploy</code></td></tr><tr><td><code>services</code></td><td><code>svc</code></td></tr><tr><td><code>namespaces</code></td><td><code>ns</code></td></tr><tr><td><code>configmaps</code></td><td><code>cm</code></td></tr></tbody></table><hr><p><strong>💡 一个典型的排错流程示例：</strong></p><ol><li><code>kubectl get pods</code> (查看状态是否为 Running)</li><li>如果是 Pending&#x2F;Error，执行 <code>kubectl describe pod &lt;name&gt;</code> (查看 Events 报错)</li><li>如果是 CrashLoopBackOff，执行 <code>kubectl logs &lt;name&gt;</code> (查看程序崩溃原因)</li></ol><h2 id="7-Helm"><a href="#7-Helm" class="headerlink" title="7.Helm"></a>7.Helm</h2><h3 id="1-Helm-是什么？"><a href="#1-Helm-是什么？" class="headerlink" title="1. Helm 是什么？"></a>1. Helm 是什么？</h3><p>在没有 Helm 之前，部署一个复杂的应用（如 WordPress）需要手动编写和维护大量的 YAML 文件（Deployment, Service, Ingress, ConfigMap 等）。</p><p><strong>Helm 的核心价值：</strong></p><ul><li><strong>打包管理：</strong> 将多个 YAML 文件封装成一个名为 <strong>Chart</strong> 的包。</li><li><strong>模板化：</strong> 支持变量（Values），同一个 Chart 可以通过不同的配置部署到开发、测试和生产环境。</li><li><strong>版本控制：</strong> 像 Git 一样，你可以一键升级应用，或者在出问题时一键回滚（Rollback）。</li></ul><hr><h3 id="2-如何安装-Helm"><a href="#2-如何安装-Helm" class="headerlink" title="2. 如何安装 Helm"></a>2. 如何安装 Helm</h3><p>Helm 只是一个二进制客户端工具，安装非常简单。</p><p>通过脚本快速安装：</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">curl</span> -<span class="hljs-string">fsSL</span> -<span class="hljs-string">o</span> <span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span> <span class="hljs-string">https</span>://<span class="hljs-string">raw</span>.<span class="hljs-string">githubusercontent</span>.<span class="hljs-string">com</span>/<span class="hljs-string">helm</span>/<span class="hljs-string">helm</span>/<span class="hljs-string">main</span>/<span class="hljs-string">scripts</span>/<span class="hljs-built_in">get-helm-3</span><br><span class="hljs-string">chmod</span> <span class="hljs-string">700</span> <span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span><br>./<span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>注意：</strong> 安装完成后，运行 <code>helm version</code> 确认是否安装成功。</p></blockquote><hr><h3 id="3-Helm-怎么用？-常用命令"><a href="#3-Helm-怎么用？-常用命令" class="headerlink" title="3. Helm 怎么用？ (常用命令)"></a>3. Helm 怎么用？ (常用命令)</h3><p>使用 Helm 通常遵循：<strong>添加仓库 -&gt; 搜索 -&gt; 安装 -&gt; 管理</strong> 的流程。</p><h4 id="第一步：添加常用的-Chart-仓库"><a href="#第一步：添加常用的-Chart-仓库" class="headerlink" title="第一步：添加常用的 Chart 仓库"></a><strong>第一步：添加常用的 Chart 仓库</strong></h4><p>就像给手机加源一样，最常用的是 Bitnami 仓库。</p><p>Bash</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs vim">helm repo <span class="hljs-built_in">add</span> bitnami https://charts.bitnami.<span class="hljs-keyword">com</span>/bitnami<br>helm repo <span class="hljs-keyword">update</span><br></code></pre></td></tr></table></figure><h4 id="第二步：查找并安装应用"><a href="#第二步：查找并安装应用" class="headerlink" title="第二步：查找并安装应用"></a><strong>第二步：查找并安装应用</strong></h4><p>假设我们要安装一个 Redis：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 搜索 Redis</span><br>helm search repo redis<br><br><span class="hljs-comment"># 安装 Redis (名称定为 my-redis)</span><br>helm install <span class="hljs-keyword">my</span>-redis bitnami/redis<br></code></pre></td></tr></table></figure><h4 id="第三步：管理已安装的应用"><a href="#第三步：管理已安装的应用" class="headerlink" title="第三步：管理已安装的应用"></a><strong>第三步：管理已安装的应用</strong></h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 查看已安装的应用列表</span><br>helm <span class="hljs-built_in">list</span><br><br><span class="hljs-comment"># 查看应用的配置参数</span><br>helm <span class="hljs-keyword">get</span> values <span class="hljs-keyword">my</span>-redis<br><br><span class="hljs-comment"># 升级应用 (比如修改了配置文件后)</span><br>helm upgrade <span class="hljs-keyword">my</span>-redis bitnami/redis -f values.yaml<br><br><span class="hljs-comment"># 一键回滚到上一个版本</span><br>helm rollback <span class="hljs-keyword">my</span>-redis <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 卸载应用</span><br>helm uninstall <span class="hljs-keyword">my</span>-redis<br></code></pre></td></tr></table></figure><hr><p><strong>Q&amp;A</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">出现了下面问题<br>root@master:~# helm install kps prometheus-community/kube-prometheus-stack \<br>  -n monitoring <br>Error: INSTALLATION FAILED: Kubernetes cluster unreachable: <span class="hljs-built_in">stat</span> /root/.kube/config: no such file or directory<br>解决办法<br><span class="hljs-built_in">mkdir</span> -p ~/.kube<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/config<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chown</span> <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> ~/.kube/config<br><span class="hljs-built_in">chmod</span> 600 ~/.kube/config<br><br></code></pre></td></tr></table></figure><h2 id="8-安装-kube-prometheus-stack-监控栈"><a href="#8-安装-kube-prometheus-stack-监控栈" class="headerlink" title="8.安装 kube-prometheus-stack 监控栈"></a>8.安装 kube-prometheus-stack 监控栈</h2><h4 id="1-添加-Helm-仓库"><a href="#1-添加-Helm-仓库" class="headerlink" title="1.添加 Helm 仓库"></a>1.添加 Helm 仓库</h4><p>首先，需要将 Prometheus 社区的 Helm 仓库添加到你的本地 Helm 客户端中。</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">helm</span> repo <span class="hljs-keyword">add</span> prometheus-community https:<span class="hljs-comment">//prometheus-community.github.io/helm-charts</span><br><span class="hljs-symbol">helm</span> repo update<br></code></pre></td></tr></table></figure><h4 id="2-创建命名空间"><a href="#2-创建命名空间" class="headerlink" title="2.创建命名空间"></a>2.创建命名空间</h4><p>为了保持集群整洁，建议为监控组件创建一个独立的 <code>monitoring</code> 命名空间。</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">kubectl create <span class="hljs-keyword">namespace</span> <span class="hljs-symbol">monitoring</span><br></code></pre></td></tr></table></figure><h4 id="3-安装-Helm-Chart"><a href="#3-安装-Helm-Chart" class="headerlink" title="3.安装 Helm Chart"></a>3.安装 Helm Chart</h4><p>使用 Helm 安装监控栈。这里我们将该发布（Release）命名为 <code>kps</code>。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">helm install kps prometheus-community/kube-prometheus-stack -n monitoring<br></code></pre></td></tr></table></figure><h4 id="4-验证-Pod-运行状态"><a href="#4-验证-Pod-运行状态" class="headerlink" title="4.验证 Pod 运行状态"></a>4.验证 Pod 运行状态</h4><p>确认所有组件（Prometheus, Grafana, Alertmanager 等）是否已成功启动。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> pods -n monitoring<br></code></pre></td></tr></table></figure><p><strong>预期输出：</strong> 你会看到类似下方的列表，确保所有 Pod 的状态均为 <code>Running</code> 且 <code>READY</code> 列显示正常（如 2&#x2F;2 或 3&#x2F;3）。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">NAME</span>                                                    READY   STATUS    RESTARTS      AGE<br><span class="hljs-attribute">alertmanager</span>-kps-kube-prometheus-stack-alertmanager-<span class="hljs-number">0</span>   <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">2</span> (<span class="hljs-number">12</span>m ago)   <span class="hljs-number">30</span>m<br><span class="hljs-attribute">kps</span>-grafana-<span class="hljs-number">7</span>c695669f4-mwsbg                            <span class="hljs-number">3</span>/<span class="hljs-number">3</span>     Running   <span class="hljs-number">0</span>             <span class="hljs-number">30</span>m<br><span class="hljs-attribute">kps</span>-kube-prometheus-stack-operator-<span class="hljs-number">7964756</span>cb-mmfbr      <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">1</span> (<span class="hljs-number">12</span>m ago)   <span class="hljs-number">30</span>m<br><span class="hljs-attribute">kps</span>-kube-state-metrics-<span class="hljs-number">96</span>dc6f854-vmwnn                  <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>             <span class="hljs-number">30</span>m<br><span class="hljs-attribute">kps</span>-prometheus-node-exporter-tzqg4                      <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">1</span> (<span class="hljs-number">12</span>m ago)   <span class="hljs-number">30</span>m<br><span class="hljs-attribute">kps</span>-prometheus-node-exporter-ztvnh                      <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>             <span class="hljs-number">30</span>m<br><span class="hljs-attribute">prometheus</span>-kps-kube-prometheus-stack-prometheus-<span class="hljs-number">0</span>       <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     Running   <span class="hljs-number">0</span>             <span class="hljs-number">30</span>m<br></code></pre></td></tr></table></figure><hr><h4 id="5-访问-Grafana-面板"><a href="#5-访问-Grafana-面板" class="headerlink" title="5.访问 Grafana 面板"></a>5.访问 Grafana 面板</h4><p><strong>1. 获取 Grafana 管理员密码</strong> 默认用户名是 <code>admin</code>。运行以下命令获取自动生成的解码密码（提示：默认通常是 <code>prom-operator</code>）：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span><span class="hljs-built_in"> secret </span>--namespace monitoring -l app.kubernetes.io/<span class="hljs-attribute">component</span>=admin-secret -o <span class="hljs-attribute">jsonpath</span>=<span class="hljs-string">&quot;&#123;.items[0].data.admin-password&#125;&quot;</span> | base64 --decode ; echo<br></code></pre></td></tr></table></figure><p><strong>2. 端口转发（Port-forward）</strong> 为了从外部访问集群内部的服务，我们需要映射端口。<strong>（临时访问）</strong></p><blockquote><p><strong>注意：</strong> <code>--address 0.0.0.0</code> 允许你通过服务器的 IP 访问，而不仅仅是 localhost。</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kubectl</span> port-forward --address <span class="hljs-number">0.0.0.0</span> -n monitoring svc/kps-grafana <span class="hljs-number">3000</span>:<span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p><strong>3. 浏览器登录</strong> 访问你的服务器 IP 和端口（例如：<code>http://192.168.122.42:3000</code>）：</p><ul><li><strong>用户名 (Username):</strong> <code>admin</code></li><li><strong>密码 (Password):</strong> 使用上方命令获取到的字符串。</li></ul><h4 id="6-持久化运行"><a href="#6-持久化运行" class="headerlink" title="6.持久化运行"></a>6.持久化运行</h4><p>将 Grafana 服务的类型从 <code>ClusterIP</code> 改为 <code>NodePort</code>，这样你可以通过<strong>集群中任何节点的 IP + 指定端口</strong>直接访问，无需运行任何命令。</p><ol><li><p><strong>修改服务：</strong></p><figure class="highlight scilab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scilab">kubectl patch svc kps-grafana -n monitoring -p <span class="hljs-string">&#x27;&#123;&quot;</span>spec<span class="hljs-string">&quot;: &#123;&quot;</span><span class="hljs-built_in">type</span><span class="hljs-string">&quot;: &quot;</span>NodePort<span class="hljs-string">&quot;&#125;&#125;&#x27;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>获取暴露的端口：</strong></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">kubectl</span> <span class="hljs-meta">get</span> <span class="hljs-keyword">svc</span> -n monitoring kps-grafana<br></code></pre></td></tr></table></figure><p>在输出的 <code>PORT(S)</code> 列中，你会看到类似 <code>80:31234/TCP</code> 的内容。此时，你可以通过 <code>http://&lt;服务器IP&gt;:31234</code> 永久访问。</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这里使用两个主机 2h2g 40GB存储&lt;/p&gt;
&lt;p&gt;Master （192.168.10.101），Node0 （192.168.10.103）&lt;/p&gt;
&lt;h2 id=&quot;1-准备工作（两台主机均需执行）&quot;&gt;&lt;a href=&quot;#1-准备工作（两台主机均需执行）&quot; clas</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Kubernetes" scheme="https://blog.quickso.cn/tags/Kubernetes/"/>
    
    <category term="K3s" scheme="https://blog.quickso.cn/tags/K3s/"/>
    
    <category term="Debian" scheme="https://blog.quickso.cn/tags/Debian/"/>
    
  </entry>
  
  <entry>
    <title>K3s集群以及KubePi安装、配置与使用</title>
    <link href="https://blog.quickso.cn/2025/08/10/K3s%E9%9B%86%E7%BE%A4%E4%BB%A5%E5%8F%8AKubePi%E5%AE%89%E8%A3%85%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>https://blog.quickso.cn/2025/08/10/K3s%E9%9B%86%E7%BE%A4%E4%BB%A5%E5%8F%8AKubePi%E5%AE%89%E8%A3%85%E3%80%81%E9%85%8D%E7%BD%AE%E4%B8%8E%E4%BD%BF%E7%94%A8/</id>
    <published>2025-08-10T02:33:05.000Z</published>
    <updated>2026-02-06T13:40:34.765Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Debian-K3s集群的安装、配置与使用"><a href="#Debian-K3s集群的安装、配置与使用" class="headerlink" title="Debian-K3s集群的安装、配置与使用"></a>Debian-K3s集群的安装、配置与使用</h1><p>K3s 是一个轻量级的 Kubernetes 发行版，旨在简化和优化 Kubernetes 的安装和运行。K3s 使用了简化的架构，使其更适合在资源受限的环境中运行，如边缘设备、物联网（IoT）设备和低功耗硬件。K3s 的架构基于标准的 Kubernetes 组件，但对其进行了精简和优化。</p><p>官方文档：<a href="https://docs.k3s.io/zh/">https://docs.k3s.io/zh/</a></p><p><a href="https://docs.rancher.cn/docs/k3s/_index]">https://docs.rancher.cn/docs/k3s/_index</a></p><h3 id="K3s-集群的典型拓扑"><a href="#K3s-集群的典型拓扑" class="headerlink" title="K3s 集群的典型拓扑"></a>K3s 集群的典型拓扑</h3><ul><li>Server 节点指的是运行 <code>k3s server</code> 命令的主机，control plane 和数据存储组件由 K3s 管理。</li><li>Agent 节点指的是运行 <code>k3s agent</code> 命令的主机，不具有任何数据存储或 control plane 组件。</li><li>Server 和 Agent 都运行 kubelet、容器运行时和 CNI。</li></ul><p><img src="https://docs.k3s.io/zh/assets/images/how-it-works-k3s-revised-9c025ef482404bca2e53a89a0ba7a3c5.svg"></p><h4 id="1-单节点模式"><a href="#1-单节点模式" class="headerlink" title="1. 单节点模式"></a>1. <strong>单节点模式</strong></h4><p>在单节点模式下，<code>k3s server</code> 和 <code>k3s agent</code> 运行在同一台机器上。适用于测试环境或资源非常有限的环境。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[Master Node]</span> (K3s server + agent)<br>  └── K3s API Server<br>  └── K3s Controller Manager<br>  └── K3s Scheduler<br>  └── etcd (默认使用 SQLite)<br>  └── K3s agent (用于运行容器和 Pod)<br></code></pre></td></tr></table></figure><h4 id="2-多节点模式"><a href="#2-多节点模式" class="headerlink" title="2. 多节点模式"></a>2. <strong>多节点模式</strong></h4><p>在多节点模式下，<code>k3s server</code> 可以部署多个实例以提供高可用性，而 <code>k3s agent</code> 部署在多个工作节点上。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-attr">[Master Node 1]</span> (K3s server)<br>  └── K3s API Server<br>  └── K3s Controller Manager<br>  └── K3s Scheduler<br>  └── etcd (或外部 etcd)<br><br><span class="hljs-selector-attr">[Master Node 2]</span> (K3s server)  &lt;- 高可用配置<br>  └── K3s API Server<br>  └── K3s Controller Manager<br>  └── K3s Scheduler<br><br><span class="hljs-selector-attr">[Worker Node 1]</span> (K3s agent)<br>  └── K3s agent<br>  └── 容器运行时<br><br><span class="hljs-selector-attr">[Worker Node 2]</span> (K3s agent)<br>  └── K3s agent<br>  └── 容器运行时<br></code></pre></td></tr></table></figure><p>部署 K3s 单节点模式是非常简单的。以下是安装步骤，涵盖了从安装 K3s 到验证集群是否正常运行的完整过程。</p><h3 id="步骤-1：准备环境"><a href="#步骤-1：准备环境" class="headerlink" title="步骤 1：准备环境"></a>步骤 1：准备环境</h3><p>确保你的机器有互联网连接，并且已经更新了系统。</p><ol><li><strong>更新系统</strong> ：<br>在安装 K3s 之前，先确保系统是最新的：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt upgrade -y<br></code></pre></td></tr></table></figure><p><strong>2.安装Docker</strong></p><p>由于 K3s 默认运行环境为 containerd，所以为了使用 Docker 作为运行时，需要先在各节点正常安装 Docker</p><p><a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn/</a></p><h3 id="步骤-2：安装-K3s"><a href="#步骤-2：安装-K3s" class="headerlink" title="步骤 2：安装 K3s"></a>步骤 2：安装 K3s</h3><p>默认：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">curl -sfL <span class="hljs-keyword">https</span>://<span class="hljs-built_in">get</span>.k3s.io | sh -<br></code></pre></td></tr></table></figure><p>国内：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">curl –sfL \<br>     https://rancher-mirror.rancher.<span class="hljs-keyword">cn</span>/k3s/k3s-install.<span class="hljs-keyword">sh</span> | \<br>     INSTALL_K3S_MIRROR=<span class="hljs-keyword">cn</span> <span class="hljs-keyword">sh</span> -s - \<br>     --<span class="hljs-built_in">system</span>-default-registry <span class="hljs-string">&quot;registry.cn-hangzhou.aliyuncs.com&quot;</span><br></code></pre></td></tr></table></figure><p><strong>要使用 Docker 而不是 containerd</strong></p><p>默认：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">curl -sfL <span class="hljs-keyword">https</span>://<span class="hljs-built_in">get</span>.k3s.io | sh -s - <span class="hljs-comment">--docker</span><br></code></pre></td></tr></table></figure><p>国内：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">curl -sfL https://rancher-mirror.rancher.<span class="hljs-keyword">cn</span>/k3s/k3s-install.<span class="hljs-keyword">sh</span> | INSTALL_K3S_MIRROR=<span class="hljs-keyword">cn</span> <span class="hljs-keyword">sh</span> -s - --docker<br></code></pre></td></tr></table></figure><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><table><thead><tr><th align="left"><strong>类型</strong></th><th align="left"><strong>命令</strong></th><th align="left"><strong>使用方法及示例</strong></th></tr></thead><tbody><tr><td align="left"><strong>集群信息</strong></td><td align="left"><code>kubectl cluster-info</code></td><td align="left">显示集群基本信息 <code>kubectl cluster-info</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl version</code></td><td align="left">查看客户端和服务器版本 <code>kubectl version --short</code></td></tr><tr><td align="left"><strong>节点管理</strong></td><td align="left"><code>kubectl get nodes</code></td><td align="left">查看所有节点状态 <code>kubectl get nodes -o wide</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl describe node &lt;节点名&gt;</code></td><td align="left">查看节点详细信息 <code>kubectl describe node node01</code></td></tr><tr><td align="left"><strong>命名空间</strong></td><td align="left"><code>kubectl get ns</code></td><td align="left">查看所有命名空间 <code>kubectl get ns</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl create ns &lt;命名空间&gt;</code></td><td align="left">创建命名空间 <code>kubectl create ns test</code></td></tr><tr><td align="left"><strong>Pod 管理</strong></td><td align="left"><code>kubectl get pods</code></td><td align="left">查看默认命名空间的 Pod <code>kubectl get pods -n &lt;命名空间&gt;</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl describe pod &lt;Pod名&gt;</code></td><td align="left">查看 Pod 详细信息 <code>kubectl describe pod nginx-pod</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl logs &lt;Pod名&gt;</code></td><td align="left">查看 Pod 日志 <code>kubectl logs nginx-pod -c &lt;容器名&gt;</code> （多容器场景）</td></tr><tr><td align="left"></td><td align="left"><code>kubectl exec -it &lt;Pod名&gt; -- &lt;命令&gt;</code></td><td align="left">进入 Pod 容器 <code>kubectl exec -it nginx-pod -- /bin/sh</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl delete pod &lt;Pod名&gt;</code></td><td align="left">删除 Pod <code>kubectl delete pod nginx-pod --force</code> （强制删除）</td></tr><tr><td align="left"><strong>部署管理</strong></td><td align="left"><code>kubectl get deployments</code></td><td align="left">查看 Deployment <code>kubectl get deploy -A</code> （全命名空间）</td></tr><tr><td align="left"></td><td align="left"><code>kubectl scale deploy &lt;Deployment名&gt; --replicas=&lt;数量&gt;</code></td><td align="left">扩缩容 <code>kubectl scale deploy nginx-deploy --replicas=3</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl rollout status deploy/&lt;Deployment名&gt;</code></td><td align="left">查看滚动更新状态 <code>kubectl rollout status deploy/nginx-deploy</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl rollout undo deploy/&lt;Deployment名&gt;</code></td><td align="left">回滚到上一版本 <code>kubectl rollout undo deploy/nginx-deploy</code></td></tr><tr><td align="left"><strong>服务管理</strong></td><td align="left"><code>kubectl get services</code></td><td align="left">查看 Service <code>kubectl get svc</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl expose deploy &lt;Deployment名&gt; --port=&lt;端口&gt;</code></td><td align="left">创建 Service <code>kubectl expose deploy nginx-deploy --port=80 --type=NodePort</code></td></tr><tr><td align="left"><strong>配置管理</strong></td><td align="left"><code>kubectl get configmaps</code></td><td align="left">查看 ConfigMap <code>kubectl get cm</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl create configmap &lt;名称&gt; --from-file=&lt;文件路径&gt;</code></td><td align="left">从文件创建 ConfigMap <code>kubectl create configmap app-config --from-file=config.properties</code></td></tr><tr><td align="left"><strong>存储管理</strong></td><td align="left"><code>kubectl get pv</code></td><td align="left">查看持久卷（PV） <code>kubectl get pv</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl get pvc</code></td><td align="left">查看持久卷声明（PVC） <code>kubectl get pvc -n default</code></td></tr><tr><td align="left"><strong>调试诊断</strong></td><td align="left"><code>kubectl top pod</code></td><td align="left">查看 Pod 资源使用 <code>kubectl top pod --sort-by=cpu</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl get events --sort-by=.metadata.creationTimestamp</code></td><td align="left">查看事件（按时间排序） <code>kubectl get events -n kube-system</code></td></tr><tr><td align="left"><strong>应用部署</strong></td><td align="left"><code>kubectl apply -f &lt;YAML文件&gt;</code></td><td align="left">通过 YAML 文件部署资源 <code>kubectl apply -f nginx.yaml</code></td></tr><tr><td align="left"></td><td align="left"><code>kubectl delete -f &lt;YAML文件&gt;</code></td><td align="left">删除 YAML 定义的资源 <code>kubectl delete -f nginx.yaml</code></td></tr><tr><td align="left"><strong>标签筛选</strong></td><td align="left"><code>kubectl get pods -l &lt;键&gt;=&lt;值&gt;</code></td><td align="left">按标签筛选资源 <code>kubectl get pods -l app=nginx</code></td></tr><tr><td align="left"><strong>端口转发</strong></td><td align="left"><code>kubectl port-forward &lt;Pod名&gt; &lt;本地端口&gt;:&lt;Pod端口&gt;</code></td><td align="left">端口转发到本地 <code>kubectl port-forward nginx-pod 8080:80</code></td></tr><tr><td align="left"><strong>补丁更新</strong></td><td align="left"><code>kubectl patch deploy &lt;名称&gt; -p &#39;&#123;&quot;spec&quot;: &#123;&quot;template&quot;: &#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;: &#123;&quot;update&quot;: &quot;v2&quot;&#125;&#125;&#125;&#125;&#125;&#39;</code></td><td align="left">热更新 Deployment <code>kubectl patch deploy nginx-deploy -p &#39;&#123;&quot;spec&quot;:&#123;&quot;replicas&quot;:5&#125;&#125;&#39;</code></td></tr></tbody></table><hr><h4 id="配置镜像"><a href="#配置镜像" class="headerlink" title="配置镜像"></a>配置镜像</h4><h5 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#123;&quot;registry-mirrors&quot;: [&quot;https://docker.1ms.run&quot;]&#125;&#x27;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &gt; /dev/null<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><h5 id="K3s"><a href="#K3s" class="headerlink" title="K3s"></a>K3s</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; /etc/rancher/k3s/registries.yaml &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">mirrors:</span><br><span class="hljs-string">  &quot;docker.io&quot;:</span><br><span class="hljs-string">    endpoint:</span><br><span class="hljs-string">      - &quot;https://docker.1ms.run&quot;</span><br><span class="hljs-string">EOF</span><br>systemctl restart k3s<br></code></pre></td></tr></table></figure><p>安装完成后，K3s 会自动启动， 检查K3s服务的状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl status k3s<br></code></pre></td></tr></table></figure><h3 id="工作节点的安装（可选）"><a href="#工作节点的安装（可选）" class="headerlink" title="工作节点的安装（可选）"></a>工作节点的安装（可选）</h3><p>查看 K3S_TOKEN</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cat</span> /var/lib/rancher/k3s/server/node-token<br></code></pre></td></tr></table></figure><h5 id="Agent安装"><a href="#Agent安装" class="headerlink" title="Agent安装"></a>Agent安装</h5><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">root<span class="hljs-keyword">@k</span>3s-agent-<span class="hljs-number">1</span>:~# curl -sfL <span class="hljs-attribute">https</span>://get.k3s.io | K3S_URL=<span class="hljs-attribute">https</span>://MASTER_<span class="hljs-attribute">URL</span>:<span class="hljs-number">6443</span> K3S_TOKEN=NODE_TOKEN sh -<br></code></pre></td></tr></table></figure><p><strong>要使用 Docker 而不是 containerd</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -sfL https:<span class="hljs-regexp">//g</span>et.k3s.io | K3S_URL=https:<span class="hljs-regexp">//</span>MASTER_URL:<span class="hljs-number">6443</span> K3S_TOKEN=NODE_TOKEN INSTALL_K3S_EXEC=<span class="hljs-string">&quot;--docker&quot;</span> sh -<br><span class="hljs-comment"># 或使用国内镜像</span><br>curl -sfL http:<span class="hljs-regexp">//</span>rancher-mirror.cnrancher.com<span class="hljs-regexp">/k3s/</span>k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=https:<span class="hljs-regexp">//</span>MASTER_URL:<span class="hljs-number">6443</span> K3S_TOKEN=NODE_TOKEN INSTALL_K3S_EXEC=<span class="hljs-string">&quot;--docker&quot;</span> sh -<br></code></pre></td></tr></table></figure><p>根据需求把上面的 <code>https://MASTER_URL:6443</code>和 <code>NODE_TOKEN</code>更换成你的即可</p><p><strong>K3s worker 节点的角色默认为<code>none</code>，如何修改？</strong></p><p>可以通过<code>kubectl label node 节点名称 node-role.kubernetes.io/worker=worker</code>为节点增加 worker 角色。</p><h2 id="配套工具"><a href="#配套工具" class="headerlink" title="配套工具"></a>配套工具</h2><h2 id="helm"><a href="#helm" class="headerlink" title="helm"></a>helm</h2><blockquote><p>Helm 是一个 Kubernetes 包管理工具，类似于 Linux 下的 <code>apt</code> 或 <code>yum</code>，它帮助用户管理 Kubernetes 应用的安装、升级和配置。</p><p>helm官网地址：<a href="https://helm.sh/docs/intro/install/">https://helm.sh/docs/intro/install/</a></p></blockquote><p>在上面的文档中找到你的服务器对应系统的安装流程，下面是Ubuntu的安装流程</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">curl</span> -<span class="hljs-string">fsSL</span> -<span class="hljs-string">o</span> <span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span> <span class="hljs-string">https</span>://<span class="hljs-string">raw</span>.<span class="hljs-string">githubusercontent</span>.<span class="hljs-string">com</span>/<span class="hljs-string">helm</span>/<span class="hljs-string">helm</span>/<span class="hljs-string">main</span>/<span class="hljs-string">scripts</span>/<span class="hljs-built_in">get-helm-3</span><br><span class="hljs-string">chmod</span> <span class="hljs-string">700</span> <span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span><br>./<span class="hljs-string">get_helm</span>.<span class="hljs-string">sh</span><br></code></pre></td></tr></table></figure><p>也可以Apt安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /usr/share/keyrings/helm.gpg &gt; /dev/null<br><span class="hljs-built_in">sudo</span> apt-get install apt-transport-https --<span class="hljs-built_in">yes</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main&quot;</span> | <span class="hljs-built_in">sudo</span> <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/helm-stable-debian.list<br><span class="hljs-built_in">sudo</span> apt-get update<br><span class="hljs-built_in">sudo</span> apt-get install helm<br></code></pre></td></tr></table></figure><p>然后复制k3s.yml到~&#x2F;.kube&#x2F;文件夹下即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /etc/rancher/k3s/k3s.yaml ~/.kube/<br></code></pre></td></tr></table></figure><p>测试helm命令：<br><img src="https://cdn.jsdmirror.com/gh/muzihuaner/huancdn//img/xwm7fssuac6j9q4g.png" alt="image.png"></p><h2 id="kubepi"><a href="#kubepi" class="headerlink" title="kubepi"></a>kubepi</h2><ul><li>KubePi 是一个现代化的 K8s 面板。</li><li>KubePi 允许管理员导入多个 Kubernetes 集群，并且通过权限控制，将不同 cluster、namespace 的权限分配给指定用户。它允许开发人员管理 Kubernetes 集群中运行的应用程序并对其进行故障排查，供开发人员更好地处理 Kubernetes 集群中的复杂性。</li></ul><p><a href="https://github.com/1Panel-dev/KubePi">https://github.com/1Panel-dev/KubePi</a></p><p>文档：<a href="https://github.com/1Panel-dev/KubePi/wiki/">https://github.com/1Panel-dev/KubePi/wiki/</a></p><p><strong>安装（持久化部署）</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/1Panel-dev/</span>KubePi<span class="hljs-regexp">/master/</span>docs<span class="hljs-regexp">/deploy/</span>kubectl/kubepi-pvc.yaml<br></code></pre></td></tr></table></figure><p>获取StorageClass</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">kubectl <span class="hljs-built_in">get</span> sc<br></code></pre></td></tr></table></figure><p>修改</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">vim</span> kubepi-pvc.yaml<br></code></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">storageClassName: <span class="hljs-keyword">local</span>-<span class="hljs-built_in">path</span> 修改这个配置为你的StorageClass<br></code></pre></td></tr></table></figure><p>应用</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">kubectl <span class="hljs-built_in">apply</span> -f kubepi-pvc.yaml<br></code></pre></td></tr></table></figure><p>获取访问地址</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 获取 NodeIp</span><br><span class="hljs-built_in">export</span> NODE_IP=$(kubectl get nodes -o jsonpath=<span class="hljs-string">&quot;&#123;.items[0].status.addresses[0].address&#125;&quot;</span>)<br><span class="hljs-comment"># 获取 NodePort</span><br><span class="hljs-built_in">export</span> NODE_PORT=$(kubectl -n kube-system get services kubepi -o jsonpath=<span class="hljs-string">&quot;&#123;.spec.ports[0].nodePort&#125;&quot;</span>)<br><span class="hljs-comment"># 获取 Address</span><br><span class="hljs-built_in">echo</span> http://<span class="hljs-variable">$NODE_IP</span>:<span class="hljs-variable">$NODE_PORT</span><br><br></code></pre></td></tr></table></figure><p><strong>登录系统</strong><br>地址: http:&#x2F;&#x2F;$NODE_IP:$NODE_PORT<br>用户名: admin<br>密码: kubepi</p><p><strong>集群导入</strong></p><p>选择集群列表-导入-认证模式选择kubeconfig 文件</p><p>在终端执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/rancher/k3s/k3s.yaml<br></code></pre></td></tr></table></figure><p>将输出的内容复制粘贴到输入框</p><blockquote><p>如果 server IP 为 127.0.0.1，需要将 IP 替换为集群 master 节点 IP</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250810101419509.png" alt="cluster-import-kubeconfig"></p><p>然后修改默认密码，就可以开始使用了，更多内容请看官方文档</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250810101553749.png" alt="image-20250810101553554"></p><h2 id="卸载-K3s"><a href="#卸载-K3s" class="headerlink" title="卸载 K3s"></a>卸载 K3s</h2><p>如果您使用安装脚本安装了 K3s，那么在安装过程中会生成一个卸载 K3s 的脚本。</p><blockquote><p>卸载 K3s 会删除集群数据和所有脚本。要使用不同的安装选项重新启动集群，请使用不同的标志重新运行安装脚本。</p></blockquote><p>要从 server 节点卸载 K3s，请运行：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>k3s-uninstall.sh<br></code></pre></td></tr></table></figure><p>要从 agent 节点卸载 K3s，请运行：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>k3s-agent-uninstall.sh<br></code></pre></td></tr></table></figure><h2 id="部署服务"><a href="#部署服务" class="headerlink" title="部署服务"></a>部署服务</h2><p>以NGINX为例</p><h4 id="创建-Pod"><a href="#创建-Pod" class="headerlink" title="创建 Pod"></a>创建 Pod</h4><p>将以下代码写入 <code>nginx-pod.yaml</code>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Pod</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">containers</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">name: nginx</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx:latest</span><br>    <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">containerPort: 80</span><br></code></pre></td></tr></table></figure><p>使用如下命令应用：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">root<span class="hljs-symbol">@k3s</span>-server:~/k3s<span class="hljs-meta"># kubectl apply -f nginx-pod.yaml</span><br>pod/nginx created<br></code></pre></td></tr></table></figure><p>查看运行状态：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@k3s-server:~# kubectl get pod<br><span class="hljs-attribute">NAME</span>    READY   STATUS    RESTARTS   AGE<br><span class="hljs-attribute">nginx</span>   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">11</span>h<br></code></pre></td></tr></table></figure><blockquote><p>与 Docker 不同，这里进入容器的需要在命令前加上 <code>--</code></p></blockquote><p>进入 Pod 并测试访问：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml">root@k3s-server:~/k3s# kubectl exec -it nginx -- /bin/bash<br>root@nginx:/# curl localhost<br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">html</span> &#123; <span class="hljs-attribute">color-scheme</span>: light dark; &#125;</span><br><span class="language-css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css"><span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>For online documentation and support please refer to<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Commercial support is available at<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Thank you for using nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>到此为止，我们创建了一个功能正常的 Pod。</p><h4 id="创建-Deployment"><a href="#创建-Deployment" class="headerlink" title="创建 Deployment"></a>创建 Deployment</h4><p>将以下代码写入 <code>nginx-deployment.yaml</code>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">apps/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Deployment</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">selector</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">matchLabels</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">app</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attribute">replicas</span><span class="hljs-punctuation">:</span> <span class="hljs-string">2</span><br>  <span class="hljs-attribute">template</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-attribute">app</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">containers</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: nginx</span><br>        <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx:latest</span><br>        <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">containerPort: 80</span><br></code></pre></td></tr></table></figure><p>使用如下命令应用：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">root<span class="hljs-symbol">@k3s</span>-server:~/k3s<span class="hljs-meta"># kubectl apply -f nginx-deployment.yaml</span><br>deployment.apps/nginx created<br></code></pre></td></tr></table></figure><p>查看运行状态：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@k3s-server:~/k3s# kubectl get deployment<br><span class="hljs-attribute">NAME</span>    READY   UP-TO-DATE   AVAILABLE   AGE<br><span class="hljs-attribute">nginx</span>   <span class="hljs-number">2</span>/<span class="hljs-number">2</span>     <span class="hljs-number">2</span>            <span class="hljs-number">2</span>           <span class="hljs-number">29</span>s<br></code></pre></td></tr></table></figure><p>此时再查看 Pod，如下：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@k3s-server:~/k3s# kubectl get pod<br><span class="hljs-attribute">NAME</span>                     READY   STATUS    RESTARTS   AGE<br><span class="hljs-attribute">nginx</span>-<span class="hljs-number">544</span>dc8b7c4-lzvz9   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m4s<br><span class="hljs-attribute">nginx</span>-<span class="hljs-number">544</span>dc8b7c4-<span class="hljs-number">5</span>nbcw   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">3</span>m4s<br></code></pre></td></tr></table></figure><p>可以看到，由 Deployment 产生的 Pod 命名规则如下：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$&#123;DeploymentName&#125;</span>-<span class="hljs-variable">$&#123;DeploymentUid&#125;</span>-<span class="hljs-variable">$&#123;Hash&#125;</span><br></code></pre></td></tr></table></figure><p>在查看 Pod 的时候，如果加上 <code>-o wide</code> 参数，就可以查看更多信息：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@k3s-server:~/k3s# kubectl get pod -o wide<br><span class="hljs-attribute">NAME</span>                     READY   STATUS    RESTARTS   AGE     IP          NODE          NOMINATED NODE   READINESS GATES<br><span class="hljs-attribute">nginx</span>-<span class="hljs-number">544</span>dc8b7c4-lzvz9   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m30s   <span class="hljs-number">10.42.1.4</span>   k3s-agent-<span class="hljs-number">1</span>   &lt;none&gt;           &lt;none&gt;<br><span class="hljs-attribute">nginx</span>-<span class="hljs-number">544</span>dc8b7c4-<span class="hljs-number">5</span>nbcw   <span class="hljs-number">1</span>/<span class="hljs-number">1</span>     Running   <span class="hljs-number">0</span>          <span class="hljs-number">9</span>m30s   <span class="hljs-number">10.42.3.3</span>   k3s-agent-<span class="hljs-number">2</span>   &lt;none&gt;           &lt;none&gt;<br></code></pre></td></tr></table></figure><p>可以看到，该 nginx 被创建了两个 Pod 副本，分别部署在了 <code>k3s-agent-1</code> 和 <code>k3s-agent-2</code> 上面。</p><h4 id="创建-Service"><a href="#创建-Service" class="headerlink" title="创建 Service"></a>创建 Service</h4><p>Service，将运行在一组 Pods 上的应用程序公开为网络服务的抽象方法。</p><p>举个例子，考虑一个图片处理后端，它运行了 3 个副本。这些副本是可互换的 —— 前端不需要关心它们调用了哪个后端副本。 然而组成这一组后端程序的 Pod 实际上可能会发生变化， 前端客户端不应该也没必要知道，而且也不需要跟踪这一组后端的状态。</p><p>Service 定义的抽象能够解耦这种关联。</p><p>Service 有两种类型，一种是 <code>NodePort</code>，选择该种类型的可直接通过 <code>$&#123;serverIP&#125;:$&#123;nodePort&#125;</code> 访问内部的服务；另一种是 <code>ClusterIP</code> 类型，它只会在集群内部可以访问到该 Pod，不会把 Pod 的内容映射在某一个外网可以访问的端口上，但这并不意味着不能对外提供服务，而是需要 Ingress 的帮助，来将外网的流量转发到 Service 上来。</p><h4 id="NodePort"><a href="#NodePort" class="headerlink" title="NodePort"></a>NodePort</h4><p>将以下代码写入 <code>nginx-service-nodeport.yaml</code>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Service</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx-service</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">selector</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">app</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">protocol: TCP</span><br>    <span class="hljs-attribute">port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br>    <span class="hljs-attribute">targetPort</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br>    <span class="hljs-attribute">nodePort</span><span class="hljs-punctuation">:</span> <span class="hljs-string">30080</span><br>  <span class="hljs-attribute">type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">NodePort</span><br></code></pre></td></tr></table></figure><p>这里 <code>nodePort</code> 的范围是 <code>30000-32767</code>。</p><p>使用如下命令应用：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">root<span class="hljs-symbol">@k3s</span>-server:~/k3s<span class="hljs-meta"># kubectl apply -f nginx-service-nodeport.yaml </span><br>service/nginx-service created<br></code></pre></td></tr></table></figure><p>现在访问 <code>http://10.0.0.39:30080</code>、 <code>http://10.0.0.31:30080</code> 与 <code>http://10.0.0.32:30080</code>，都可以正常访问到内容：</p><p><a href="https://mmdjiji.com/images/2022/09/1.png"><img src="https://mmdjiji.com/images/2022/09/1.png" alt="访问测试"></a></p><p>查看 Service：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">root@k3s-<span class="hljs-keyword">server</span>:~/k3s# kubectl <span class="hljs-keyword">get</span> service<br><span class="hljs-type">NAME</span>            <span class="hljs-keyword">TYPE</span>        <span class="hljs-keyword">CLUSTER</span>-IP     <span class="hljs-keyword">EXTERNAL</span>-IP   PORT(S)        AGE<br>kubernetes      ClusterIP   <span class="hljs-number">10.43</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>      &lt;<span class="hljs-keyword">none</span>&gt;        <span class="hljs-number">443</span>/TCP        <span class="hljs-number">12</span>h<br>nginx-service   NodePort    <span class="hljs-number">10.43</span><span class="hljs-number">.74</span><span class="hljs-number">.219</span>   &lt;<span class="hljs-keyword">none</span>&gt;        <span class="hljs-number">80</span>:<span class="hljs-number">30080</span>/TCP   <span class="hljs-number">7</span>m21s<br></code></pre></td></tr></table></figure><h4 id="ClusterIP"><a href="#ClusterIP" class="headerlink" title="ClusterIP"></a>ClusterIP</h4><h5 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h5><p>将以下代码写入 <code>nginx-service-clusterip.yaml</code>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Service</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx-service</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">selector</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">app</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx</span><br>  <span class="hljs-attribute">ports</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">protocol: TCP</span><br>    <span class="hljs-attribute">port</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br>    <span class="hljs-attribute">targetPort</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br></code></pre></td></tr></table></figure><p>使用如下命令应用：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">root<span class="hljs-symbol">@k3s</span>-server:~/k3s<span class="hljs-meta"># kubectl apply -f nginx-service-clusterip.yaml </span><br>service/nginx-service created<br></code></pre></td></tr></table></figure><p>这样就创建了 Service，但外部还不能访问，所以需要 Ingress。</p><h5 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h5><p>先做个 DNS 解析：</p><table><thead><tr><th align="left">类型</th><th align="left">名称</th><th align="left">内容</th></tr></thead><tbody><tr><td align="left">A</td><td align="left">*.k3s.abc.com</td><td align="left">10.0.0.39</td></tr><tr><td align="left">A</td><td align="left">*.k3s.abc.com</td><td align="left">10.0.0.31</td></tr><tr><td align="left">A</td><td align="left">*.k3s.abc.com</td><td align="left">10.0.0.32</td></tr></tbody></table><p>将以下代码写入 <code>nginx-ingress.yaml</code>：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">networking.k8s.io/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Ingress</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx-ingress</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">rules</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">host: nginx.k3s.abc.com</span><br>      <span class="hljs-attribute">http</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-attribute">paths</span><span class="hljs-punctuation">:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">path: /</span><br>            <span class="hljs-attribute">pathType</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Prefix</span><br>            <span class="hljs-attribute">backend</span><span class="hljs-punctuation">: </span><br>              <span class="hljs-attribute">service</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">nginx-service</span><br>                <span class="hljs-attribute">port</span><span class="hljs-punctuation">:</span><br>                  <span class="hljs-attribute">number</span><span class="hljs-punctuation">:</span> <span class="hljs-string">80</span><br></code></pre></td></tr></table></figure><p>使用如下命令应用：</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs autoit">root<span class="hljs-symbol">@k3s</span>-server:~/k3s<span class="hljs-meta"># kubectl apply -f nginx-ingress.yaml </span><br>ingress.networking.k8s.io/nginx-ingress created<br></code></pre></td></tr></table></figure><p>现在访问 <code>http://nginx.k3s.abc.com</code> 即可访问到部署的服务：</p><p><a href="https://mmdjiji.com/images/2022/09/2.png"><img src="https://mmdjiji.com/images/2022/09/2.png" alt="访问测试"></a></p><p>尝试关掉 <code>k3s-agent-1</code>：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">root<span class="hljs-variable">@k3s</span>-agent<span class="hljs-number">-1</span><span class="hljs-symbol">:/home/jiji</span><span class="hljs-comment"># shutdown -h now</span><br></code></pre></td></tr></table></figure><p>证实 <code>k3s-agent-1</code> 确实下线了：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@k3s-server:~# kubectl get node<br><span class="hljs-attribute">NAME</span>          STATUS     ROLES                  AGE   VERSION<br><span class="hljs-attribute">k3s</span>-server    Ready      control-plane,master   <span class="hljs-number">13</span>h   v1.<span class="hljs-number">24</span>.<span class="hljs-number">4</span>+k3s1<br><span class="hljs-attribute">k3s</span>-agent-<span class="hljs-number">2</span>   Ready      &lt;none&gt;                 <span class="hljs-number">12</span>h   v1.<span class="hljs-number">24</span>.<span class="hljs-number">4</span>+k3s1<br><span class="hljs-attribute">k3s</span>-agent-<span class="hljs-number">1</span>   NotReady   &lt;none&gt;                 <span class="hljs-number">12</span>h   v1.<span class="hljs-number">24</span>.<span class="hljs-number">4</span>+k3s1<br></code></pre></td></tr></table></figure><p>再访问 <code>http://nginx.k3s.abc.com</code>，服务出现不可用，但刷新后也可访问正常。经过两次连续的 ping，我们发现 DNS 解析由原本失效的 <code>10.0.0.31</code>，变为了 <code>10.0.0.39</code>。这也就保证了在 Agent 宕机的情况下服务高可用。</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">$ ping nginx.k3s.abc.com</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">正在 Ping nginx.k3s.abc.com[10.0.0.31] 具有 32 字节的数据</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">来自 10.0.0.1 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">无法访问目标主机。</span><br><span class="hljs-attribute">来自 10.0.0.1 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">无法访问目标主机。</span><br><span class="hljs-attribute">来自 10.0.0.1 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">无法访问目标主机。</span><br><span class="hljs-attribute">来自 10.0.0.1 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">无法访问目标主机。</span><br><br><span class="hljs-attribute">10.0.0.31 的 Ping 统计信息</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">数据包</span><span class="hljs-punctuation">:</span> <span class="hljs-string">已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span><br><br><span class="hljs-attribute">$ ping nginx.k3s.abc.com</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">正在 Ping nginx.k3s.abc.com [10.0.0.39] 具有 32 字节的数据</span><span class="hljs-punctuation">:</span><br><span class="hljs-attribute">来自 10.0.0.39 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">字节=32 时间=3ms TTL=63</span><br><span class="hljs-attribute">来自 10.0.0.39 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">字节=32 时间=5ms TTL=63</span><br><span class="hljs-attribute">来自 10.0.0.39 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">字节=32 时间=5ms TTL=63</span><br><span class="hljs-attribute">来自 10.0.0.39 的回复</span><span class="hljs-punctuation">:</span> <span class="hljs-string">字节=32 时间=12ms TTL=63</span><br><br><span class="hljs-attribute">10.0.0.39 的 Ping 统计信息</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">数据包</span><span class="hljs-punctuation">:</span> <span class="hljs-string">已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，</span><br><span class="hljs-attribute">往返行程的估计时间(以毫秒为单位)</span><span class="hljs-punctuation">:</span><br>    最短 = 3ms，最长 = 12ms，平均 = 6ms<br></code></pre></td></tr></table></figure><p>但当我关闭 <code>k3s-server</code> 的时候，服务出现了不可用，且无自动切换。或许对于高可用 K3s 集群来说，需要至少两台 <code>Server</code> 节点。</p><h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">root@k3s-server:~# kubectl <span class="hljs-keyword">create</span> secret tls my-tls-secret \<br>  --cert=<span class="hljs-keyword">path</span>/<span class="hljs-keyword">to</span>/cert/file \<br>  --<span class="hljs-keyword">key</span>=<span class="hljs-keyword">path</span>/<span class="hljs-keyword">to</span>/<span class="hljs-keyword">key</span>/file<br></code></pre></td></tr></table></figure><p>在 <code>nginx-ingress.yaml</code> 中追加：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">tls</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">hosts:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">nginx.k3s.abc.com</span><br>    <span class="hljs-attribute">secretName</span><span class="hljs-punctuation">:</span> <span class="hljs-string">my-tls-secret</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Debian-K3s集群的安装、配置与使用&quot;&gt;&lt;a href=&quot;#Debian-K3s集群的安装、配置与使用&quot; class=&quot;headerlink&quot; title=&quot;Debian-K3s集群的安装、配置与使用&quot;&gt;&lt;/a&gt;Debian-K3s集群的安装、配置与使用&lt;/</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Linux" scheme="https://blog.quickso.cn/tags/Linux/"/>
    
    <category term="K3s" scheme="https://blog.quickso.cn/tags/K3s/"/>
    
  </entry>
  
  <entry>
    <title>Tailscale自建Derp中转服务器</title>
    <link href="https://blog.quickso.cn/2025/08/02/Tailscale%E8%87%AA%E5%BB%BADerp%E4%B8%AD%E8%BD%AC%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://blog.quickso.cn/2025/08/02/Tailscale%E8%87%AA%E5%BB%BADerp%E4%B8%AD%E8%BD%AC%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2025-08-02T01:45:18.000Z</published>
    <updated>2026-02-06T13:40:34.769Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Tailscale-与-DERP-简介"><a href="#Tailscale-与-DERP-简介" class="headerlink" title="Tailscale 与 DERP 简介"></a>Tailscale 与 DERP 简介</h1><h2 id="Tailscale-是什么？"><a href="#Tailscale-是什么？" class="headerlink" title="Tailscale 是什么？"></a>Tailscale 是什么？</h2><p>Tailscale 是一个基于 Wireguard 的带有多种网络工具的 P2P 组网工具。得益于其 P2P 的特性，Tailscale 还可以进行内网穿透，打破 NAT 的限制直达另一台主机。</p><p><a href="https://tailscale.com/">https://tailscale.com</a></p><h2 id="DERP-是什么？"><a href="#DERP-是什么？" class="headerlink" title="DERP 是什么？"></a>DERP 是什么？</h2><p>DERP 是一个 Tailscale 自行开发的中继服务。当所处网络环境难以穿透（如校园网、移动大内网、4G、5G 等）时，所有流量都会经由 DERP 中转至目标地址。</p><p>在默认情况下，Tailscale 官方已经提供了环大陆的官方 DERP 服务，但是由于中国大陆的网络连通性等问题，官方并未提供大陆的 DERP 节点。为了确保大陆的打通成功率，我们需要自建一个 DERP 服务，来帮助我们 “打洞”。</p><h2 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h2><p>自建Dreper服务需要Docker，如果没有，输入下方命令安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -fsSL https://get.docker.com -o get-docker.sh &amp;&amp;<br>sh get-docker.sh<br></code></pre></td></tr></table></figure><h2 id="安装Dreper服务"><a href="#安装Dreper服务" class="headerlink" title="安装Dreper服务"></a>安装Dreper服务</h2><p>将下方命令中的域名补全，在服务器中执行</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">docker run <span class="hljs-attr">--restart</span> always \<br><span class="hljs-attr">--name</span> derper -<span class="hljs-selector-tag">p</span> <span class="hljs-number">12345</span>:<span class="hljs-number">12345</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-number">3478</span>:<span class="hljs-number">3478</span>/udp \<br>-e DERP_ADDR=:<span class="hljs-number">12345</span> \<br>-e DERP_DOMAIN= dreper<span class="hljs-selector-class">.abc</span><span class="hljs-selector-class">.com</span> \<br>-d yangchuansheng/derper:latest<br></code></pre></td></tr></table></figure><p>完成后讲域名解析到本机IP并反代本机的12345端口，完成后访问域名显示如下内容则DERP服务安装成功</p><h1 id="DERP"><a href="#DERP" class="headerlink" title="DERP"></a>DERP</h1><p>This is a <a href="https://tailscale.com/">Tailscale</a> <a href="https://pkg.go.dev/tailscale.com/derp">DERP</a> server.</p><h1 id="配置TailScale"><a href="#配置TailScale" class="headerlink" title="配置TailScale"></a>配置TailScale</h1><p>登录TailScale点击如下页面</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250802095524279.webp" alt="2.webp"></p><p>修改</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">//</span> Example/default ACLs for unrestricted connections.<br>&#123;<br><span class="hljs-string">//</span> Declare static groups of users. Use autogroups for all users or users with a specific role.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;groups&quot;</span>: &#123;<br><span class="hljs-string">//</span>  <span class="hljs-string">&quot;group:example&quot;</span>: [<span class="hljs-string">&quot;alice@example.com&quot;</span>, <span class="hljs-string">&quot;bob@example.com&quot;</span>],<br><span class="hljs-string">//</span> &#125;,<br><br><span class="hljs-string">//</span> Define the tags which can be applied to devices and by which users.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;tagOwners&quot;</span>: &#123;<br><span class="hljs-string">//</span>  <span class="hljs-string">&quot;tag:example&quot;</span>: [<span class="hljs-string">&quot;autogroup:admin&quot;</span>],<br><span class="hljs-string">//</span> &#125;,<br><br><span class="hljs-string">//</span> Define grants that govern access for users, groups, autogroups, tags,<br><span class="hljs-string">//</span> Tailscale IP addresses, and subnet ranges.<br><span class="hljs-string">&quot;grants&quot;</span>: [<br><span class="hljs-string">//</span> Allow all connections.<br><span class="hljs-string">//</span> Comment this section out <span class="hljs-keyword">if</span> you want to define specific restrictions.<br>&#123;<span class="hljs-string">&quot;src&quot;</span>: [<span class="hljs-string">&quot;*&quot;</span>], <span class="hljs-string">&quot;dst&quot;</span>: [<span class="hljs-string">&quot;*&quot;</span>], <span class="hljs-string">&quot;ip&quot;</span>: [<span class="hljs-string">&quot;*&quot;</span>]&#125;,<br><br><span class="hljs-string">//</span> Allow users in <span class="hljs-string">&quot;group:example&quot;</span> to access <span class="hljs-string">&quot;tag:example&quot;</span>, but only from<br><span class="hljs-string">//</span> devices that are running macOS and have enabled Tailscale client auto-updating.<br><span class="hljs-string">//</span> &#123;<span class="hljs-string">&quot;src&quot;</span>: [<span class="hljs-string">&quot;group:example&quot;</span>], <span class="hljs-string">&quot;dst&quot;</span>: [<span class="hljs-string">&quot;tag:example&quot;</span>], <span class="hljs-string">&quot;ip&quot;</span>: [<span class="hljs-string">&quot;*&quot;</span>], <span class="hljs-string">&quot;srcPosture&quot;</span>:[<span class="hljs-string">&quot;posture:autoUpdateMac&quot;</span>]&#125;,<br>],<br><br><span class="hljs-string">//</span> Define postures that will be applied to all rules without any specific<br><span class="hljs-string">//</span> srcPosture definition.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;defaultSrcPosture&quot;</span>: [<br><span class="hljs-string">//</span>      <span class="hljs-string">&quot;posture:anyMac&quot;</span>,<br><span class="hljs-string">//</span> ],<br><br><span class="hljs-string">//</span> Define device posture rules requiring devices to meet<br><span class="hljs-string">//</span> certain criteria to access parts of your system.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;postures&quot;</span>: &#123;<br><span class="hljs-string">//</span>      <span class="hljs-string">//</span> Require devices running macOS, a stable Tailscale<br><span class="hljs-string">//</span>      <span class="hljs-string">//</span> <span class="hljs-keyword">version</span> and auto update enabled for Tailscale.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;posture:autoUpdateMac&quot;</span>: [<br><span class="hljs-string">//</span>     <span class="hljs-string">&quot;node:os == &#x27;macos&#x27;&quot;</span>,<br><span class="hljs-string">//</span>     <span class="hljs-string">&quot;node:tsReleaseTrack == &#x27;stable&#x27;&quot;</span>,<br><span class="hljs-string">//</span>     <span class="hljs-string">&quot;node:tsAutoUpdate&quot;</span>,<br><span class="hljs-string">//</span> ],<br><span class="hljs-string">//</span>      <span class="hljs-string">//</span> Require devices running macOS and a stable<br><span class="hljs-string">//</span>      <span class="hljs-string">//</span> Tailscale <span class="hljs-keyword">version</span>.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;posture:anyMac&quot;</span>: [<br><span class="hljs-string">//</span>     <span class="hljs-string">&quot;node:os == &#x27;macos&#x27;&quot;</span>,<br><span class="hljs-string">//</span>     <span class="hljs-string">&quot;node:tsReleaseTrack == &#x27;stable&#x27;&quot;</span>,<br><span class="hljs-string">//</span> ],<br><span class="hljs-string">//</span> &#125;,<br><span class="hljs-string">//</span> Define users and devices that can use Tailscale SSH.<br><span class="hljs-string">&quot;ssh&quot;</span>: [<br><span class="hljs-string">//</span> Allow all users to SSH into their own devices in check mode.<br><span class="hljs-string">//</span> Comment this section out <span class="hljs-keyword">if</span> you want to define specific restrictions.<br>&#123;<br><span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;check&quot;</span>,<br><span class="hljs-string">&quot;src&quot;</span>:    [<span class="hljs-string">&quot;autogroup:member&quot;</span>],<br><span class="hljs-string">&quot;dst&quot;</span>:    [<span class="hljs-string">&quot;autogroup:self&quot;</span>],<br><span class="hljs-string">&quot;users&quot;</span>:  [<span class="hljs-string">&quot;autogroup:nonroot&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>],<br>&#125;,<br>],<br><br><span class="hljs-string">//</span> Test access rules every time they&#x27;re saved.<br><span class="hljs-string">//</span> <span class="hljs-string">&quot;tests&quot;</span>: [<br><span class="hljs-string">//</span>  &#123;<br><span class="hljs-string">//</span>  <span class="hljs-string">&quot;src&quot;</span>: <span class="hljs-string">&quot;alice@example.com&quot;</span>,<br><span class="hljs-string">//</span>  <span class="hljs-string">&quot;accept&quot;</span>: [<span class="hljs-string">&quot;tag:example&quot;</span>],<br><span class="hljs-string">//</span>  <span class="hljs-string">&quot;deny&quot;</span>: [<span class="hljs-string">&quot;100.101.102.103:443&quot;</span>],<br><span class="hljs-string">//</span>  &#125;,<br><span class="hljs-string">//</span> ],<br><span class="hljs-string">&quot;derpMap&quot;</span>: &#123;<br><span class="hljs-string">&quot;OmitDefaultRegions&quot;</span>: <span class="hljs-literal">true</span>,<span class="hljs-string">//</span> OmitDefaultRegions 用来忽略官方的中继节点<br>        <span class="hljs-string">&quot;Regions&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;901&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;RegionID&quot;</span>:   901, <span class="hljs-string">//</span> 900以上<br>                <span class="hljs-string">&quot;RegionCode&quot;</span>: <span class="hljs-string">&quot;Aliyun-JP&quot;</span>, <span class="hljs-string">//</span> 区域代码，会在 `tailscale netcheck` 显示<br>                <span class="hljs-string">&quot;RegionName&quot;</span>: <span class="hljs-string">&quot;日本东京阿里云&quot;</span>, <span class="hljs-string">//</span> 区域名称，会在 `tailscale netcheck` 显示<br>                <span class="hljs-string">&quot;Nodes&quot;</span>: [<br>                    &#123;<br>                        <span class="hljs-string">&quot;Name&quot;</span>:     <span class="hljs-string">&quot;aliyun-jp-1&quot;</span>, <span class="hljs-string">//</span> 随意填写<br>                        <span class="hljs-string">&quot;RegionID&quot;</span>: 901, <span class="hljs-string">//</span> 对应上方ID<br>                        <span class="hljs-string">&quot;HostName&quot;</span>: <span class="hljs-string">&quot;dreper.abc.com&quot;</span>, <span class="hljs-string">//</span> 填写你的DERP服务域名<br>                        <span class="hljs-string">&quot;DERPPort&quot;</span>: 443, <span class="hljs-string">//</span> 你的DERP服务端口<br>                    &#125;,<br>                ],<br>            &#125;,<br>            <span class="hljs-string">//</span> 更多DERP节点<br>        &#125;,<br>    &#125;,<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="检查是否生效"><a href="#检查是否生效" class="headerlink" title="检查是否生效"></a>检查是否生效</h3><p>输入命令<code>tailscale netcheck</code>，若为docker，输入在<code>/app</code>目录下输入<code>./tailscale netcheck</code> 出现自己设置的服务器则说明成功</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">❯</span> <span class="hljs-string">tailscale</span> <span class="hljs-string">netcheck</span><br><br><span class="hljs-attr">Report:</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">Time:</span> <span class="hljs-number">2025-08-02T01:57:26.02427011Z</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">UDP:</span> <span class="hljs-literal">true</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">IPv4:</span> <span class="hljs-literal">yes</span><span class="hljs-string">,</span> <span class="hljs-string">xxx.xxx.xxx.xxx:28463</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">IPv6:</span> <span class="hljs-literal">no</span><span class="hljs-string">,</span> <span class="hljs-string">but</span> <span class="hljs-string">OS</span> <span class="hljs-string">has</span> <span class="hljs-string">support</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">MappingVariesByDestIP:</span> <br>        <span class="hljs-string">*</span> <span class="hljs-attr">PortMapping:</span> <br>        <span class="hljs-string">*</span> <span class="hljs-attr">CaptivePortal:</span> <span class="hljs-literal">false</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">Nearest DERP:</span> <span class="hljs-string">日本东京阿里云</span><br>        <span class="hljs-string">*</span> <span class="hljs-attr">DERP latency:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-attr">Aliyun-JP:</span> <span class="hljs-number">461.</span><span class="hljs-string">6ms</span> <span class="hljs-string">(日本东京阿里云)</span><br></code></pre></td></tr></table></figure><h1 id="使用-ping-测试连通性"><a href="#使用-ping-测试连通性" class="headerlink" title="使用 ping 测试连通性"></a>使用 ping 测试连通性</h1><p>找到一个在用 tailscale 的客户端<br>进入终端<br>输入 tailscale ping 你的另一个主机地址<br>检验是否联通 (例如出现 via DER (xxx)) 即为成功</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.ixacg.com/posts/2025/04/19/8a865267db07.html">https://blog.ixacg.com/posts/2025/04/19/8a865267db07.html</a></p><p><a href="https://cqjn.cc/archives/1719844788120">https://cqjn.cc/archives/1719844788120</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Tailscale-与-DERP-简介&quot;&gt;&lt;a href=&quot;#Tailscale-与-DERP-简介&quot; class=&quot;headerlink&quot; title=&quot;Tailscale 与 DERP 简介&quot;&gt;&lt;/a&gt;Tailscale 与 DERP 简介&lt;/h1&gt;&lt;h2 i</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Tailscale" scheme="https://blog.quickso.cn/tags/Tailscale/"/>
    
    <category term="异地组网" scheme="https://blog.quickso.cn/tags/%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>斐讯N1盒子刷Armbian系统并安装桌面</title>
    <link href="https://blog.quickso.cn/2025/07/26/%E6%96%90%E8%AE%AFN1%E7%9B%92%E5%AD%90%E5%88%B7Armbian%E7%B3%BB%E7%BB%9F%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2/"/>
    <id>https://blog.quickso.cn/2025/07/26/%E6%96%90%E8%AE%AFN1%E7%9B%92%E5%AD%90%E5%88%B7Armbian%E7%B3%BB%E7%BB%9F%E5%B9%B6%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2/</id>
    <published>2025-07-26T13:11:18.000Z</published>
    <updated>2026-02-06T13:40:34.781Z</updated>
    
    <content type="html"><![CDATA[<p>PHICOMM N1 盒子已经上市很多年了，虽然是一个矿渣产品，但是其优异的硬件配置，丰富的固件适配，目前还被广泛使用。在此首先对 webpad 等几位大佬致敬，由于他们的分享，使得很多人可以很方便的在 N1 盒子上实现自己所需的功能。</p><p><strong>一、斐讯 N1 的硬件参数</strong></p><p>产品类型：家庭网络存储，云存储</p><p>处理器：Amlogic S905D Cortex-A53，Mali-450 GPU</p><p>内存：RAM 2GB, ROM 8GB</p><p>接口：USB 2.0 * 2、HDMI * 1、RJ45 * 1（千兆网口）</p><p>无线连接：支持2.4G&#x2F;5G WiFi，蓝牙BT 4.1 BLE低功耗</p><p>视频输出分辨率：最高支持到 4K 60 帧硬件解码</p><p>电源接口：12V&#x2F;2A</p><p>尺寸与重量：产品尺寸为110mm x 110mm x 40mm，产品重量约为0.248kg</p><p><strong>二、刷机准备</strong></p><p>1、所需硬件</p><p>　　N1 盒子一个、8G 以上 U 盘一个、USB 接口键盘一个、USB 鼠标一块、HDMI 晶晨短接神器（作用为线刷时短接，很便宜，海鲜市场有卖，如果没有可以拆机手动短接）、HDMI 接口显示器 &#x2F; HDMI 接口电视一台、网线一根、HDMI 线一根、路由器、电脑。</p><p>2、所需软件</p><p>　　为方便使用，我已经将所需要的软件整理好，放到了谷歌云盘，大家可以下载后使用。</p><p><a href="https://drive.google.com/drive/u/1/folders/1QUhpnzm1CvFHkUh1904EN7QFaJBag8Vb">https://drive.google.com/drive/u/1/folders/1QUhpnzm1CvFHkUh1904EN7QFaJBag8Vb</a></p><p>Bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">1. 解压使用-斐讯T1、N1官方系统降级工具.zip                              <span class="hljs-comment">#斐讯 T1、N1 官方系统降级工具</span><br>2. 解压使用-N1U盘启动.zip                                              <span class="hljs-comment">#N1 U 盘启动</span><br>3. USB_Burning_Tools_v2.0.7.2_build2.exe                              <span class="hljs-comment">#晶晨线刷工具含驱动</span><br>4. win32diskimager-1.0.0-install.exe                                  <span class="hljs-comment">#写盘工具</span><br>5. N1_mod_by_webpad_v2.2_20180920.img.7z                              <span class="hljs-comment">#Android 7.0.1 版本固件, root, 可引导进入 Armbian</span><br>6. Reboot to LibreELEC_1.1_Apkpure.apk                                <span class="hljs-comment">#重启进入 Armbian 软件</span><br>7.Armbian_24.5.0_amlogic_s905d_jammy_6.6.28_server_2024.04.25.img.gz  <span class="hljs-comment">#Armbian_24.5.0 版本固件,kernel BPF 模块已打开,可使用 dae</span><br></code></pre></td></tr></table></figure><p>　　谷歌云盘里提供的 Armbian 固件 kernel BPF 模块默认已打开, 经我测试可使用 dae ，来自于 ophub 的 GitHub 项目，如果你更习惯于使用 Debian 固件，请使用如下链接自行下载。</p><p><a href="https://github.com/ophub/amlogic-s9xxx-armbian/releases/">https://github.com/ophub/amlogic-s9xxx-armbian/releases/</a></p><p>　　Armbian 是基于 Debian 和 Ubuntu 的 Linux 发行版，专门为 ARM 开发板设计。Armbian 的版本命名通常遵循其基于的 Debian 或 Ubuntu 发行版。Armbian 的这四个版本（Noble、Jammy、Bullseye 和 Bookworm）分别基于不同的 Debian 或 Ubuntu 版本：</p><ul><li>Armbian Noble - 这是基于 Ubuntu 22.04 LTS (代号 “Jammy Jellyfish”) 的版本。Ubuntu 22.04 是一个长期支持版本，提供了五年的安全更新和支持。Armbian 对这个版本进行了针对 ARM 设备的优化和定制。</li><li>Armbian Jammy - 也是基于 Ubuntu 22.04 LTS 的版本。这个版本名可能与 Noble 重复或是对同一基础版本的另一种命名方式。</li><li>Armbian Bullseye - 这是基于 Debian 11 (代号 “Bullseye”) 的版本。Debian 11 提供了多种软件的最新稳定版，并享有 Debian 社区的广泛支持和安全维护。Debian 版本的 Armbian 通常更倾向于稳定性和兼容性。</li><li>Armbian Bookworm - 基于 Debian 12 (代号 “Bookworm”)。这是 Debian 的测试版本，在正式成为稳定版前，它会包含最新的软件更新。使用这个版本的 Armbian 可能提供一些最前沿的特性，但也可能不如稳定版那么稳定。</li></ul><p><strong>三、降级关键分区</strong></p><p>　　玩 N1 的朋友都知道第一步要对 N1 进行降级，但是却很少有人说明为什么要进行降级，降级针对盒子做了什么事情，这里我参考“if年少有为”在自己博文中的描述，希望大家能明白其中原理。</p><p>　　连接 HDMI、网线、电源后会进入斐讯自带的安卓系统，安卓系统的标准启动过程如下：</p><ul><li>bootloader：斐讯针对该盒子硬件实现的类似 BIOS 的东西，它负责硬件的初始化，最终引导操作系统。</li><li>boot 分区：放着安卓操作系统的内核文件，由 bootloader 唤起，也就实现了进入操作系统的效果。</li><li>recovery 分区：类似于 WinPE 的东西，如果 boot 分区挂了，则可以通过 Recovery 方式进入一个临时的操作系统，然后恢复 boot 分区（类似于 ghost 做系统）。</li></ul><p>　　问题就在于，bootloader 是斐讯针对盒子定制的，它设置了一些限制，比如：</p><ul><li>只能使用他家的安卓系统</li><li>不支持U盘引导操作系统</li></ul><p>　　所以呢，恩山论坛的 webpad 大佬，修改了斐讯的 bootloader，我们要做的就是把 webpad 大佬修改后的 bootloader 覆盖到盒子里面去，这个过程被称之为 N1 降级，一台 N1 这辈子只需要做一次降级操作，后续不需要再研究这个问题了。当然如果你的盒子到手时就已经被刷成了 TV 等其他系统，这一步骤就可以跳过了。</p><p>1、将 N1 接上网线，HDMI 线接显示器，离 HDMI 口远的那个 USB 口接一个鼠标。连上网以后，等个五分钟左右，待其自动升级到最新版，中间可能会多次重启升级，直到不再升级为准。否则如果正在刷的过程中 N1 重启可能会有点麻烦。记录一下屏幕上显示的 IP ，下一步会用到。接下来用鼠标点击屏幕上版本号的地方 4 次，屏幕中间会显示一下“开启adb”。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714739962370407.webp" alt="1.N1 在 nas 主界面点击四次固件版本打开 adb.webp"></p><p>2、下载“1.解压使用-斐讯T1、N1官方系统降级工具.zip”文件并解压，运行 onekey 目录中的 run.bat 批处理文件，按照提示输入 2 选择 N1 降级。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714739978448687.webp" alt="2.N1 降级_1.webp"></p><p>按照提示输入 N1 的 IP 地址。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714739993276301.webp" alt="2.N1 降级_2.webp"></p><p>按照提示按任意键开始降级。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740007378510.webp" alt="2.N1 降级_3.webp"></p><p><strong>四、制作 Armbian U 盘</strong></p><p>1、在电脑上下载并安装“4.win32diskimager-1.0.0-install.exe”写盘工具软件，同时下载并解压镜像文件“7.Armbian_24.5.0_amlogic_s905d_jammy_6.6.28_server_2024.04.25.img.gz”备用。</p><p>2、运行 win32diskimager 软件，如下图所示，选择上一步解压好的镜像文件，插入 U 盘后将镜像文件写入 U 盘。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740022198752.webp" alt="3.给U盘写入armbian镜像.webp"></p><p>　　有关网上流传的 armbian 5.77 版本的最稳定，meson-gxl-s905d-phicomm-n1-xiangsm.dtb 可以解决系统过高等问题，经过我的实际测试，目前 ophub 编译的镜像已经解决了上述问题，大家可以放心使用。</p><p><strong>五、在 Android 系统里引导从 U 盘启动</strong></p><p>1、下载“2.解压使用-N1U盘启动.zip”并解压，将显示器和键盘接入 N1 盒子，执行“N1-ADBU盘启动（傻瓜包）”文件夹下的“U盘启动.bat”，输入 N1 盒子的 IP 地址，地址可以从路由器管理界面看到。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740042717577.webp" alt="4.N1盒子U盘启动.webp"></p><p>2、N1 的两个 USB 口，离 HDMI口 远的接 USB 键盘，另一个接 U 盘。HDMI 线接显示器，加电冷启动。屏幕会先出现启动画面，之后会进入 U 盘的 armbian 系统。这里如果多次重复，还是只能进入 Android 的 recovery 模式，那么请换个 U 盘试试，基本这里不成功都是因为 U 盘兼容性问题导致的，建议最好使用 USB 2.0 的 U 盘。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740057197921.webp" alt="5.armbian启动界面.webp"></p><p>3、进入 armbian 以后用 root:1234 登录，会被要求修改密码和创建普通用户，不想创建用户可以 Ctrl+C 跳过，完成以后会留在一个 shell 里面。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740074835356.webp" alt="6.armbian初始化设置.webp"></p><p><strong>六、将 U 盘中的 Armbian 系统写入 N1 盒子的 EMMC</strong></p><p>　　接上一步，使用 root 用户及密码登录 armbian 后，在 bash 下执行 <strong>armbian-install</strong> 命令。按照提示输入“101”，选择文件系统输入“1”（选择ext4），这时开始将 U 盘中的 armbian 系统 copy 到 emmc ，整个过程大概需要 2~3 分钟，等待文件 copy 完后，按照提示输入 <strong>poweroff</strong> 命令关机，然后移除盒子上的 U 盘，给盒子重新加电后会使用 emmc 进入 armbian 系统，到此刷机工作就完成了。</p><p>　　注意：在将 armbian 写入 emmc 成功后，引导的先后顺序为先从 U 盘引导进入系统，没有插 U 盘时才使用 emmc 引导进入系统，所有如果你要使用 emmc 中的系统，请务必拔掉 U 盘。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@armbian:~# armbian-install<br>[ STEPS ] Installing Armbian to internal eMMC...<br>[ STEPS ] Checking dependencies...<br>[ INFO ] Dependency check completed. Proceeding installation...<br>[ STEPS ] Initializing the environment...<br>[ INFO ] Use mainline u-boot: [ no ]<br>[ INFO ] Use ampart tool: [ <span class="hljs-built_in">yes</span> ]<br>[ INFO ] Show all devices: [ no ]<br>[ INFO ] Internal eMMC : [ /dev/mmcblk2 ]<br>[ STEPS ] Start selecting device...<br>--------------------------------------------------------------------------------------<br>ID    SOC        MODEL                               DTB<br>--------------------------------------------------------------------------------------<br>101   s905d      Phicomm-N1                          meson-gxl-s905d-phicomm-n1.dtb<br>102   s905d      Phicomm-N1(DMA-thresh)              meson-gxl-s905d-phicomm-n1-thresh.dtb<br>103   s905d      MECOOL-KI-Pro                       meson-gxl-s905d-mecool-ki-pro.dtb<br>104   s905d      SML-5442TW                          meson-gxl-s905d-sml5442tw.dtb<br>105   s905x      HG680P                              meson-gxl-s905x-p212.dtb<br>106   s905x      B860H                               meson-gxl-s905x-b860h.dtb<br>107   s905x      Nexbox-a95x                         meson-gxl-s905x-nexbox-a95x.dtb<br>108   s905x      TX9                                 meson-gxl-s905x-tx9.dtb<br>109   s905x      T95,XiaoMI-3S,X96                   meson-gxl-s905x-p212.dtb<br>110   s905x      TBee                                meson-gxl-s905x-tbee.dtb<br>--------------------------------------------------------------------------------------<br>111   s905w      TX3-Mini                            meson-gxl-s905w-tx3-mini.dtb<br>112   s905w      W95                                 meson-gxl-s905w-p281.dtb<br>113   s905w      X96-Mini                            meson-gxl-s905w-x96-mini.dtb<br>114   s905w      X96W,FunTV,MXQ-Pro-4K               meson-gxl-s905w-x96w.dtb<br>115   s905l      UNT402A,M201-S,MiBox-4C             meson-gxl-s905l3b-m302a.dtb<br>116   s905l      MG101,Mibox-4                       meson-gxl-s905l-venz-v10.dtb<br>117   s905l2     MGV2000,MGV3000,M301A,CM201-1       meson-gxl-s905l2-x7-5g.dtb<br>118   s905l2     E900v21E,MGV2000-K,e900v21d         meson-gxl-s905l2-x7-5g.dtb<br>119   s905l2     Wojia-TV-IPBS9505                   meson-gxl-s905l2-ipbs9505.dtb<br>120   s905l3     CM311-1,HG680-LC,M401A,UNT402A      meson-gxl-s905l2-x7-5g.dtb<br>--------------------------------------------------------------------------------------<br>121   s905l3     CM211-1,M411A,B860AV3.2-M           meson-gxl-s905l3b-m302a.dtb<br>122   s905l3     UNT400G1,E900V22D-2                 meson-gxl-s905l2-x7-5g.dtb<br>123   s905l3b    E900V22D,TY1608                     meson-gxl-s905l2-x7-5g.dtb<br>124   s905l3b    E900V21E,E900V22E,MGV2000           meson-gxl-s905l3b-e900v22e.dtb<br>125   s905l3b    M302A,M304A,CM201-1,CM211-1,CM311-1 meson-gxl-s905l3b-m302a.dtb<br>126   s905l3b    UNT403A                             meson-gxl-s905l3b-m302a.dtb<br>127   s905l3b    RG020ET-CA                          meson-gxl-s905l3b-e900v22e.dtb<br>128   s905l3b    IP103H,TY1608,BV310,B860AV-2.1M     meson-gxl-s905l3b-m302a.dtb<br>129   s905lb     BesTV-R3300L,SumaVision-Q7,MG101    meson-gxl-s905x-p212.dtb<br>130   s905lb     Q96-mini                            meson-gxl-s905x-p212.dtb<br>--------------------------------------------------------------------------------------<br>131   s905mb     S65                                 meson-gxl-s905x-p212.dtb<br>0     Other      Customize                           Enter-custom-dtb-name<br>--------------------------------------------------------------------------------------<br>[ OPTIONS ] Please Input ID: 101<br>[ INFO ] Input Box ID: [ 101 ]<br>[ INFO ] Model Name: [ Phicomm-N1 ]<br>[ INFO ] FDTFILE: [ meson-gxl-s905d-phicomm-n1.dtb ]<br>[ INFO ] MAINLINE_UBOOT: [  ]<br>[ INFO ] BOOTLOADER_IMG:  [ u-boot-2015-phicomm-n1.bin ]<br>[ INFO ] UBOOT_OVERLOAD: [ u-boot-n1.bin ]<br>[ INFO ] NEED_OVERLOAD: [ no ]<br>[ STEPS ] Which <span class="hljs-built_in">type</span> of filesystem <span class="hljs-keyword">do</span> you want <span class="hljs-keyword">for</span> your root?<br>-----------------------------------------------<br>  ID   TYPE<br>-----------------------------------------------<br>  1    ext4<br>  2    btrfs<br>-----------------------------------------------<br>[ OPTIONS ] Please Input ID (1/2): 1<br>[ INFO ] Input Type ID: [ 1 ]<br>[ INFO ] Type of filesystem: [ ext4 ]<br>[ STEPS ] Partitioning eMMC...<br>[ INFO ] Start backing up the default bootloader.<br>4+0 records <span class="hljs-keyword">in</span><br>4+0 records out<br>4194304 bytes (4.2 MB, 4.0 MiB) copied, 2.19803 s, 1.9 MB/s<br>[ INFO ] Delete the existing [ 2 ] partitions.<br>[ INFO ] Start create MBR and partittion.<br>[ INFO ] 02. Write Android bootloader: [ u-boot-2015-phicomm-n1.bin ]<br>444+0 records <span class="hljs-keyword">in</span><br>444+0 records out<br>444 bytes copied, 0.00781175 s, 56.8 kB/s<br>8191+0 records <span class="hljs-keyword">in</span><br>8191+0 records out<br>4193792 bytes (4.2 MB, 4.0 MiB) copied, 0.450597 s, 9.3 MB/s<br>[ STEPS ] Processing BOOTFS partition...<br>[ INFO ] Formatting BOOTFS partition...<br>mkfs.fat 4.2 (2021-01-31)<br>[ INFO ] Copying BOOTFS ...<br>[ INFO ] Update the [ uEnv.txt ] file.<br>[ STEPS ] Start processing the rootfs partition...<br>[ INFO ] Formatting ROOTFS ...<br>/dev/mmcblk2p2 contains a btrfs file system labelled <span class="hljs-string">&#x27;ROOTFS_EMMC&#x27;</span><br>[ INFO ] Copying ROOTFS ...<br>[ INFO ] Copying [ etc ] ...<br>[ INFO ] Copying [ home ] ...<br>[ INFO ] Copying [ opt ] ...<br>[ INFO ] Copying [ root ] ...<br>[ INFO ] Copying [ selinux ] ...<br>[ INFO ] Copying [ srv ] ...<br>[ INFO ] Copying [ usr ] ...<br>[ INFO ] Copying [ var ] ...<br>[ INFO ] Generate the new fstab file.<br>[ INFO ] Update the relevant parameters.<br>[ SUCCESS ] Installation successful. Run [ poweroff ], remove the installation media <span class="hljs-keyword">then</span> re-insert the power supply to boot new system.<br></code></pre></td></tr></table></figure><p><strong>七、Armbian 的简单设置</strong></p><p>1、将 armbian 的更新源修改为清华源</p><p>　　Armbian 操作系统默认使用的官方更新源（ports.ubuntu.com）服务器在海外，连接速度和国内镜像源比起来较慢，建议修改为清华大学提供的镜像源。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">armbian-apt<br></code></pre></td></tr></table></figure><p>更新本机已安装的软件包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update<br>apt upgrade -y<br></code></pre></td></tr></table></figure><p>2、修改时区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 系统时间和时区</span><br><span class="hljs-built_in">date</span> -R<br><br><span class="hljs-comment"># 修改时区，使用 tzselect 命令，然后选择 asia china beijing yes。</span><br>tzselect<br><span class="hljs-built_in">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<br><br><span class="hljs-comment"># 再次查询系统时间和时区</span><br><span class="hljs-built_in">date</span> -R<br></code></pre></td></tr></table></figure><p>安装显示服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install xorg<br></code></pre></td></tr></table></figure><p>安装xfce</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">apt install <span class="hljs-keyword">task</span>-xfce-desktop<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> xfce4 xfce4-goodies -y<br></code></pre></td></tr></table></figure><p>安装显示管理器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install lightdm lightdm-gtk-greeter lightdm-gtk-greeter-settings<br></code></pre></td></tr></table></figure><p>启动显示管理器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> lightdm<br><span class="hljs-built_in">sudo</span> systemctl start lightdm<br></code></pre></td></tr></table></figure><p>安装音量管理器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install pulseaudio<br></code></pre></td></tr></table></figure><p>安装浏览器</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> firefox-esr<br></code></pre></td></tr></table></figure><p>或</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> chromium -y<br></code></pre></td></tr></table></figure><p>远程软件</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">apt install remmina remmina-<span class="hljs-keyword">plugin</span>-vnc remmina-<span class="hljs-keyword">plugin</span>-rdp<br></code></pre></td></tr></table></figure><p>蓝牙管理器</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> blueman<br></code></pre></td></tr></table></figure><p>网络管理器</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">apt <span class="hljs-keyword">install</span> nm-connection-editor<br></code></pre></td></tr></table></figure><p>也可以使用nmtui配置网络</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">nmtui</span><br></code></pre></td></tr></table></figure><p>中文字体</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-built_in">get</span> install fonts-wqy-zenhei<br></code></pre></td></tr></table></figure><p> 设置系统语言为中文桌面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> dpkg-reconfigure locales<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo update-locale <span class="hljs-attribute">LANG</span>=zh_CN.UTF-8 <span class="hljs-attribute">LC_ALL</span>=zh_CN.UTF-8<br></code></pre></td></tr></table></figure><p>编辑 <code>/etc/default/locale</code>，确保内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">LANG=zh_CN.UTF-8<br>LC_ALL=zh_CN.UTF-8<br></code></pre></td></tr></table></figure><p><strong>远程桌面</strong></p><p>安装vnc server</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">apt-<span class="hljs-built_in">get</span> install tightvncserver<br></code></pre></td></tr></table></figure><p>在root或者普通用户下执行</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">/usr/bin/vncserver -depth <span class="hljs-number">24</span> -<span class="hljs-built_in">geometry</span> <span class="hljs-number">1920</span>x1080 :<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p> 设置密码</p><p>然后修改启动脚本</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">vim /etc/rc.<span class="hljs-keyword">local</span><br></code></pre></td></tr></table></figure><p>添加以下内容</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">su - yourusername -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;/usr/bin/vncserver -depth 24 -geometry 1920x1080 :1 &amp;&quot;</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/ophub/amlogic-s9xxx-armbian/issues/802#top">Phicomm-n1刷入后lightdm无法正常启动</a></p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">cat</span> &lt;&lt; <span class="hljs-string">&#x27;_EOF_&#x27;</span> &gt; /etc/<span class="hljs-built_in">X11</span>/xorg.conf.d/<span class="hljs-number">02</span>-dietpi-aml-s905.conf<br><span class="hljs-symbol">Section</span> <span class="hljs-string">&quot;OutputClass&quot;</span><br>    Identifier <span class="hljs-string">&quot;Amlogic&quot;</span><br>    MatchDriver <span class="hljs-string">&quot;meson&quot;</span><br>    Driver <span class="hljs-string">&quot;modesetting&quot;</span><br>    Option <span class="hljs-string">&quot;PrimaryGPU&quot;</span> <span class="hljs-string">&quot;true&quot;</span><br><span class="hljs-symbol">EndSection</span><br><span class="hljs-symbol">Section</span> <span class="hljs-string">&quot;Screen&quot;</span><br>    Identifier <span class="hljs-string">&quot;Default Screen&quot;</span><br>    Device <span class="hljs-string">&quot;Meson&quot;</span><br>    Monitor <span class="hljs-string">&quot;foo&quot;</span><br>    DefaultDepth <span class="hljs-number">24</span><br>    SubSection <span class="hljs-string">&quot;Display&quot;</span><br>        Depth <span class="hljs-number">24</span><br>        Modes <span class="hljs-string">&quot;1920x1080&quot;</span> <span class="hljs-string">&quot;1440x900&quot;</span> <span class="hljs-string">&quot;1280x720&quot;</span> <span class="hljs-string">&quot;1280x1024&quot;</span> <span class="hljs-string">&quot;1280x960&quot;</span> <span class="hljs-string">&quot;1024x768&quot;</span> <span class="hljs-string">&quot;800x600&quot;</span> <span class="hljs-string">&quot;640x480&quot;</span> <span class="hljs-string">&quot;720x400&quot;</span><br>    EndSubSection<br><span class="hljs-symbol">EndSection</span><br><span class="hljs-symbol">_EOF_</span><br></code></pre></td></tr></table></figure><p>如果还不行的话：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs none">apt install accountsservice<br>mkdir /var/lib/lightdm/data<br>chmod 775 /var/lib/lightdm/data<br></code></pre></td></tr></table></figure><p><strong>八、从 Armbian 刷到 Android 固件</strong></p><p>1、在电脑上下载并安装“3.USB_Burning_Tools_v2.0.7.2_build2.exe”烧录软件，同时下载并解压 android 固件“5.N1_mod_by_webpad_v2.2_20180920.img.7z”备用。</p><p>2、运行 USB_Burning_tools 软件，如下图所示，选择 android 固件后，去掉“擦除flash”和“擦除bootloader”前的对勾，然后点击“开始”按钮，将晶晨短接神器插在 HDMI 接口上，USB双公头线插到靠近 HDMI 接口的 USB 口上，然后给 N1 盒子接上电源，这时软件就识别到了 N1 盒子，开始写入固件。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740113513927.webp" alt="8.N1线刷 Android 系统_1.webp"></p><p>3、大约等待 3~4 分钟，会提示“100%：烧录成功”，这时先点击“停止”按钮，关闭烧录软件，然后拔掉 USB 线，拔掉电源后再次开机就进入了 android 系统。</p><p><img src="https://www.hicairo.com/zb_users/upload/2024/05/202405031714740129381098.webp" alt="8.N1线刷 Android 系统_2.webp"></p><hr><p>参考：<br><a href="https://www.hicairo.com/post/75.html">https://www.hicairo.com/post/75.html</a></p><p><a href="https://www.erballoon.vip/2023/03/14/armbianazxfcezmjqtdyxsz/">Armbian安装xfce桌面及其他的一些设置</a></p><p><a href="https://github.com/ophub/amlogic-s9xxx-armbian/releases/">https://github.com/ophub/amlogic-s9xxx-armbian/releases/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;PHICOMM N1 盒子已经上市很多年了，虽然是一个矿渣产品，但是其优异的硬件配置，丰富的固件适配，目前还被广泛使用。在此首先对 webpad 等几位大佬致敬，由于他们的分享，使得很多人可以很方便的在 N1 盒子上实现自己所需的功能。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一、斐</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="N1" scheme="https://blog.quickso.cn/tags/N1/"/>
    
    <category term="Linux" scheme="https://blog.quickso.cn/tags/Linux/"/>
    
    <category term="Armbian" scheme="https://blog.quickso.cn/tags/Armbian/"/>
    
  </entry>
  
  <entry>
    <title>用树莓派搭建Minecraft服务器</title>
    <link href="https://blog.quickso.cn/2025/06/28/%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E6%90%AD%E5%BB%BAMinecraft%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <id>https://blog.quickso.cn/2025/06/28/%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E6%90%AD%E5%BB%BAMinecraft%E6%9C%8D%E5%8A%A1%E5%99%A8/</id>
    <published>2025-06-28T01:16:08.000Z</published>
    <updated>2026-02-06T13:40:34.783Z</updated>
    
    <content type="html"><![CDATA[<h3 id="为什么要折腾这个？"><a href="#为什么要折腾这个？" class="headerlink" title="为什么要折腾这个？"></a>为什么要折腾这个？</h3><p>为什么要自己搭Minecraft服务器呢？因为在自己的服务器上玩Minecraft，你可以让服务器一直运行，当你不玩的时候，你的朋友和家人还可以加入到游戏中，继续建造你的世界。你可以尝试修改游戏参数，制作mod，而且还能让你体验一把上帝的感觉，这在公共服务器里可是做不到的，而且也不用花很多钱去租远程主机来做服务器。</p><p>对于Minecraft狂热粉丝而言，搭建Minecraft服务器已经很有吸引力了。但是在树莓派上搭则会更有吸引力。小小的树莓派耗电非常少，你可以不间断地开着服务器，一年的电费也不过几块钱而已。只要一个树莓派，一张SD卡，花上一点时间设置一下，就能有一台全天候的Minecraft服务器。</p><h3 id="一、前期准备"><a href="#一、前期准备" class="headerlink" title="一、前期准备"></a><strong>一、前期准备</strong></h3><ol><li><strong>系统要求</strong><ul><li>树莓派3B（1GB内存）</li><li>推荐系统：Raspberry Pi OS Lite（64位）</li><li>至少16GB存储（建议使用SSD&#x2F;USB3.0硬盘，避免SD卡损坏）</li><li>稳定电源和散热风扇</li></ul></li></ol><h3 id="二、安装Java环境"><a href="#二、安装Java环境" class="headerlink" title="二、安装Java环境"></a><strong>二、安装Java环境</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装适合ARM的Java 17（轻量级）</span><br><span class="hljs-built_in">sudo</span> apt update<br><span class="hljs-built_in">sudo</span> apt install openjdk-17-jdk-headless -y<br><br><span class="hljs-comment"># Java 21</span><br>wget https://download.bell-sw.com/java/21.0.7+9/bellsoft-jdk21.0.7+9-linux-aarch64-lite.deb<br><span class="hljs-built_in">sudo</span> dpkg -i bellsoft-jdk21.0.7+9-linux-aarch64-lite.deb<br>apt --fix-broken install<br><span class="hljs-built_in">sudo</span> update-alternatives --config java<br><br><span class="hljs-comment"># 验证安装</span><br>java -version  <span class="hljs-comment"># 应显示 &quot;OpenJDK 64-Bit Server VM&quot;</span><br></code></pre></td></tr></table></figure><h3 id="三、安装PaperMC服务器"><a href="#三、安装PaperMC服务器" class="headerlink" title="三、安装PaperMC服务器"></a><strong>三、安装PaperMC服务器</strong></h3><p><strong>创建专用用户</strong>（提升安全性）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> useradd -m -s /bin/bash minecraft<br><span class="hljs-built_in">sudo</span> passwd minecraft<br></code></pre></td></tr></table></figure><p><strong>下载Paper服务端</strong></p><p><a href="https://papermc.io/downloads/paper">https://papermc.io/downloads/paper</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> su - minecraft<br><span class="hljs-built_in">mkdir</span> ~/server &amp;&amp; <span class="hljs-built_in">cd</span> ~/server<br>wget https://fill-data.papermc.io/v1/objects/bfca155b4a6b45644bfc1766f4e02a83c736e45fcc060e8788c71d6e7b3d56f6/paper-1.21.6-46.jar<br></code></pre></td></tr></table></figure><p><strong>首次启动生成配置</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">java </span>-Xms256M -Xmx768M -<span class="hljs-keyword">jar </span>paper.<span class="hljs-keyword">jar </span>--nogui<br><span class="hljs-comment"># 首次启动后会停止，编辑 eula.txt</span><br>echo <span class="hljs-string">&quot;eula=true&quot;</span> &gt; eula.txt<br></code></pre></td></tr></table></figure><h3 id="四、内存优化配置"><a href="#四、内存优化配置" class="headerlink" title="四、内存优化配置"></a><strong>四、内存优化配置</strong></h3><p>编辑 <code>~/server/start.sh</code>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">nano ~<span class="hljs-regexp">/server/</span>start.sh<br><br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment"># 使用Aikar&#x27;s Flags（针对低内存设备优化）</span><br>JAVA_ARGS=<span class="hljs-string">&quot;-Xms256M -Xmx768M -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:+PerfDisableSharedMem -XX:MaxTenuringThreshold=1&quot;</span><br><br>java <span class="hljs-variable">$JAVA_ARGS</span> -jar paper.jar --nogui<br></code></pre></td></tr></table></figure><p><strong>关键参数说明</strong></p><ul><li><code>-Xmx768M</code>：最大内存768MB（为系统保留256MB）</li><li><code>G1GC</code>：低延迟垃圾回收器</li><li><code>MaxGCPauseMillis=200</code>：控制GC停顿时间</li><li><code>AlwaysPreTouch</code>：启动时分配内存，减少运行时延迟</li></ul><p>加上权限(root下)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> 755 start.sh<br></code></pre></td></tr></table></figure><h3 id="五、创建Systemd服务（持久化-自动重启）"><a href="#五、创建Systemd服务（持久化-自动重启）" class="headerlink" title="五、创建Systemd服务（持久化+自动重启）"></a><strong>五、创建Systemd服务（持久化+自动重启）</strong></h3><ol><li><strong>创建服务文件</strong></li></ol><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo nano <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/mi</span>necraft.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Minecraft Paper Server<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">User</span>=minecraft<br><span class="hljs-attr">WorkingDirectory</span>=/home/minecraft/server<br><span class="hljs-attr">ExecStart</span>=/bin/bash start.sh<br><span class="hljs-attr">Restart</span>=always<br><span class="hljs-attr">RestartSec</span>=<span class="hljs-number">5</span><br><span class="hljs-comment"># 内存保护（防止树莓派崩溃）</span><br><span class="hljs-attr">MemoryMax</span>=<span class="hljs-number">800</span>M<br><span class="hljs-attr">MemorySwapMax</span>=<span class="hljs-number">0</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p><strong>启用服务</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl daemon-reload<br><span class="hljs-built_in">sudo</span> systemctl start minecraft<br><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> minecraft<br></code></pre></td></tr></table></figure><h3 id="管理命令"><a href="#管理命令" class="headerlink" title="管理命令"></a><strong>管理命令</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看服务器状态</span><br><span class="hljs-built_in">sudo</span> systemctl status minecraft<br><br><span class="hljs-comment"># 重启服务器</span><br><span class="hljs-built_in">sudo</span> systemctl restart minecraft<br><br><span class="hljs-comment"># 查看实时日志</span><br>journalctl -u minecraft -f<br></code></pre></td></tr></table></figure><h3 id="玩家连接"><a href="#玩家连接" class="headerlink" title="玩家连接"></a><strong>玩家连接</strong></h3><ol><li>获取树莓派IP：<code>hostname -I</code></li><li>客户端连接地址：<code>树莓派IP:25565</code></li></ol><p>通过这样配置，即使在1GB内存下也能稳定运行轻量级生存服务器。建议每两周重启一次服务释放内存碎片。</p><p>这种只适合折腾，正式开服还是用游戏服吧~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;为什么要折腾这个？&quot;&gt;&lt;a href=&quot;#为什么要折腾这个？&quot; class=&quot;headerlink&quot; title=&quot;为什么要折腾这个？&quot;&gt;&lt;/a&gt;为什么要折腾这个？&lt;/h3&gt;&lt;p&gt;为什么要自己搭Minecraft服务器呢？因为在自己的服务器上玩Minecraft，</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Minecraft" scheme="https://blog.quickso.cn/tags/Minecraft/"/>
    
    <category term="我的世界" scheme="https://blog.quickso.cn/tags/%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C/"/>
    
    <category term="树莓派" scheme="https://blog.quickso.cn/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"/>
    
  </entry>
  
  <entry>
    <title>zabbix使用docker-compose部署和配置</title>
    <link href="https://blog.quickso.cn/2025/06/14/zabbix%E4%BD%BF%E7%94%A8docker-compose%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
    <id>https://blog.quickso.cn/2025/06/14/zabbix%E4%BD%BF%E7%94%A8docker-compose%E9%83%A8%E7%BD%B2%E5%92%8C%E9%85%8D%E7%BD%AE/</id>
    <published>2025-06-14T05:13:02.000Z</published>
    <updated>2026-02-06T13:40:34.773Z</updated>
    
    <content type="html"><![CDATA[<p><strong>zabbix</strong>是一款知名的老牌监控系统，可对硬件、操作系统、数据库、网络等多种目标介质进行统一监控，并集成了UI、监控展示、告警、服务发现等多种功能，可非常高效地进行监控工作。</p><p>zabbi本身的使用非常广泛，但由于产品涉及较多组件，安装的过程往往较为麻烦，需要花费不少时间进行部署调试。对此，本文将介绍如何基于docker容器的方式，快速搭建最新版本的zabbix监控平台，解决大家在安装部署上的痛点。</p><p><img src="https://assets.zabbix.com/img/logo/zabbix_20years.svg"></p><p>官方网站：</p><p><a href="https://www.zabbix.com/cn/">https://www.zabbix.com/cn/</a></p><p>Zabbix 使用手册</p><p><a href="https://www.zabbix.com/documentation/7.0/zh/manual">https://www.zabbix.com/documentation/7.0/zh/manual</a></p><h2 id="zabbix架构信息"><a href="#zabbix架构信息" class="headerlink" title="zabbix架构信息"></a><strong>zabbix架构信息</strong></h2><p>核心架构包括以下几个部分：</p><ol><li>Zabbix Server：Zabbix Server是整个监控系统的核心组件，负责接收和处理来自Zabbix Agent的监控数据。Zabbix Server可以通过多种方式收集数据，如SNMP、IPMI、SSH等。收集到的数据会存储在Zabbix数据库中，供后续处理和分析。</li><li>Zabbix Agent：Zabbix Agent是安装在被监控主机上的软件，负责收集并提供监控数据。Zabbix Agent可以运行在各种操作系统上，支持多种编程语言。Agent会定期将监控数据发送给Zabbix Server，以确保监控数据的实时性和准确性。</li><li>Zabbix Web界面：Zabbix Web界面是一个基于Java的Web应用程序，用于展示和管理监控数据。通过Zabbix Web界面，用户可以轻松查看实时监控数据、历史趋势、报警信息等。此外，Zabbix Web界面还提供了丰富的报告和统计功能，方便用户分析和诊断系统性能。</li><li>Zabbix API：Zabbix API是一个RESTful风格的接口，允许外部程序和脚本访问Zabbix Server的数据和功能。通过Zabbix API，您可以实现自动化操作、数据集成和其他定制功能。</li><li>数据库：Zabbix使用MySQL或PostgreSQL数据库存储监控数据、配置信息和报警历史等。数据库服务器可以是本地或远程的，以便于扩展和备份。</li><li>报警和通知：Zabbix支持多种报警方式，如邮件、SMS、即时通讯等。当监控项触发报警条件时，Zabbix Server会将报警信息发送给指定的用户或团队。此外，Zabbix还支持通知渠道的聚合和重试，以确保报警信息的及时传递。</li><li>插件和扩展：Zabbix具有良好的扩展性，通过丰富的插件和扩展模块，可以实现对各种设备和协议的监控。此外，Zabbix社区不断推出新功能和优化性能，使得Zabbix适用于更多场景。</li></ol><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-1.png"></p><h2 id="安装Docker-Docker-Compose"><a href="#安装Docker-Docker-Compose" class="headerlink" title="安装Docker&amp;Docker Compose"></a>安装Docker&amp;Docker Compose</h2><p>参考 <a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn</a></p><h2 id="安装服务端"><a href="#安装服务端" class="headerlink" title="安装服务端"></a>安装服务端</h2><p>Zabbix 提供了用于在 Docker 中定义和运行多容器 Zabbix 组件的 compose 文件。 这些 compose 文件可以在  <a href="https://github.com/zabbix/zabbix-docker">https://github.com/zabbix/zabbix-docker</a> 上的 Zabbix docker 官方仓库中找到。</p><p>以下为几个不同版本的 compose 文件：</p><table><thead><tr><th><strong>文件名</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>docker-compose_v3_alpine_mysql_latest.yaml</code></td><td>该 compose 文件运行基于 Alpine Linux 的 Zabbix 5.4 最新版本的组件，支持 MySQL 数据库。</td></tr><tr><td><code>docker-compose_v3_alpine_mysql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 Alpine Linux 的 Zabbix 5.4 最新版本的组件，支持 MySQL数据库。</td></tr><tr><td><code>docker-compose_v3_alpine_pgsql_latest.yaml</code></td><td>该 compose 文件运行基于 Alpine Linux 的 Zabbix 5.4 最新版本的组件，支持 PostgreSQL 数据库。</td></tr><tr><td><code>docker-compose_v3_alpine_pgsql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 Apline Linux 的 Zabbix 5.4 最新版本的组件，支持 PostgreSQL 数据库。</td></tr><tr><td><code>docker-compose_v3_centos_mysql_latest.yaml</code></td><td>该 compose 文件运行基于 CentOS 8 的 Zabbix 5.4 最新版本的组件，支持 MySQL 数据库。</td></tr><tr><td><code>docker-compose_v3_centos_mysql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 CentOS 8 的 Zabbix 5.4 最新版本的组件，支持 MySQL 数据库。</td></tr><tr><td><code>docker-compose_v3_centos_pgsql_latest.yaml</code></td><td>该 compose 文件运行基于 CentOS 8 的 Zabbix 5.4 最新版本的组件，支持 PostgreSQL 数据库。</td></tr><tr><td><code>docker-compose_v3_centos_pgsql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 CentOS 8 的 Zabbix 5.4 最新版本的组件，支持 PostgreSQL 数据库。</td></tr><tr><td><code>docker-compose_v3_ubuntu_mysql_latest.yaml</code></td><td>该 compose 文件运行基于 Ubuntu 20.04 的 Zabbix 5.4 最新版本的组件，支持 MySQL 数据库。</td></tr><tr><td><code>docker-compose_v3_ubuntu_mysql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 Ubuntu 20.04 的 Zabbix 5.4 最新版本的组件，支持 MySQL 数据库。</td></tr><tr><td><code>docker-compose_v3_ubuntu_pgsql_latest.yaml</code></td><td>该 compose 文件运行基于 Ubuntu 20.04 的 Zabbix 5.4 最新版本的组件，支持 PostgreSQL 数据库。</td></tr><tr><td><code>docker-compose_v3_ubuntu_pgsql_local.yaml</code></td><td>该 compose 文件本地构建和运行基于 Ubuntu 20.04 的 Zabbix 5.4 最新版本的组件，支持 PosegreSQL 数据库。</td></tr></tbody></table><blockquote><p>[!NOTE]</p><p>Docker compose 文件支持 Docker Compose 3 版本。</p></blockquote><p>本次我们使用<code>docker-compose_v3_alpine_mysql_latest.yaml</code>文件部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/zabbix/zabbix-docker.git<br><span class="hljs-built_in">cd</span> zabbix-docker<br></code></pre></td></tr></table></figure><p>栗子：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建存放位置</span><br><span class="hljs-built_in">mkdir</span> -p /data/zabbix &amp;&amp; <span class="hljs-built_in">cd</span> /data/zabbix<br><span class="hljs-built_in">touch</span> docker-compose.yml<br> <br><span class="hljs-built_in">cat</span> &gt; docker-compose.yml &lt;&lt; <span class="hljs-string">EOF</span><br><span class="hljs-string"> </span><br><span class="hljs-string">version: &#x27;3&#x27;</span><br><span class="hljs-string"> </span><br><span class="hljs-string">services:</span><br><span class="hljs-string">  zabbix-web-nginx-mysql:</span><br><span class="hljs-string">    image: zabbix/zabbix-web-nginx-mysql:centos-5.2-latest</span><br><span class="hljs-string">    restart: always</span><br><span class="hljs-string">    environment:</span><br><span class="hljs-string">      - DB_SERVER_HOST=zabbix-mysql</span><br><span class="hljs-string">      - MYSQL_DATABASE=zabbix</span><br><span class="hljs-string">      - MYSQL_USER=zabbix</span><br><span class="hljs-string">      - MYSQL_PASSWORD=zabbix</span><br><span class="hljs-string">      - MYSQL_ROOT_PASSWORD=123456</span><br><span class="hljs-string">      - ZBX_SERVER_HOST=zabbix-server-mysql</span><br><span class="hljs-string">    ports:</span><br><span class="hljs-string">      - 8080:8080</span><br><span class="hljs-string">    volumes:</span><br><span class="hljs-string">      - /etc/localtime:/etc/localtime</span><br><span class="hljs-string">      - /data/zabbix/fonts/DejaVuSans.ttf:/usr/share/zabbix/assets/fonts/DejaVuSans.ttf</span><br><span class="hljs-string">    networks:</span><br><span class="hljs-string">      - zbx_net</span><br><span class="hljs-string">    depends_on:</span><br><span class="hljs-string">      - zabbix-server-mysql</span><br><span class="hljs-string">      - zabbix-mysql</span><br><span class="hljs-string">  zabbix-mysql:</span><br><span class="hljs-string">    image: mysql:8.0.23</span><br><span class="hljs-string">    restart: always</span><br><span class="hljs-string">    ports:</span><br><span class="hljs-string">      - 3306:3306</span><br><span class="hljs-string">    environment:</span><br><span class="hljs-string">      - MYSQL_DATABASE=zabbix</span><br><span class="hljs-string">      - MYSQL_USER=zabbix</span><br><span class="hljs-string">      - MYSQL_PASSWORD=zabbix</span><br><span class="hljs-string">      - MYSQL_ROOT_PASSWORD=123456</span><br><span class="hljs-string">    command:</span><br><span class="hljs-string">      - mysqld</span><br><span class="hljs-string">      - --default-authentication-plugin=mysql_native_password</span><br><span class="hljs-string">      - --character-set-server=utf8</span><br><span class="hljs-string">      - --collation-server=utf8_bin</span><br><span class="hljs-string">    volumes:</span><br><span class="hljs-string">      - /etc/localtime:/etc/localtime</span><br><span class="hljs-string">      - /data/zabbix/db:/var/lib/mysql</span><br><span class="hljs-string">    networks:</span><br><span class="hljs-string">      - zbx_net</span><br><span class="hljs-string">  zabbix-java-gateway:</span><br><span class="hljs-string">    image: zabbix/zabbix-java-gateway:centos-5.2-latest</span><br><span class="hljs-string">    restart: always</span><br><span class="hljs-string">    volumes:</span><br><span class="hljs-string">      - /etc/localtime:/etc/localtime</span><br><span class="hljs-string">    networks:</span><br><span class="hljs-string">      - zbx_net</span><br><span class="hljs-string">  zabbix-server-mysql:</span><br><span class="hljs-string">    image: zabbix/zabbix-server-mysql:centos-5.2-latest</span><br><span class="hljs-string">    restart: always</span><br><span class="hljs-string">    volumes:</span><br><span class="hljs-string">      - zabbix-server-vol:/etc/zabbix</span><br><span class="hljs-string">      - /data/zabbix/alertscripts:/usr/lib/zabbix/alertscripts</span><br><span class="hljs-string">      - /etc/localtime:/etc/localtime</span><br><span class="hljs-string">      - /data/zabbix/config:/etc/zabbix/</span><br><span class="hljs-string">    ports:</span><br><span class="hljs-string">      - 10051:10051</span><br><span class="hljs-string">    environment:</span><br><span class="hljs-string">      - DB_SERVER_HOST=zabbix-mysql</span><br><span class="hljs-string">      - MYSQL_DATABASE=zabbix</span><br><span class="hljs-string">      - MYSQL_USER=zabbix</span><br><span class="hljs-string">      - MYSQL_PASSWORD=zabbix</span><br><span class="hljs-string">      - MYSQL_ROOT_PASSWORD=123456</span><br><span class="hljs-string">      - ZBX_JAVAGATEWAY=zabbix-java-gateway</span><br><span class="hljs-string">      - ZBX_JAVAGATEWAY_ENABLE=true</span><br><span class="hljs-string">      - ZBX_JAVAGATEWAYPORT=10052</span><br><span class="hljs-string">    depends_on:</span><br><span class="hljs-string">      - zabbix-mysql</span><br><span class="hljs-string">    networks:</span><br><span class="hljs-string">      - zbx_net</span><br><span class="hljs-string">  zabbix-agent:</span><br><span class="hljs-string">    image: zabbix/zabbix-agent:centos-5.2-latest</span><br><span class="hljs-string">    restart: always</span><br><span class="hljs-string">    ports:</span><br><span class="hljs-string">      - 10050:10050</span><br><span class="hljs-string">    environment:</span><br><span class="hljs-string">      - ZBX_HOSTNAME=Zabbix server</span><br><span class="hljs-string">      - ZBX_SERVER_HOST=zabbix-server-mysql</span><br><span class="hljs-string">      - ZBX_SERVER_PORT=10051</span><br><span class="hljs-string">    networks:</span><br><span class="hljs-string">      - zbx_net</span><br><span class="hljs-string"> </span><br><span class="hljs-string">networks:</span><br><span class="hljs-string">  zbx_net:</span><br><span class="hljs-string">    driver: bridge</span><br><span class="hljs-string"> </span><br><span class="hljs-string">volumes:</span><br><span class="hljs-string">  zabbix-server-vol:</span><br><span class="hljs-string"> </span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 在docker-compose.yml文件目录中运行</span><br>docker-compose up -d <br><br><span class="hljs-comment"># 查看容器运行日志</span><br>docker-compose logs -f <br><br><span class="hljs-comment"># 查看容器运行状态</span><br>docker-compose up <br><br><span class="hljs-comment"># 查看容器启动的进程</span><br>docker-compose top<br></code></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>访问测试</p><p><a href="http://ip/">http://ip:80</a></p><p>默认认证信息</p><ul><li>用户名Admin</li><li>密码zabbix</li></ul><h2 id="安装agent（客户端）"><a href="#安装agent（客户端）" class="headerlink" title="安装agent（客户端）"></a><strong>安装agent</strong>（客户端）</h2><p>zabbix agent部署较为简单，你可以使用docker，也可以使用Yum、二进制包等方式安装，此处演示基于docker的安装方式。</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livescript">$ docker run --name zabbix-agent -t <span class="hljs-string">\</span><br>      -v zabbix_agent:/etc/zabbix <span class="hljs-string">\</span><br>      -e ZBX_HOSTNAME=<span class="hljs-string">&quot;host-01&quot;</span> <span class="hljs-string">\</span><br>      -e ZBX_SERVER_HOST=<span class="hljs-string">&quot;192.168.214.112&quot;</span> <span class="hljs-string">\</span> <br>      -e ZBX_SERVER_PORT=<span class="hljs-number">10051</span> <span class="hljs-string">\</span><br>      -p <span class="hljs-number">10050</span>:<span class="hljs-number">10050</span> <span class="hljs-string">\</span><br>      --restart=<span class="hljs-keyword">unless</span>-stopped <span class="hljs-string">\</span><br>      --privileged <span class="hljs-string">\</span><br>      -d zabbix/zabbix-agent:alpine-<span class="hljs-number">6.2</span>-latest<br></code></pre></td></tr></table></figure><blockquote><p>[!NOTE]</p><p>如果是部署在zabbix Server主机上的监控agent，此时的ZBX_SERVER_HOST需改为zabbix server的容器IP，而不能用主机IP。</p></blockquote><h3 id="添加主机"><a href="#添加主机" class="headerlink" title="添加主机"></a><strong>添加主机</strong></h3><p>在目标主机安装好agnt后，即可以在zabbix server端配置相关的主机监控。</p><ol><li>点击”Create host”,创建新的主机配置。</li></ol><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/fdc0bcc338bef783e9282b03874eca90.png" alt="img"></p><ol start="2"><li>配置完成后，静待一会可看到监控目标生效。</li></ol><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/bfdf8686607f527f454cfdcc7d22b150.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;zabbix&lt;/strong&gt;是一款知名的老牌监控系统，可对硬件、操作系统、数据库、网络等多种目标介质进行统一监控，并集成了UI、监控展示、告警、服务发现等多种功能，可非常高效地进行监控工作。&lt;/p&gt;
&lt;p&gt;zabbi本身的使用非常广泛，但由于产品涉及较多组</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Zabbix" scheme="https://blog.quickso.cn/tags/Zabbix/"/>
    
    <category term="运维" scheme="https://blog.quickso.cn/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="监控" scheme="https://blog.quickso.cn/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>去中心化异地组网工具Easytier搭建与使用</title>
    <link href="https://blog.quickso.cn/2025/05/26/%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E5%B7%A5%E5%85%B7Easytier%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>https://blog.quickso.cn/2025/05/26/%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E5%B7%A5%E5%85%B7Easytier%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/</id>
    <published>2025-05-26T15:16:20.000Z</published>
    <updated>2026-02-06T13:40:34.776Z</updated>
    
    <content type="html"><![CDATA[<p>自从开始玩NAS以来，就一直关注怎样用便宜和快速的解决异地组网的问题。</p><ul><li>公网IPv6，有但是不想公开</li><li>公网IPv4，更加不敢奢求</li><li>各种收费内网工具cpolar、passnat、樱花frp感觉有点贵，免费的又不够用</li><li>frp必须要有个中转，便宜的有公网IP的云服务器不是小水管就是限流量</li><li>zerotier、tailscale的服务器都在国外，连上PVN的P2P的成功率越来越低，也难用。</li><li>开源的Easytier，基于WireGuard改进而来。有一些大佬无偿贡献了免费中转服务器。</li></ul><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><strong>工作原理</strong></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier01.jpg"></p><ol><li>电脑、服务器、手机作为客户端，首次连入Easytier是需要一个服务端（中转服务器）来做认证、接通P2P的VPN。【红色虚线】</li><li>如果P2P的VPN一直接不通，流量就只能通过服务端（中转服务器）来中转了。【红色虚线】</li><li>如果P2P的VPN接通了，就直接走两台客户端之间的流量。【蓝色实线】</li></ol><p><strong>问题</strong></p><ul><li>大神自建的服务端（中转服务器）肯定满足不了日常使用，因为链接的人越多，肯定越慢。</li><li>这样就需要搭建自己的服务端（中转服务器），或者使用其他大佬无偿提供的服务端（中转服务器）。</li></ul><p><strong>搭建自己的中转服务器</strong></p><p>服务器环境：</p><ul><li>ClawCloud 日本 ，<strong>必须要有公网IP</strong></li><li>Debian 12</li><li>安装Docker</li></ul><p>最终形成这样的拓扑架构<br><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier14.jpg" alt="图片"></p><h1 id="搭建服务端"><a href="#搭建服务端" class="headerlink" title="搭建服务端"></a>搭建服务端</h1><p><strong>通过Docker Compose来启动镜像</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nano</span> docker-compose.yaml<br></code></pre></td></tr></table></figure><p>写入</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">version</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attribute">services</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">watchtower</span><span class="hljs-punctuation">:</span> <span class="hljs-string"># 用于自动更新easytier镜像，若不需要请删除这部分</span><br>    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">--interval 3600 --cleanup --label-enable</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">watchtower</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">WATCHTOWER_NO_STARTUP_MESSAGE</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">containrrr/watchtower</span><br>    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span><br>  <span class="hljs-attribute">easytier</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">restart</span><span class="hljs-punctuation">:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">com.centurylinklabs.watchtower.enable</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&#x27;true&#x27;</span><br>    <span class="hljs-attribute">privileged</span><span class="hljs-punctuation">:</span> <span class="hljs-string">true</span><br>    <span class="hljs-attribute">mem_limit</span><span class="hljs-punctuation">:</span> <span class="hljs-string">0m</span><br>    <span class="hljs-attribute">container_name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">easytier</span><br>    <span class="hljs-attribute">hostname</span><span class="hljs-punctuation">:</span> <span class="hljs-string">easytier</span><br>    <span class="hljs-attribute">network_mode</span><span class="hljs-punctuation">:</span> <span class="hljs-string">host</span><br>    <span class="hljs-attribute">volumes</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/easytier:/root</span><br>    <span class="hljs-attribute">environment</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span><br>    <span class="hljs-attribute">image</span><span class="hljs-punctuation">:</span> <span class="hljs-string">easytier/easytier:latest # 国内用户可以使用 m.daocloud.io/docker.io/easytier/easytier:latest</span><br>    <span class="hljs-attribute">command</span><span class="hljs-punctuation">:</span> <span class="hljs-string">-i &lt;VPN虚拟IP&gt; --network-name &lt;用户&gt; --network-secret &lt;密码&gt; -p tcp://&lt;云服务器域名或公网IP&gt;:11010</span><br></code></pre></td></tr></table></figure><p>如最后一句可以是：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">command: -<span class="hljs-selector-tag">i</span> <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-attr">--hostname</span> MyEasytierServer <span class="hljs-attr">--network-name</span> MyVPNName <span class="hljs-attr">--network-secret</span> MyVPNPassword -<span class="hljs-selector-tag">p</span> tcp:<span class="hljs-comment">//vpn.xx.com:11010</span><br></code></pre></td></tr></table></figure><ul><li><code>-i</code>：VPN中的内网地址</li><li><code>--hostname</code>：节点名字（中转服务器名字），没有的话就默认是easytier</li><li><code>--network-name</code>：在组建虚拟局域网的名字，要复杂个性一点，网上已经有人用了就会冲突连不上。其他节点千万不要写错。</li><li><code>--network-secret</code>：在组建虚拟局域网的密码，要复杂一点，被人猜到，就会白嫖你的公网云主机流量。其他节点千万不要写错。</li><li><code>-p</code>：搭建中转服务器的IP，即云主机的公网IP。如果填写的不是云主机的公网IP，就需要填作者或其他大神公开的中转服务器IP，连通性会差很多的。</li></ul><p>配置好后，输入下面命令</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker compose up -d</span><br></code></pre></td></tr></table></figure><h1 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h1><p><strong>（1）配置Windows客户端</strong><br>下载地址：<a href="https://easytier.cn/guide/download.html">https://easytier.cn/guide/download.html</a><br><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier05.jpg" alt="图片"><br>Windows的安装非常简单的，这里就不说明的。全部下一步。</p><ul><li>配置Windows客户端的方法如图：<br><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier06.jpg" alt="图片"></li><li>连上了就会这样子，显示<code>P2P</code>就是点对点的联网<strong>成功</strong>了，这时候就会走两台电脑之间的WIFI&#x2F;宽带&#x2F;5G流量，不会走中转服务器（腾讯云&#x2F;阿里云）的公网IP流量。</li><li>点对点<code>P2P</code><strong>不成功</strong>，会显示<code>delay</code>，这就只能走中转服务器的流量了，会慢很多。看下图的ping值就看出来有两个数量级的延时差距。<br>  <img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier09.jpg" alt="图片"></li></ul><p><strong>（2）配置Linux客户端</strong></p><ul><li>配置飞牛OS的客户端（命令行）</li></ul><ol><li><p>下载Linux用的zip包</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://github.com/EasyTier/EasyTier/releases/download/v2.<span class="hljs-number">2</span>.<span class="hljs-number">4</span>/easytier-linux-x86_64-v2.<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.zip<br></code></pre></td></tr></table></figure></li><li><p>把zip包解压出来，会有三个文件。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">unzip</span> easytier-linux-x86_64-v2.<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.zip<br></code></pre></td></tr></table></figure><p>把文件授权可以执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cd到你解压出来的文件夹里面</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">chmod</span> +x ./*<br></code></pre></td></tr></table></figure><p>把文件丢到</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">mv</span> ./easytier-* /usr/bin/<br></code></pre></td></tr></table></figure><p>现在就可以试用</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">easytier-core</span><br></code></pre></td></tr></table></figure><p>和</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">easytier-<span class="hljs-keyword">cli</span><br></code></pre></td></tr></table></figure><p>命令了，记得在root用户下使用。</p></li><li><p>启动飞牛OS的客户端</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sudo easytier-core -<span class="hljs-selector-tag">i</span> &lt;你要创建虚拟局域网IP&gt; <span class="hljs-attr">--network-name</span> &lt;用户&gt; <span class="hljs-attr">--network-secret</span> &lt;密码&gt; -<span class="hljs-selector-tag">p</span> tcp:<span class="hljs-comment">//&lt;服务器地址&gt;:11010</span><br>#例子： sudo easytier-core -<span class="hljs-selector-tag">i</span> <span class="hljs-number">10.0</span>.<span class="hljs-number">0.5</span> <span class="hljs-attr">--network-name</span> MyVPNName <span class="hljs-attr">--network-secret</span> MyVPNPassword -<span class="hljs-selector-tag">p</span> tcp:<span class="hljs-comment">//vpn.xxx.com:11010</span><br></code></pre></td></tr></table></figure><p>譬如：Windows的虚拟局域网IP是：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.0.0.3</span><br></code></pre></td></tr></table></figure><p>，你的飞牛OS就是错开用：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.0.0.5</span><br></code></pre></td></tr></table></figure><p>，你的安卓手机是</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.0.0.4</span><br></code></pre></td></tr></table></figure><p>、笔记本电脑是</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">10.0.0.5</span><br></code></pre></td></tr></table></figure><p>全都要把最后一位IP错开。</p></li></ol><p>成功连上就会有日志返回<br><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier10.jpg" alt="图片"></p><p>测试用飞牛影视播放1080P的电影原画的时候，走的是P2P，即只走了飞牛所在宽带的上传流量，没有走中转服务</p><p><em>PS：如果关闭终端窗口，就会关闭这个easytier-core进程，需要后台保持就要创建systemctl服务</em></p><ol><li><p>配置<code>systemctl</code>服务和自启<br>创建一个<code>easytier-core.service</code>文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/</span>easytier-core.service<br></code></pre></td></tr></table></figure><p>写入这段到代码，具体需要按自己的情况修改。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span> = EasyTier Core Service<br><span class="hljs-attr">After</span> = network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">ExecStart</span> = /usr/bin/easytier-core -i <span class="hljs-number">10.0</span>.<span class="hljs-number">0.5</span> --network-name MyVPNName --network-secret MyVPNPassword -p tcp://vpn.xxx.com:<span class="hljs-number">11010</span><br><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span> = multi-user.target<br></code></pre></td></tr></table></figure><p>然后配置<code>systemctl</code>自启动</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nsis">ps aux | grep easytier <span class="hljs-comment"># 确认是否有easytier启动着</span><br><span class="hljs-params">system</span>ctl daemon-reload <span class="hljs-comment">#重载你的systemctl，不然下面的命令都会用不了</span><br><span class="hljs-params">system</span>ctl start easytier-core <span class="hljs-comment"># 启动服务</span><br><span class="hljs-params">system</span>ctl status easytier-core <span class="hljs-comment"># 查看启动状态</span><br><span class="hljs-params">system</span>ctl enable easytier-core <span class="hljs-comment"># 设置自启动</span><br><span class="hljs-params">system</span>ctl restart easytier-core <span class="hljs-comment"># 重启服务</span><br><span class="hljs-params">system</span>ctl stop easytier-core <span class="hljs-comment"># 停止服务</span><br></code></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/easytier16.jpg" alt="图片"></p><p><strong>搭好的环境：</strong><br>优点：</p><ul><li>走P2P流量，即WIFI、家庭宽带、5G的直接流量，不需要浪费云主机（阿里云&#x2F;腾讯云）的流量来做中转。</li><li>延迟低，基本上可以达到个位数的毫秒级。</li><li>速度快，这主要看WIFI、家庭宽带、5G的上传带宽为限。平时不要用太狠，会被运营商封禁的</li></ul><p>缺点：</p><ul><li>稳定性差，因为P2P不是绝对能连上的。如果走云主机中转，会比frp还要慢。主流的内网穿透都是走frp模式的。平时可以使用easytier的P2P来降低中转流量，用frp来兜底。</li></ul><p>官方网站（文档）：</p><p><a href="https://easytier.cn/">https://easytier.cn/</a></p><p>Github：</p><p><a href="https://github.com/EasyTier/Easytier">https://github.com/EasyTier/Easytier</a></p></li></ol><p>本文参考</p><p><a href="https://www.brian-zzh.cn/2025/03/13/20250331%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7Easytier/#%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF">https://www.brian-zzh.cn/2025/03/13/20250331%E5%8E%BB%E4%B8%AD%E5%BF%83%E5%8C%96%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7Easytier/#%E6%90%AD%E5%BB%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;自从开始玩NAS以来，就一直关注怎样用便宜和快速的解决异地组网的问题。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;公网IPv6，有但是不想公开&lt;/li&gt;
&lt;li&gt;公网IPv4，更加不敢奢求&lt;/li&gt;
&lt;li&gt;各种收费内网工具cpolar、passnat、樱花frp感觉有点贵，免费的又不够用</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="异地组网" scheme="https://blog.quickso.cn/tags/%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91/"/>
    
    <category term="Easytier" scheme="https://blog.quickso.cn/tags/Easytier/"/>
    
  </entry>
  
  <entry>
    <title>CudyTR3000路由器刷机OpenWrt折腾记录</title>
    <link href="https://blog.quickso.cn/2025/03/22/CudyTR3000%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BAOpenWrt%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/"/>
    <id>https://blog.quickso.cn/2025/03/22/CudyTR3000%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E6%9C%BAOpenWrt%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95/</id>
    <published>2025-03-22T05:10:52.000Z</published>
    <updated>2026-02-06T13:40:34.760Z</updated>
    
    <content type="html"><![CDATA[<p>这几个月最火的路由器就是cudy多酷TR3000了，这是一款便携迷你随身路由器，MT7981B方案。Cudy很多人没听过，这是一家正规厂家专门做外贸的，可能是库存压力大，转内销了，不要你399，仅需隔壁MT3000三分之一的价格，让你带回家。我花了差不多150买下了它。</p><h2 id="配置说明："><a href="#配置说明：" class="headerlink" title="配置说明："></a>配置说明：</h2><ul><li>️ 无线规格：AX3000 160MHz</li><li>128MB闪存&#x2F;512MB内存</li><li>2.5G&#x2F;1G 双网口, USB3.0接口,Type-C供电（5V&#x2F;3A）</li><li>️ 隔壁MT3000平替(1&#x2F;3价格)，MT3000有主动散热、闪存256MB</li><li>支持OpenWrt，配合 4&#x2F;5G 随身WiFi，变身CPE路由器，办公、旅行、车载。</li><li>❗缺点：闪存小，装不了几个插件，USB接口供电不足</li></ul><p>路由器通电开机进入官方系统看看，</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/v2-d4c3a49ecd15f28740c4949bd1f00de0_1440w.jpg" alt="img"></p><p>▲ 后台首页可以看到路由器的基本信息、运行状态、接入终端的设备、网络等信息。</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/v2-795f8c986717b57a31d77ba7365e13a6_720w.webp" alt="img"></p><p>▲ 高级设置里面有的功能，经过测试USB接口不能共享网络，官方系统没有这个功能。</p><p>官方固件整体上比较简洁、只有一些基础功能，像是USB共享网络，移动通信模块、打印机共享等都没有，下面开始折腾刷机。</p><h2 id="刷openwrt系统"><a href="#刷openwrt系统" class="headerlink" title="刷openwrt系统"></a><strong>刷openwrt系统</strong></h2><h2 id="准备资料"><a href="#准备资料" class="headerlink" title="准备资料"></a>准备资料</h2><p><strong>由于文件名比较相似，请注意辨别。本文末尾所有文件均有下载。</strong></p><h4 id="过渡包："><a href="#过渡包：" class="headerlink" title="过渡包："></a>过渡包：</h4><p>cudy_tr3000-v1-sysupgrade.bin</p><h4 id="FIP分区只读破解包："><a href="#FIP分区只读破解包：" class="headerlink" title="FIP分区只读破解包："></a>FIP分区只读破解包：</h4><p>openwrt-mediatek-filogic-cudy_tr3000-v1-squashfs-sysupgrade.bin</p><h4 id="中文三分区DHCP-UBOOT："><a href="#中文三分区DHCP-UBOOT：" class="headerlink" title="中文三分区DHCP UBOOT："></a>中文三分区DHCP UBOOT：</h4><p>dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin</p><h4 id="固件："><a href="#固件：" class="headerlink" title="固件："></a><strong>固件：</strong></h4><p><a href="https://www.right.com.cn/forum/thread-8415516-1-1.html">cudy tr3000v1 lede源码6.6内核</a></p><p>114m-lede-openwrt6.6.673-mediatek-filogic-cudy_tr3000-v1-squashfs-sysupgrade.bin</p><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250307193946798218.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250307193946798218.webp" alt="img"></a></p><p><strong>刷机过程中涉及到和电脑连接的时候，请使用网线连接TR3000的千兆网口和电脑。</strong></p><h3 id="1，刷入过渡包"><a href="#1，刷入过渡包" class="headerlink" title="1，刷入过渡包"></a>1，刷入过渡包</h3><p>本步骤刷入过渡包，是为了下一步刷入 FIP分区只读破解包。</p><ul><li>进入TR3000官方后台 基本设置-&gt;固件升级</li><li>刷入 cudy_tr3000-v1-sysupgrade.bin</li></ul><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064215770704.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064215770704.webp" alt="img"></a></p><p>刷写完成后，自动重启。此时浏览器输入192.168.1.1，进入过渡包后台（密码password）</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064152518202.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064152518202.webp" alt="img"></a></p><h3 id="2，刷入FIP分区只读破解包"><a href="#2，刷入FIP分区只读破解包" class="headerlink" title="2，刷入FIP分区只读破解包"></a>2，刷入FIP分区只读破解包</h3><p>在过渡包后台打开 系统-&gt;备份与升级 进入刷机界面，点击 刷写固件 开始选择刷入FIP分区只读破解包刷入。</p><p>FIP分区只读破解包：openwrt-mediatek-filogic-cudy_tr3000-v1-squashfs-sysupgrade.bin</p><p>记得<strong>不要</strong>勾选保留当前设置。</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064242092959.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064242092959.webp" alt="img"></a></p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064255109819.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064255109819.webp" alt="img"></a></p><p>刷写完成后，自动重启。此时浏览器输入192.168.1.1，进入FIP分区只读破解包后台（密码password）</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064333472465.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064333472465.webp" alt="img"></a></p><h3 id="3，刷入第三方Uboot"><a href="#3，刷入第三方Uboot" class="headerlink" title="3，刷入第三方Uboot"></a>3，刷入第三方Uboot</h3><p>本文提供的是fry2022大佬的多分区布局中文uboot</p><h4 id="3-1，上传uboot"><a href="#3-1，上传uboot" class="headerlink" title="3.1，上传uboot"></a>3.1，上传uboot</h4><p>在FIP分区只读破解包后台 打开 系统-&gt;文件传输 选择 dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin 上传</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064319780174.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064319780174.webp" alt="img"></a></p><h4 id="3-2，刷入Uboot"><a href="#3-2，刷入Uboot" class="headerlink" title="3.2，刷入Uboot"></a>3.2，刷入Uboot</h4><p>在FIP分区只读破解包后台 打开系统-&gt;TTYD终端 默认用户名 root&#x2F;密码 password</p><p>进入uboot文件上传目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /tmp/upload/<br></code></pre></td></tr></table></figure><p>刷入ubtoot</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">mtd <span class="hljs-built_in">write</span> dhcp-mt7981_cudy_tr3000-fip-fixed-parts-multi-layout.bin FIP<br></code></pre></td></tr></table></figure><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064358681730.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064358681730.webp" alt="img"></a></p><h3 id="4，刷入第三方固件"><a href="#4，刷入第三方固件" class="headerlink" title="4，刷入第三方固件"></a>4，刷入第三方固件</h3><h4 id="4-1，进入uboot界面"><a href="#4-1，进入uboot界面" class="headerlink" title="4.1，进入uboot界面"></a>4.1，进入uboot界面</h4><p>4.1.1，TR3000断电</p><p>4.1.2，路由器LAN口先用网线连接电脑</p><p>4.1.3，按住路由器<strong>Reset键不松手</strong>，随即接通电源</p><p>4.1.4，<strong>闪烁4次白灯后转为红灯常亮</strong> 表示成功进入U-Boot，此时可以松开Reset键。</p><p>4.1.5，浏览器输入192.168.1.1进入web刷机界面刷机<a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064412354461.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064412354461.webp" alt="img"></a></p><h4 id="4-2，刷入第三方固件"><a href="#4-2，刷入第三方固件" class="headerlink" title="4.2，刷入第三方固件"></a>4.2，刷入第三方固件</h4><p>注意此uboot支持多种分区，本文提供的是114M大分区固件，所以 mtd分区 请选择 <strong>maximum-114m</strong></p><p>选择 114m-lede-openwrt6.6.673-mediatek-filogic-cudy_tr3000-v1-squashfs-sysupgrade.bin 刷入。</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064421175014.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064421175014.webp" alt="img"></a></p><p>刷机完成后自动启动固件，首次启动可能时间比较长大约需要5分钟。</p><p>固件后台：192.168.2.1  用户&#x2F;密码：root&#x2F;password</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228064429075371.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228064429075371.webp" alt="第三方固件后台界面"></a></p><h2 id="关于后续刷机"><a href="#关于后续刷机" class="headerlink" title="关于后续刷机"></a>关于后续刷机</h2><ul><li>如果你的固件是114M分区也就是和当前固件同一分区类型。</li></ul><p>那么打开 系统-&gt;备份与升级 刷固件即可。</p><ul><li>如果你的固件是其他分区</li></ul><p>请进入uboot选择合适的分区布局，然后刷入。</p><h2 id="关于刷回原厂"><a href="#关于刷回原厂" class="headerlink" title="关于刷回原厂"></a>关于刷回原厂</h2><h3 id="1，体验原厂固件"><a href="#1，体验原厂固件" class="headerlink" title="1，体验原厂固件"></a>1，体验原厂固件</h3><p>如果你只是想体验原厂固件而保留第三方uboot.</p><p>那么请进入uboot选择 <strong>default</strong> 分区布局，然后刷入分割好的官方固件</p><p>本文网盘链接中提供原厂2.3.7分割好的固件：uboot刷cudy_tr3000v1-GF2.3.7.bin</p><h3 id="2，彻底恢复原厂"><a href="#2，彻底恢复原厂" class="headerlink" title="2，彻底恢复原厂"></a>2，彻底恢复原厂</h3><p>如果你因为某些原因，想彻底恢复原厂固件，请看下面的操作。</p><h4 id="2-1，准备材料："><a href="#2-1，准备材料：" class="headerlink" title="2.1，准备材料："></a>2.1，准备材料：</h4><p>原厂uboot(FIP)：恢复原厂&#x2F;FIP.bin</p><p>原厂救砖包：recovery.bin（recovery.zip包内）</p><p>tftp工具：tftpd64.exe（recovery.zip包内）</p><h4 id="2-2，刷回原厂uboot-FIP"><a href="#2-2，刷回原厂uboot-FIP" class="headerlink" title="2.2，刷回原厂uboot(FIP)"></a>2.2，刷回原厂uboot(FIP)</h4><p>进入当前的uboot页面，点击 更新U-Boot</p><p>然后选择FIP.bin更新</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228105043963861.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228105043963861.webp" alt="img"></a></p><h4 id="2-3-电脑手动设置IP"><a href="#2-3-电脑手动设置IP" class="headerlink" title="2.3,电脑手动设置IP"></a>2.3,电脑手动设置IP</h4><p>TR3000断电，然后设置IP</p><p>路径为 控制面板-&gt;网络和 Internet-&gt;网络连接-&gt;以太网-&gt;属性-&gt;Internet协议版本4(TCP&#x2F;IPv4)</p><p>设置如下：</p><p>如果你是2025年以前的机器：ip地址为：192.168.1.88，网关地址为192.168.1.112</p><p><strong>如果你是2025年以后的机器：ip地址为：192.168.1.2，网关地址为192.168.1.1</strong></p><p>当然IP区分不一定绝对，如果你始终用一组IP，无法刷机的时候，建议换一组。</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228105136846623.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228105136846623.webp" alt="img"></a></p><h4 id="2-4，tftp设置"><a href="#2-4，tftp设置" class="headerlink" title="2.4，tftp设置"></a>2.4，tftp设置</h4><p>TR3000断电，然后打开tftp.exe</p><p><strong>Current Directory</strong> 为你recovery.bin所在的目录，默认是tftp.exe所在的目录。recovery.bin和tftp.exe在一个目录即可。</p><p><strong>Server interface</strong> 选择你上一步设置的IP地址192.168.1.88或者192.168.1.2，我自己的是192.168.1.2。</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228105100941890.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228105100941890.webp" alt="img"></a></p><h4 id="2-5，刷入原厂救砖包"><a href="#2-5，刷入原厂救砖包" class="headerlink" title="2.5，刷入原厂救砖包"></a>2.5，刷入原厂救砖包</h4><p>2.5.1，TR3000断电</p><p>2.5.2，路由器LAN口先用网线连接电脑</p><p>2.5.3，按住路由器<strong>Reset键不松手</strong>，随即接通电源</p><p>2.5.4，指示灯红色粉色交替闪烁，tftp显示刷机过程，此时可以松开Reset键。</p><p>刷机完成后自动重启</p><p><a href="https://www.wifilu.com/wp-content/uploads/2025/02/20250228105202561399.webp"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250228105202561399.webp" alt="img"></a></p><p>2.5.5，电脑IP地址改回自动获取</p><p>此时访问192.168.10.1 就是原厂固件了，可以更新从官网下载的固件了。</p><h2 id="关于使用USB共享"><a href="#关于使用USB共享" class="headerlink" title="关于使用USB共享"></a>关于使用USB共享</h2><p>手机或者随身wifi插入USB网口</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/v2-2d44d001f27b472e6d7d6064a77acd45_1440w.jpg" alt="img"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/v2-c3bc75bbbf6b57534884598c60594a33_1440w.jpg" alt="img"></p><p>▲ 网络→接口里新建一个接口，名称随意，协议DHCP，设备选择eth2（没有的话重新拔插一下），有的固件是usb设备，根据具体情况选择，防火墙设置WAN区域，其他保持默认，保存应用。</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/v2-e729892c18624b81d036312f9388c5af_1440w.jpg" alt="img"></p><p>▲ 路由器通过USB接口上网，USB网口当做WAN口，随便测个速</p><h2 id="刷机资料下载"><a href="#刷机资料下载" class="headerlink" title="刷机资料下载"></a>刷机资料下载</h2><p><a href="https://www.123865.com/s/9a5rVv-Vp2sH">https://www.123865.com/s/9a5rVv-Vp2sH</a></p><p>提取码:z9Mp</p><p>其他固件下载<br><a href="https://www.right.com.cn/FORUM/thread-8411618-1-1.html">https://www.right.com.cn/FORUM/thread-8411618-1-1.html</a></p><h2 id="文章参考"><a href="#文章参考" class="headerlink" title="文章参考"></a>文章参考</h2><p><a href="https://mao.fan/article/216">https://mao.fan/article/216</a></p><p><a href="https://www.wifilu.com/3592.html">https://www.wifilu.com/3592.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;这几个月最火的路由器就是cudy多酷TR3000了，这是一款便携迷你随身路由器，MT7981B方案。Cudy很多人没听过，这是一家正规厂家专门做外贸的，可能是库存压力大，转内销了，不要你399，仅需隔壁MT3000三分之一的价格，让你带回家。我花了差不多150买下了它。&lt;/</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="刷机" scheme="https://blog.quickso.cn/tags/%E5%88%B7%E6%9C%BA/"/>
    
    <category term="Cudy" scheme="https://blog.quickso.cn/tags/Cudy/"/>
    
    <category term="路由器" scheme="https://blog.quickso.cn/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
    <category term="OpenWrt" scheme="https://blog.quickso.cn/tags/OpenWrt/"/>
    
  </entry>
  
  <entry>
    <title>基于Prometheus和Grafana的IPMI/BMC监控系统</title>
    <link href="https://blog.quickso.cn/2025/03/14/%E5%9F%BA%E4%BA%8EPrometheus%E5%92%8CGrafana%E7%9A%84IPMI-BMC%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"/>
    <id>https://blog.quickso.cn/2025/03/14/%E5%9F%BA%E4%BA%8EPrometheus%E5%92%8CGrafana%E7%9A%84IPMI-BMC%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/</id>
    <published>2025-03-14T13:04:15.000Z</published>
    <updated>2026-02-06T13:40:34.778Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、前言-环境准备"><a href="#一、前言-环境准备" class="headerlink" title="一、前言&amp;环境准备"></a>一、前言&amp;环境准备</h2><p>服务器BMC&#x2F;IPMI，可以看到硬件的运行情况，比如CPU温度、内存温度、风扇转速、主板电压等，这些数据默认只能通过登录web后台或者ipmitool等接口工具来实时查看，看不到历史曲线图，也做不到监控告警，当服务器出现问题时，除了日志之外，这些物理传感器指标绘制的趋势图更有利于我们判断服务器在历史异常时间点的硬件状态趋势变化情况，或者实时监测指标到达设定的阈值时自动告警。</p><p>prometheus和grafana，前者作为数据采集，后者作为监控展示及告警，缺一不可，这两个组件如何安装非本文重点，本文建立在已安装两个环境之下。</p><p>安装教程可以参考前一篇文章…</p><p>我这里的prometheus和grafana是在VPS上安装的，方便监控多台服务器。</p><p>服务器是一台超微物理服务器，IP是192.168.10.x</p><p>服务器安装了PVE，是基于Debian的</p><h2 id="二、安装ipmi-exporter"><a href="#二、安装ipmi-exporter" class="headerlink" title="二、安装ipmi_exporter"></a>二、安装ipmi_exporter</h2><p>到<a href="https://github.com/prometheus-community/ipmi_exporter/releases">此页面</a>下载对应系统版本的二进制文件，解压即可。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://github.com/prometheus-community/ipmi_exporter/releases/download/v1.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>/ipmi_exporter-<span class="hljs-number">1</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.linux-amd64.tar.gz<br><span class="hljs-attribute">tar</span> xf ipmi_exporter-<span class="hljs-number">1</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>.linux-amd64.tar.gz<br></code></pre></td></tr></table></figure><p>不添加PATH环境变量的情况下，设置一个软链接到PATH路径下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> /opt/ipmi_exporter-1.10.0.linux-amd64 /opt/ipmi_exporter<br><span class="hljs-built_in">ln</span> -sf /opt/ipmi_exporter/ipmi_exporter /usr/local/bin/ipmi_exporter<br></code></pre></td></tr></table></figure><p>验证是否可以成功执行：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">ipmi_exporter -h</span><br></code></pre></td></tr></table></figure><h2 id="三、写systemctl服务并安装FreeIPMI"><a href="#三、写systemctl服务并安装FreeIPMI" class="headerlink" title="三、写systemctl服务并安装FreeIPMI"></a>三、写systemctl服务并安装FreeIPMI</h2><h3 id="ipmi-exporter-yaml配置文件"><a href="#ipmi-exporter-yaml配置文件" class="headerlink" title="ipmi_exporter yaml配置文件"></a>ipmi_exporter yaml配置文件</h3><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /<span class="hljs-keyword">opt</span>/ipmi_exporter/ipmi_remote.yml<br></code></pre></td></tr></table></figure><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">modules</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-attribute">default</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># These settings are used if no module is specified, the</span><br>                <span class="hljs-comment"># specified module doesn&#x27;t exist, or of course if</span><br>                <span class="hljs-comment"># module=default is specified.</span><br>                <span class="hljs-attribute">user</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ADMIN&quot;     # 无特殊需求，填写这两行账号密码即可，IPMI用户名</span><br>                <span class="hljs-attribute">pass</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PASSWORD&quot;  # 无特殊需求，填写这两行账号密码即可，IPMI密码</span><br>                <span class="hljs-comment"># The below settings correspond to driver-type, privilege-level, and</span><br>                <span class="hljs-comment"># session-timeout respectively, see `man 5 freeipmi.conf` (and e.g.</span><br>                <span class="hljs-comment"># `man 8 ipmi-sensors` for a list of driver types).</span><br>                <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAN_2_0&quot;</span><br>                <span class="hljs-attribute">privilege</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;user&quot;</span><br>                <span class="hljs-comment"># The session timeout is in milliseconds. Note that a scrape can take up</span><br>                <span class="hljs-comment"># to (session-timeout * #-of-collectors) milliseconds, so set the scrape</span><br>                <span class="hljs-comment"># timeout in Prometheus accordingly.</span><br>                <span class="hljs-comment"># Must be larger than the retransmission timeout, which defaults to 1000.</span><br>                <span class="hljs-attribute">timeout</span><span class="hljs-punctuation">:</span> <span class="hljs-string">10000</span><br>                <span class="hljs-comment"># Available collectors are bmc, bmc-watchdog, ipmi, chassis, dcmi, sel,</span><br>                <span class="hljs-comment"># and sm-lan-mode</span><br>                <span class="hljs-comment"># If _not_ specified, bmc, ipmi, chassis, and dcmi are used</span><br>                <span class="hljs-attribute">collectors</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">bmc</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">ipmi</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">chassis</span><br>                <span class="hljs-comment"># Got any sensors you don&#x27;t care about? Add them here.</span><br>                <span class="hljs-attribute">exclude_sensor_ids</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">2</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">29</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">32</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">50</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">52</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">55</span><br>        <span class="hljs-attribute">dcmi</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># Use these settings when scraped with module=dcmi.</span><br>                <span class="hljs-attribute">user</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin_user&quot;</span><br>                <span class="hljs-attribute">pass</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;another_pw&quot;</span><br>                <span class="hljs-attribute">privilege</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><br>                <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAN_2_0&quot;</span><br>                <span class="hljs-attribute">collectors</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">dcmi</span><br>        <span class="hljs-attribute">thatspecialhost</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># Use these settings when scraped with module=thatspecialhost.</span><br>                <span class="hljs-attribute">user</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;some_user&quot;</span><br>                <span class="hljs-attribute">pass</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;secret_pw&quot;</span><br>                <span class="hljs-attribute">privilege</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><br>                <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAN&quot;</span><br>                <span class="hljs-attribute">collectors</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">ipmi</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">sel</span><br>                <span class="hljs-comment"># Need any special workaround flags set? Add them here.</span><br>                <span class="hljs-comment"># Workaround flags might be needed to address issues with specific vendor implementations</span><br>                <span class="hljs-comment"># e.g. https://www.gnu.org/software/freeipmi/freeipmi-faq.html#Why-is-the-output-from-FreeIPMI-different-than-another-software_003f</span><br>                <span class="hljs-comment"># For a full list of flags, refer to:</span><br>                <span class="hljs-comment"># https://www.gnu.org/software/freeipmi/manpages/man8/ipmi-sensors.8.html#lbAL</span><br>                <span class="hljs-attribute">workaround_flags</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">discretereading</span><br>                <span class="hljs-comment"># If you require additional command line arguments (e.g. --bridge-sensors for ipmimonitoring),</span><br>                <span class="hljs-comment"># you can specify them per collector - BE CAREFUL, you can easily break the exporter with this!</span><br>                <span class="hljs-attribute">custom_args</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-attribute">ipmi</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;--bridge-sensors&quot;</span><br>        <span class="hljs-attribute">advanced</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-comment"># Use these settings when scraped with module=advanced.</span><br>                <span class="hljs-attribute">user</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;some_user&quot;</span><br>                <span class="hljs-attribute">pass</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;secret_pw&quot;</span><br>                <span class="hljs-attribute">privilege</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;admin&quot;</span><br>                <span class="hljs-attribute">driver</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;LAN&quot;</span><br>                <span class="hljs-attribute">collectors</span><span class="hljs-punctuation">:</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">ipmi</span><br>                <span class="hljs-bullet">-</span> <span class="hljs-string">sel</span><br>                <span class="hljs-comment"># USING ANY OF THE BELOW VOIDS YOUR WARRANTY! YOU MAY GET BITTEN BY SHARKS!</span><br>                <span class="hljs-comment"># You can override the command to be executed for a collector. Paired with</span><br>                <span class="hljs-comment"># custom_args, this can be used to e.g. execute the IPMI tools with sudo:</span><br>                <span class="hljs-attribute">collector_cmd</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-attribute">ipmi</span><span class="hljs-punctuation">:</span> <span class="hljs-string">sudo</span><br>                        <span class="hljs-attribute">sel</span><span class="hljs-punctuation">:</span> <span class="hljs-string">sudo</span><br>                <span class="hljs-attribute">custom_args</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-attribute">ipmi</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ipmimonitoring&quot;</span><br>                        <span class="hljs-attribute">sel</span><span class="hljs-punctuation">:</span><br>                        <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;ipmi-sel&quot;</span><br></code></pre></td></tr></table></figure><p>编辑服务文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>systemd<span class="hljs-regexp">/system/i</span>pmi_exporter.service<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=IPMI Exporter<br><span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target<br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target<br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">User</span>=root<br><span class="hljs-attr">Group</span>=root<br><span class="hljs-attr">Type</span>=simple<br><span class="hljs-attr">ExecStart</span>=/usr/local/bin/ipmi_exporter --config.file=/opt/ipmi_exporter/ipmi_remote.yml<br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure><p>重载并启动服务：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">systemctl</span> daemon-reload<br><span class="hljs-title">systemctl</span> enable ipmi_exporter <span class="hljs-comment">--now</span><br></code></pre></td></tr></table></figure><p>验证服务已运行成功，并且没有报错：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">journalctl</span> -u ipmi_exporter.service -f<br></code></pre></td></tr></table></figure><h3 id="安装FreeIPMI"><a href="#安装FreeIPMI" class="headerlink" title="安装FreeIPMI"></a>安装FreeIPMI</h3><p>安装FreeIPMI即可。</p><table><thead><tr><th align="left">发行版</th><th align="left">安装命令</th></tr></thead><tbody><tr><td align="left">Archlinux</td><td align="left">pacman -Sy extra&#x2F;freeipmi</td></tr><tr><td align="left">Centos&#x2F;Redhat</td><td align="left">yum install freeipmi -y</td></tr><tr><td align="left">Debian&#x2F;Ubuntu</td><td align="left">apt install freeipmi -y</td></tr><tr><td align="left">Gentoo</td><td align="left">emerge –ask freeipmi</td></tr></tbody></table><h2 id="四、配置Prometheus并验证metrics"><a href="#四、配置Prometheus并验证metrics" class="headerlink" title="四、配置Prometheus并验证metrics"></a>四、配置Prometheus并验证metrics</h2><h3 id="1-配置ipmi-targets"><a href="#1-配置ipmi-targets" class="headerlink" title="1.配置ipmi_targets"></a>1.配置ipmi_targets</h3><p>写一个targets文件，填写需要监控的ipmi的IP（不是服务器上安装的系统IP）：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/prometheus/i</span>pmi_targets.yml <br></code></pre></td></tr></table></figure><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-bullet">-</span> <span class="hljs-string">targets:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">xx.xx.xx.xx # 被监控的IPMI IP</span><br>  <span class="hljs-attribute">labels</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">job</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ipmi_exporter</span><br></code></pre></td></tr></table></figure><h3 id="2-配置prometheus"><a href="#2-配置prometheus" class="headerlink" title="2.配置prometheus"></a>2.配置prometheus</h3><p>在prometheus主配置文件里追加以下ipmi_exporter的任务，prometheus将收集来自ipmi_exporter服务主机的metrics数据：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/prometheus/</span>prometheus.yml<br></code></pre></td></tr></table></figure><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-bullet">-</span> <span class="hljs-string">job_name: ipmi_exporter</span><br>    <span class="hljs-attribute">params</span><span class="hljs-punctuation">:</span><br>      <span class="hljs-attribute">module</span><span class="hljs-punctuation">:</span> <span class="hljs-string">[&#x27;default&#x27;]</span><br>    <span class="hljs-attribute">scrape_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">1m</span><br>    <span class="hljs-attribute">scrape_timeout</span><span class="hljs-punctuation">:</span> <span class="hljs-string">30s</span><br>    <span class="hljs-attribute">metrics_path</span><span class="hljs-punctuation">:</span> <span class="hljs-string">/ipmi</span><br>    <span class="hljs-attribute">scheme</span><span class="hljs-punctuation">:</span> <span class="hljs-string">http</span><br>    <span class="hljs-attribute">file_sd_configs</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">files:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/prometheus/ipmi_targets.yml</span><br>      <span class="hljs-attribute">refresh_interval</span><span class="hljs-punctuation">:</span> <span class="hljs-string">5m</span><br>    <span class="hljs-attribute">relabel_configs</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">source_labels: [__address__]</span><br>      <span class="hljs-attribute">separator</span><span class="hljs-punctuation">:</span> <span class="hljs-string">;</span><br>      <span class="hljs-attribute">regex</span><span class="hljs-punctuation">:</span> <span class="hljs-string">(.*)</span><br>      <span class="hljs-attribute">target_label</span><span class="hljs-punctuation">:</span> <span class="hljs-string">__param_target</span><br>      <span class="hljs-attribute">replacement</span><span class="hljs-punctuation">:</span> <span class="hljs-string">$&#123;1&#125;</span><br>      <span class="hljs-attribute">action</span><span class="hljs-punctuation">:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">source_labels: [__param_target]</span><br>      <span class="hljs-attribute">separator</span><span class="hljs-punctuation">:</span> <span class="hljs-string">;</span><br>      <span class="hljs-attribute">regex</span><span class="hljs-punctuation">:</span> <span class="hljs-string">(.*)</span><br>      <span class="hljs-attribute">target_label</span><span class="hljs-punctuation">:</span> <span class="hljs-string">instance</span><br>      <span class="hljs-attribute">replacement</span><span class="hljs-punctuation">:</span> <span class="hljs-string">$&#123;1&#125;</span><br>      <span class="hljs-attribute">action</span><span class="hljs-punctuation">:</span> <span class="hljs-string">replace</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">separator: ;</span><br>      <span class="hljs-attribute">regex</span><span class="hljs-punctuation">:</span> <span class="hljs-string">.*</span><br>      <span class="hljs-attribute">target_label</span><span class="hljs-punctuation">:</span> <span class="hljs-string">__address__</span><br>      <span class="hljs-attribute">replacement</span><span class="hljs-punctuation">:</span> <span class="hljs-string">xx.xx.xx.xx:9290 # 这里写ipmi_exporter服务所在的系统IP，不是IPMIIP，我这里使用了tailscale分配的IP</span><br>      <span class="hljs-attribute">action</span><span class="hljs-punctuation">:</span> <span class="hljs-string">replace</span><br></code></pre></td></tr></table></figure><p>之后重启prometheus服务</p><h3 id="3-验证metrics数据收集情况"><a href="#3-验证metrics数据收集情况" class="headerlink" title="3.验证metrics数据收集情况"></a>3.验证metrics数据收集情况</h3><p>此时到Prometheus的web页面，找到我们添加的ipmi_exporter任务，确保已经UP</p><p>Endpoint链接点进去可以看到ipmi_exporter收集的metrics原始数据</p><h2 id="五、配置grafana监控面板"><a href="#五、配置grafana监控面板" class="headerlink" title="五、配置grafana监控面板"></a>五、配置grafana监控面板</h2><h3 id="导入监控模板"><a href="#导入监控模板" class="headerlink" title="导入监控模板"></a>导入监控模板</h3><p>获取到metric数据后，最后一步则将这些数据通过监控图的方式展示出来，这里采用模板方式进行导入。</p><p>在Grafana主面板中，点击<strong>导入</strong>选项</p><p>填写ID为15765，之后点击<strong>Load</strong>：</p><p>数据源选择Prometheus</p><p>就可以了，可以根据自己的实际情况修改模板</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、前言-环境准备&quot;&gt;&lt;a href=&quot;#一、前言-环境准备&quot; class=&quot;headerlink&quot; title=&quot;一、前言&amp;amp;环境准备&quot;&gt;&lt;/a&gt;一、前言&amp;amp;环境准备&lt;/h2&gt;&lt;p&gt;服务器BMC&amp;#x2F;IPMI，可以看到硬件的运行情况，比如CPU</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Prometheus" scheme="https://blog.quickso.cn/tags/Prometheus/"/>
    
    <category term="Grafana" scheme="https://blog.quickso.cn/tags/Grafana/"/>
    
    <category term="IPMI" scheme="https://blog.quickso.cn/tags/IPMI/"/>
    
    <category term="BMC" scheme="https://blog.quickso.cn/tags/BMC/"/>
    
  </entry>
  
  <entry>
    <title>服务器多节点docker部署Grafana、Prometheus、Node-Exporter、alertmanager、prometheus-alert并对接飞书通知</title>
    <link href="https://blog.quickso.cn/2025/03/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%9A%E8%8A%82%E7%82%B9Docker%E9%83%A8%E7%BD%B2Grafana%E3%80%81Prometheus%E3%80%81Node-Exporter%E3%80%81alertmanager%E3%80%81prometheus-alert%E5%B9%B6%E5%AF%B9%E6%8E%A5%E9%A3%9E%E4%B9%A6%E9%80%9A%E7%9F%A5/"/>
    <id>https://blog.quickso.cn/2025/03/14/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%9A%E8%8A%82%E7%82%B9Docker%E9%83%A8%E7%BD%B2Grafana%E3%80%81Prometheus%E3%80%81Node-Exporter%E3%80%81alertmanager%E3%80%81prometheus-alert%E5%B9%B6%E5%AF%B9%E6%8E%A5%E9%A3%9E%E4%B9%A6%E9%80%9A%E7%9F%A5/</id>
    <published>2025-03-14T12:58:56.000Z</published>
    <updated>2026-02-06T13:40:34.781Z</updated>
    
    <content type="html"><![CDATA[<p>要在多台服务器上部署 Grafana、Prometheus 和 Node-Exporter，并且其中一台服务器专门用于 Grafana 和 Prometheus 的部署</p><h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h3><ul><li><strong>服务器信息</strong>：<ul><li><strong>Server 1</strong>：用于部署 Grafana 和 Prometheus、alertmanager、prometheus-alert</li><li><strong>Server 2-n</strong>：用于部署 Node-Exporter。</li></ul></li><li><strong>Docker</strong>：确保所有服务器上已安装 Docker 和 Docker Compose。</li></ul><p><a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn/</a></p><h3 id="2-在-Server-1-上部署-Grafana-和-Prometheus等"><a href="#2-在-Server-1-上部署-Grafana-和-Prometheus等" class="headerlink" title="2. 在 Server 1 上部署 Grafana 和 Prometheus等"></a>2. 在 Server 1 上部署 Grafana 和 Prometheus等</h3><h4 id="2-1-创建-Docker-Compose-文件"><a href="#2-1-创建-Docker-Compose-文件" class="headerlink" title="2.1 创建 Docker Compose 文件"></a>2.1 创建 Docker Compose 文件</h4><p>在 Server 1 上创建一个 <code>docker-compose.yml</code> 文件，内容如下：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><br><span class="hljs-symbol">services:</span><br><span class="hljs-symbol">  prometheus:</span><br><span class="hljs-symbol">    image:</span> prom/prometheus<br><span class="hljs-symbol">    container_name:</span> prometheus<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;9090:9090&quot;</span><br><span class="hljs-symbol">    volumes:</span><br>      - /root/Prometheus/<span class="hljs-meta">data</span>/prometheus.yml:/etc/prometheus/prometheus.yml<br>      -  /root/Prometheus/<span class="hljs-meta">data</span>/alerts.yml:/etc/prometheus/alerts.yml<br><span class="hljs-symbol">    command:</span><br>      - <span class="hljs-string">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><br>      - <span class="hljs-string">&#x27;--web.enable-lifecycle&#x27;</span><br><span class="hljs-symbol">    restart:</span> always<br><br><span class="hljs-symbol">  grafana:</span><br><span class="hljs-symbol">    image:</span> grafana/grafana<br><span class="hljs-symbol">    container_name:</span> grafana<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;3000:3000&quot;</span><br><span class="hljs-symbol">    volumes:</span><br>      - grafana-storage:/var/lib/grafana<br><span class="hljs-symbol">    environment:</span><br>      - GF_SECURITY_ADMIN_PASSWORD<span class="hljs-symbol">=admin</span> #这里可以改成你的密码<br><span class="hljs-symbol">    restart:</span> always<br><br>  node-exporter:<br><span class="hljs-symbol">    image:</span> prom/node-exporter<br><span class="hljs-symbol">    container_name:</span> node-exporter<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;9100:9100&quot;</span><br><span class="hljs-symbol">    restart:</span> always<br><br><span class="hljs-symbol">  alertmanager:</span><br><span class="hljs-symbol">    image:</span> prom/alertmanager<br><span class="hljs-symbol">    container_name:</span> alertmanager<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;9093:9093&quot;</span><br><span class="hljs-symbol">    volumes:</span><br>      - /root/Prometheus/alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml<br><span class="hljs-symbol">    command:</span><br>      - <span class="hljs-string">&#x27;--config.file=/etc/alertmanager/alertmanager.yml&#x27;</span><br><span class="hljs-symbol">    restart:</span> always<br>    <br>  prometheus-alert:<br><span class="hljs-symbol">    image:</span> feiyu563/prometheus-alert:<span class="hljs-built_in">v4</span>.<span class="hljs-number">9</span>.<span class="hljs-number">1</span><br><span class="hljs-symbol">    container_name:</span> prometheus-alert<br><span class="hljs-symbol">    ports:</span><br>      - <span class="hljs-string">&quot;8080:8080&quot;</span><br><span class="hljs-symbol">    volumes:</span><br>      - /root/Prometheus/prometheus-alert/app.conf:/app/conf/app.conf<br><span class="hljs-symbol">    restart:</span> always<br><br><span class="hljs-symbol">volumes:</span><br>  grafana-storage:<br></code></pre></td></tr></table></figure><h4 id="2-2-创建-配置文件"><a href="#2-2-创建-配置文件" class="headerlink" title="2.2 创建 配置文件"></a>2.2 创建 配置文件</h4><p>在 Server 1 上创建一个 <code>prometheus.yml</code> 文件，内容如下：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">global:</span><br><span class="hljs-symbol">  scrape_interval:</span> <span class="hljs-number">15</span>s<br><span class="hljs-symbol">  evaluation_interval:</span> <span class="hljs-number">15</span>s<br><br><span class="hljs-symbol">alerting:</span><br><span class="hljs-symbol">  alertmanagers:</span><br>    - static_configs:<br>        - targets: [<span class="hljs-string">&#x27;alertmanager:9093&#x27;</span>]<br><br><span class="hljs-symbol">rule_files:</span><br>  - /etc/prometheus/alerts.yml<br><br><span class="hljs-symbol">scrape_configs:</span><br>  - job_name: <span class="hljs-string">&#x27;node-exporter&#x27;</span><br><span class="hljs-symbol">    static_configs:</span><br>      - targets: [<span class="hljs-string">&#x27;server2:9100&#x27;</span>, <span class="hljs-string">&#x27;server3:9100&#x27;</span>, <span class="hljs-string">&#x27;server4:9100&#x27;</span>, <span class="hljs-string">&#x27;server5:9100&#x27;</span>, <span class="hljs-string">&#x27;server6:9100&#x27;</span>]<br></code></pre></td></tr></table></figure><h4 id="alerts-yml"><a href="#alerts-yml" class="headerlink" title="alerts.yml"></a>alerts.yml</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">groups:</span><br>- name: alerts<br><span class="hljs-symbol">  rules:</span><br>  - alert: 实例宕机<br><span class="hljs-symbol">    expr:</span> up == <span class="hljs-number">0</span><br><span class="hljs-symbol">    for:</span> <span class="hljs-number">1</span>m<br><span class="hljs-symbol">    labels:</span><br><span class="hljs-symbol">      severity:</span> 严重<br><span class="hljs-symbol">    annotations:</span><br><span class="hljs-symbol">      summary:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 宕机&quot;</span><br><span class="hljs-symbol">      description:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 已经宕机超过 1 分钟。&quot;</span><br><br>  - alert: CPU使用率过高<br><span class="hljs-symbol">    expr:</span> <span class="hljs-number">100</span> - (avg by (instance) (irate(node_cpu_seconds_total&#123;mode=<span class="hljs-string">&quot;idle&quot;</span>&#125;[<span class="hljs-number">1</span>m])) * <span class="hljs-number">100</span>) &gt; <span class="hljs-number">30</span><br><span class="hljs-symbol">    for:</span> <span class="hljs-number">5</span>m<br><span class="hljs-symbol">    labels:</span><br><span class="hljs-symbol">      severity:</span> 警告<br><span class="hljs-symbol">    annotations:</span><br><span class="hljs-symbol">      summary:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 的 CPU 使用率过高&quot;</span><br><span class="hljs-symbol">      description:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 的 CPU 使用率超过 30% 已经持续 5 分钟。&quot;</span><br><br>  - alert: 内存使用率过高<br><span class="hljs-symbol">    expr:</span> (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * <span class="hljs-number">100</span> &gt; <span class="hljs-number">80</span><br><span class="hljs-symbol">    for:</span> <span class="hljs-number">5</span>m<br><span class="hljs-symbol">    labels:</span><br><span class="hljs-symbol">      severity:</span> 警告<br><span class="hljs-symbol">    annotations:</span><br><span class="hljs-symbol">      summary:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 的内存使用率过高&quot;</span><br><span class="hljs-symbol">      description:</span> <span class="hljs-string">&quot;实例 &#123;&#123; $labels.instance &#125;&#125; 的内存使用率超过 80% 已经持续 5 分钟。&quot;</span><br></code></pre></td></tr></table></figure><h4 id="alertmanager-yml"><a href="#alertmanager-yml" class="headerlink" title="alertmanager.yml"></a>alertmanager.yml</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">global:</span><br><span class="hljs-symbol">  resolve_timeout:</span> <span class="hljs-number">5</span>m<br><br><span class="hljs-symbol">route:</span><br><span class="hljs-symbol">  receiver:</span> <span class="hljs-string">&#x27;feishu-webhook&#x27;</span><br><span class="hljs-symbol">  group_by:</span> [<span class="hljs-string">&#x27;alertname&#x27;</span>]<br><span class="hljs-symbol">  group_wait:</span> <span class="hljs-number">10</span>s<br><span class="hljs-symbol">  group_interval:</span> <span class="hljs-number">5</span>m<br><span class="hljs-symbol">  repeat_interval:</span> <span class="hljs-number">3</span>h<br><br><span class="hljs-symbol">receivers:</span><br>  - name: <span class="hljs-string">&#x27;feishu-webhook&#x27;</span><br><span class="hljs-symbol">    webhook_configs:</span><br>      - url: <span class="hljs-string">&#x27;http://你的IP:8080/prometheusalert?type=fs&amp;tpl=prometheus-fs&amp;fsurl=https://open.feishu.cn/open-apis/bot/v2/hook/xxx&#x27;</span><br><span class="hljs-symbol">        send_resolved:</span> true<br></code></pre></td></tr></table></figure><h4 id="2-3-启动服务"><a href="#2-3-启动服务" class="headerlink" title="2.3 启动服务"></a>2.3 启动服务</h4><p>在 Server 1 上运行以下命令启动：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">docker</span>-compose up -d<br></code></pre></td></tr></table></figure><h3 id="3-在-Server-2-n-上部署-Node-Exporter，并开放端口"><a href="#3-在-Server-2-n-上部署-Node-Exporter，并开放端口" class="headerlink" title="3.在 Server 2-n 上部署 Node-Exporter，并开放端口"></a>3.在 Server 2-n 上部署 Node-Exporter，并开放端口</h3><h4 id="Docker方式"><a href="#Docker方式" class="headerlink" title="Docker方式"></a>Docker方式</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">docker</span> run -d \<br>  --name node-exporter \<br>  -p <span class="hljs-number">9100</span>:<span class="hljs-number">9100</span> \<br>  --restart always \<br>  prom/node-exporter<br></code></pre></td></tr></table></figure><h4 id="二进制（Debian）"><a href="#二进制（Debian）" class="headerlink" title="二进制（Debian）"></a>二进制（Debian）</h4> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install prometheus-node-exporter<br></code></pre></td></tr></table></figure><h3 id="4-配置-Grafana"><a href="#4-配置-Grafana" class="headerlink" title="4. 配置 Grafana"></a>4. 配置 Grafana</h3><h4 id="4-1-访问-Grafana"><a href="#4-1-访问-Grafana" class="headerlink" title="4.1 访问 Grafana"></a>4.1 访问 Grafana</h4><p>在浏览器中访问 <code>http://&lt;Server1-IP&gt;:3000</code>，使用默认用户名 <code>admin</code> 和密码 <code>admin</code> 登录。</p><h4 id="4-2-添加-Prometheus-数据源"><a href="#4-2-添加-Prometheus-数据源" class="headerlink" title="4.2 添加 Prometheus 数据源"></a>4.2 添加 Prometheus 数据源</h4><h4 id="在-Grafana-中，点击左侧菜单的-Configuration-Data-Sources。"><a href="#在-Grafana-中，点击左侧菜单的-Configuration-Data-Sources。" class="headerlink" title="在 Grafana 中，点击左侧菜单的 Configuration -&gt; Data Sources。"></a>在 Grafana 中，点击左侧菜单的 <strong>Configuration</strong> -&gt; <strong>Data Sources</strong>。</h4><ol><li>点击 <strong>Add data source</strong>，选择 <strong>Prometheus</strong>。</li><li>在 <strong>URL</strong> 字段中输入 <code>http://prometheus:9090</code>，然后点击 <strong>Save &amp; Test</strong>。</li></ol><h4 id="4-3-导入-Node-Exporter-仪表盘"><a href="#4-3-导入-Node-Exporter-仪表盘" class="headerlink" title="4.3 导入 Node-Exporter 仪表盘"></a>4.3 导入 Node-Exporter 仪表盘</h4><h4 id="在-Grafana-中，点击左侧菜单的-Import。"><a href="#在-Grafana-中，点击左侧菜单的-Import。" class="headerlink" title="在 Grafana 中，点击左侧菜单的 + -&gt; Import。"></a>在 Grafana 中，点击左侧菜单的 <strong>+</strong> -&gt; <strong>Import</strong>。</h4><ol><li>在 <strong>Grafana.com Dashboard</strong> 字段中输入 <code>1860</code>，然后点击 <strong>Load</strong>。</li><li>选择 Prometheus 数据源，然后点击 <strong>Import</strong>。</li></ol><hr><h3 id="4-验证部署"><a href="#4-验证部署" class="headerlink" title="4. 验证部署"></a>4. 验证部署</h3><ul><li><strong>Prometheus</strong>：访问 <code>http://&lt;Server1-IP&gt;:9090/targets</code>，确保所有 <code>Node-Exporter</code> 目标（包括 <code>Server 1</code>）的状态为 <strong>UP</strong>。</li><li><strong>Grafana</strong>：访问 <code>http://&lt;Server1-IP&gt;:3000</code>，查看仪表盘是否显示所有服务器的监控数据。</li><li><strong>Alertmanager:</strong> 访问 <code>http://&lt;Server1-IP&gt;:9093</code>，告警管理组件，负责处理、分组、抑制和发送告警通知。</li><li><strong>Prometheus-Alert</strong> :访问 <code>http://&lt;Server1-IP&gt;:8080</code>，开源的运维告警中心消息转发系统，以及所有支持WebHook接口的系统发出的预警消息，支持将收到的这些消息发送到国内的各种平台</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;要在多台服务器上部署 Grafana、Prometheus 和 Node-Exporter，并且其中一台服务器专门用于 Grafana 和 Prometheus 的部署&lt;/p&gt;
&lt;h3 id=&quot;1-准备工作&quot;&gt;&lt;a href=&quot;#1-准备工作&quot; class=&quot;headerl</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Prometheus" scheme="https://blog.quickso.cn/tags/Prometheus/"/>
    
    <category term="Grafana" scheme="https://blog.quickso.cn/tags/Grafana/"/>
    
    <category term="Node-Exporter" scheme="https://blog.quickso.cn/tags/Node-Exporter/"/>
    
  </entry>
  
  <entry>
    <title>年轻人的第一台服务器——SuperMicro SuperServer5018D-MF+X10SLL-F主板使用体验</title>
    <link href="https://blog.quickso.cn/2025/03/09/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E2%80%94%E2%80%94SuperMicroSuperServer5018D-MF+X10SLL-F%E4%B8%BB%E6%9D%BF%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/"/>
    <id>https://blog.quickso.cn/2025/03/09/%E5%B9%B4%E8%BD%BB%E4%BA%BA%E7%9A%84%E7%AC%AC%E4%B8%80%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E2%80%94%E2%80%94SuperMicroSuperServer5018D-MF+X10SLL-F%E4%B8%BB%E6%9D%BF%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/</id>
    <published>2025-03-09T13:37:04.000Z</published>
    <updated>2026-02-06T13:40:34.780Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在咸鱼上淘了一台1U半高服务器回来，型号为SuperMicro（超微） SuperServer5018D-MF+X10SLL-F主板</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/4928f53d821cf8c16ab7b25cafc79c6.jpg" alt="4928f53d821cf8c16ab7b25cafc79c6"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/6a23b393828ac15cd89a9152c982551.jpg" alt="6a23b393828ac15cd89a9152c982551"></p><p>参数如下:</p><table><thead><tr><th align="left"><strong>特性</strong></th><th align="left"><strong>详细信息</strong></th></tr></thead><tbody><tr><td align="left"><strong>处理器支持</strong></td><td align="left">Intel® Xeon® E3-1200 v3&#x2F;v4, 4th Gen Core i3, Pentium, Celeron</td></tr><tr><td align="left"><strong>芯片组</strong></td><td align="left">Intel® C222 Express PCH</td></tr><tr><td align="left"><strong>内存支持</strong></td><td align="left">最高 32GB DDR3 ECC 1600MHz UDIMMs，4个插槽</td></tr><tr><td align="left"><strong>网络接口</strong></td><td align="left">双千兆以太网端口 (1 Intel® i217LM &amp; 1 Intel® i210AT)</td></tr><tr><td align="left"><strong>存储接口</strong></td><td align="left">2个 SATA 6Gbps，4个 SATA 3Gbps</td></tr><tr><td align="left"><strong>扩展插槽</strong></td><td align="left">1个 PCI-E 3.0 x8 (in x16)，1个 PCI-E 3.0 x8，1个 PCI-E 2.0 x4 (in x8)</td></tr><tr><td align="left"><strong>USB 接口</strong></td><td align="left">2个 USB 3.0 (1 Type-A + 1 via header)，6个 USB 2.0 (4 rear + 2 via header)</td></tr><tr><td align="left"><strong>管理功能</strong></td><td align="left">集成 IPMI 2.0 支持 KVM 和专用 LAN</td></tr><tr><td align="left"><strong>其他特性</strong></td><td align="left">SATA DOM 电源连接器支持</td></tr></tbody></table><p>主板长这个样子</p><p><img src="https://www.supermicro.com/CDS_Image/uploads/imagecache/600px_wide/intel_motherboard_active/x10sll-fs.jpg" alt="Supermicro Motherboard Xeon Boards X10SLL-F"></p><h2 id="官方资料："><a href="#官方资料：" class="headerlink" title="官方资料："></a>官方资料：</h2><p>服务器介绍页：<a href="https://www.supermicro.org.cn/en/products/system/1u/5018/SYS-5018D-MF.cfm">5018D-MF | 1U | SuperServers | Products | Super Micro Computer, Inc</a></p><p>主板介绍页:<a href="https://www.supermicro.org.cn/zh_cn/products/motherboard/X10SLL-F">X10SLL-F | Motherboards | Products | Super Micro Computer, Inc.</a></p><h2 id="为什么要买它呢？"><a href="#为什么要买它呢？" class="headerlink" title="为什么要买它呢？"></a>为什么要买它呢？</h2><p>主要还是为了体验它的IPMI</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/5746c1e472bc72f8322ff20744907fe.jpg" alt="默认账号密码都是ADMIN"></p><p>它的IPMI支持中文和Java iKVM&#x2F;HTML5 控制（更新最新BMC固件）</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309215527588.png" alt="image-20250309215527588"></p><h2 id="IPMI的使用"><a href="#IPMI的使用" class="headerlink" title="IPMI的使用"></a>IPMI的使用</h2><p>这里讲一下IPMI的使用</p><blockquote><p>IPMI（Intelligent Platform Management Interface，智能平台管理接口）是一种基于硬件的远程服务器管理标准，其核心组件是 <strong>BMC（Baseboard Management Controller，基板管理控制器）</strong>。BMC 是一个独立于服务器主系统的微控制器，直接嵌入在服务器主板上，通过专用网络接口（带外管理）提供对服务器的底层硬件控制与监控功能。</p><h3 id="IPMI-的核心功能"><a href="#IPMI-的核心功能" class="headerlink" title="IPMI 的核心功能"></a>IPMI 的核心功能</h3><ol><li><strong>带外管理（Out-of-Band Management）</strong><br>不依赖服务器操作系统和常规网络，通过独立的管理网络（如专用 IPMI&#x2F;BMC 网口）实现远程管理，即使服务器宕机或操作系统崩溃仍可操作。</li><li><strong>电源控制</strong><br>远程开关机、强制重启、断电等操作，无需物理接触设备。</li><li><strong>系统安装与维护</strong><br>挂载虚拟光驱（ISO 镜像）远程安装操作系统，或通过控制台重装&#x2F;修复系统。</li><li><strong>硬件监控</strong><br>实时监控 CPU 温度、风扇转速、电源状态、硬盘健康等硬件指标，触发告警或自动保护措施（如过热关机）。</li><li><strong>日志与故障诊断</strong><br>访问系统事件日志（SEL）、硬件错误日志，辅助定位故障原因。</li><li><strong>KVM over IP</strong><br>提供远程键盘、视频、鼠标控制，直接操作服务器 BIOS 或操作系统界面。</li></ol><hr><h3 id="BMC-的作用"><a href="#BMC-的作用" class="headerlink" title="BMC 的作用"></a>BMC 的作用</h3><ul><li><strong>IPMI 的硬件实现</strong>：BMC 是 IPMI 标准的物理载体，负责执行 IPMI 指令。</li><li><strong>独立运行</strong>：即使服务器断电，BMC 仍可通过备用电源（如 PSU 待机电源）保持运行。</li><li><strong>安全通信</strong>：支持用户权限管理、SSL&#x2F;TLS 加密、IP 过滤等功能，保障管理通道安全。</li></ul><hr><h3 id="厂商实现差异"><a href="#厂商实现差异" class="headerlink" title="厂商实现差异"></a>厂商实现差异</h3><p>尽管 IPMI 是通用标准，但各厂商会定制管理界面和扩展功能：</p><ul><li><strong>戴尔 iDRAC</strong>：集成生命周期控制器（自动化部署）、增强型硬件诊断。</li><li><strong>惠普 iLO</strong>：支持智能存储配置、能耗优化工具。</li><li><strong>华为 iBMC</strong>：融合智能诊断、批量固件升级。</li><li><strong>超微 IPMI</strong>：功能精简，仅提供基础管理（界面较原始），但兼容性强。</li><li><strong>IBM&#x2F;Lenovo IMM&#x2F;XClarity</strong>：深度集成企业级管理套件（如 Lenovo XClarity）。</li></ul></blockquote><p>你需要准备一根网线+一台安装好Java的电脑</p><p>下载并安装Java8（一路安装即可） <a href="https://www.java.com/zh-CN/download/">https://www.java.com/zh-CN/download/</a></p><p>将网线插入BMC口</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309222551310.png" alt="image-20250309222551310"></p><h3 id="配置BMC"><a href="#配置BMC" class="headerlink" title="配置BMC"></a>配置BMC</h3><p>开机+狂按<strong>Delete</strong>按键进入BIOS</p><p>移动到<strong>IPMI</strong>项（有的服务器叫<strong>Server Mgmt</strong>），选择<strong>BMC Network Configuration</strong> </p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309222343220.png" alt="image-20250309222343220"></p><ol><li>启用 <code>Update IPMI LAN Configuration</code> → 设为 <code>Yes</code>。</li><li>选择 <code>Configuration Address Source</code> → <code>DHCP</code> 或 <code>Static</code>。</li><li>若选择 <code>Static</code>：<ul><li>填写 <code>Station IP Address</code>、<code>Subnet Mask</code>、<code>Gateway IP Address</code>。</li><li>例如 IP地址192.168.10.2 、子网掩码：255.255.255.0、网关：192.168.10.1</li></ul></li><li>保存设置并重启服务器，使配置生效。</li></ol><blockquote><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a><strong>注意事项</strong></h3><ul><li><strong>DHCP 模式</strong>：需确保网络中存在 DHCP 服务器，且 IPMI 能正常获取 IP。</li><li><strong>Static 模式</strong>：避免 IP 地址冲突，建议提前规划局域网 IP 分配。</li><li><strong>MAC 地址</strong>：用于网络绑定或防火墙规则时需记录此地址。</li><li><strong>远程访问</strong>：配置完成后，可通过 IP 地址访问 IPMI Web 界面（默认端口 443&#x2F;623）。</li></ul></blockquote><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309223428520.png" alt="image-20250309223428520"></p><h3 id="使用IPMI"><a href="#使用IPMI" class="headerlink" title="使用IPMI"></a>使用IPMI</h3><p>然后连接服务器BMC口和电脑，在浏览器输入你配置的IP</p><p><a href="https://192.168.10.x/">https://192.168.10.x</a>  (一定是https:&#x2F;&#x2F;)</p><p>输入账号密码 默认账号密码都是ADMIN</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/5746c1e472bc72f8322ff20744907fe.jpg" alt="默认账号密码都是ADMIN"></p><p>登录后可以切换为中文</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309223933922.png" alt="image-20250309223933922"></p><p>这里我们使用Java IKVM来控制服务器、安装系统等</p><p>首先需要配置一下Java</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309224217212.png" alt="image-20250309224217212"></p><p>将你的IPMI地址加入例外站点列表</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309224331195.png" alt="image-20250309224331195"></p><p>点击重定向控制台，会下载下来一个<strong>launch.jnlp</strong>文件，双击，一路同意即可进入控制台</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309224048311.png" alt="image-20250309224048311"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309224555376.png" alt="image-20250309224555376"></p><h3 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h3><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi2.png" alt="img"></p><ol><li>选择 <strong>virtual storage</strong></li><li>选择 <strong>cdrom&amp;iso</strong></li><li>选择 iso 文件</li><li>打开文件夹选择 iso 文件</li><li>插入</li></ol><p>这里为了方便，使用Netboot安装镜像(在线安装)</p><p><a href="https://netboot.xyz/downloads/">https://netboot.xyz/downloads/</a></p><p><a href="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301075155342.png"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301075155342.png" alt="image-20250301075155342"></a></p><p>重启服务器，狂按 F11，进入 启动项菜单</p><p>怕有人不会，上一张图</p><p><a href="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi3.png"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi3.png" alt="img"></a></p><p><a href="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi4.png"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi4.png" alt="img"></a></p><p>根据你选择挂载，我刚刚挂载是 cdrom，因此选择是 cdrom 这个启动项。</p><p>进入后填写你的公网IP、子网掩码、网关、DNS安装即可，具体步骤略</p><p><a href="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/netboot.xyz-d976acd5e46c61339230d38e767fbdc2.gif"><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/netboot.xyz-d976acd5e46c61339230d38e767fbdc2.gif" alt="netboot.xyz menu"></a></p><h2 id="升级BMC固件"><a href="#升级BMC固件" class="headerlink" title="升级BMC固件"></a>升级BMC固件</h2><p>下载 BIOS &#x2F; BMC &#x2F; Bundle Firmware for MBD-X10SLL-F</p><p> <a href="https://www.supermicro.com/zh_cn/support/resources/downloadcenter/firmware/MBD-X10SLL-F/BMC">https://www.supermicro.com/zh_cn/support/resources/downloadcenter/firmware/MBD-X10SLL-F/BMC</a></p><p>解压、上传你的固件升级即可</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309225242239.png" alt="image-20250309225242239"></p><h2 id="升级BIOS"><a href="#升级BIOS" class="headerlink" title="升级BIOS"></a>升级BIOS</h2><p>超微的主板自带的 IPMI 有些高级功能是需要授权才能解锁的，比如在线更新 BIOS，RAID 管理等等</p><p>这里一个密钥生成器</p><p><a href="https://tql.ink/ipmi/">https://tql.ink/ipmi/</a></p><p>填写你的 IPMI MAC 地址，生成一个即可</p><h3 id="BMC-MAC-地址在哪查看？"><a href="#BMC-MAC-地址在哪查看？" class="headerlink" title="BMC MAC 地址在哪查看？"></a>BMC MAC 地址在哪查看？</h3><p>登录你的主板 IPMI，首页就能看到 BMC MAC 地址</p><h3 id="怎么激活？"><a href="#怎么激活？" class="headerlink" title="怎么激活？"></a>怎么激活？</h3><p>登录 IPMI，找到下拉栏的 Other（其他），然后 Activate License 这个页面</p><p>把生成出来的 License Key 填进去就行了</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309225604976.png" alt="image-20250309225604976"></p><p>升级步骤还是一样</p><p>下载BIOS升级文件</p><p>BIOS &#x2F; BMC &#x2F; Bundle Firmware for MBD-X10SLL-F</p><p><a href="https://www.supermicro.com/zh_cn/support/resources/downloadcenter/firmware/MBD-X10SLL-F/BIOS">https://www.supermicro.com/zh_cn/support/resources/downloadcenter/firmware/MBD-X10SLL-F/BIOS</a></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250309225639587.png" alt="image-20250309225639587"></p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>这个服务器用起来还是不错的，噪音还是挺小的</p><p>就先写到这里</p><p>更多内容（使用手册、各种驱动、适配的硬件）可以看</p><p><a href="https://www.supermicro.org.cn/zh_cn/products/motherboard/X10SLL-F">https://www.supermicro.org.cn/zh_cn/products/motherboard/X10SLL-F</a></p><p>未完待续….</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;最近在咸鱼上淘了一台1U半高服务器回来，型号为SuperMicro（超微） SuperServer5018D-MF+X10SLL-F主板&lt;/</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="服务器" scheme="https://blog.quickso.cn/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="SuperMicro" scheme="https://blog.quickso.cn/tags/SuperMicro/"/>
    
    <category term="ipmi" scheme="https://blog.quickso.cn/tags/ipmi/"/>
    
  </entry>
  
  <entry>
    <title>独立服务器安装ProxmoxVE并配置NAT网络转发</title>
    <link href="https://blog.quickso.cn/2025/03/01/%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85ProxmoxVE%E5%B9%B6%E9%85%8D%E7%BD%AENAT%E7%BD%91%E7%BB%9C%E8%BD%AC%E5%8F%91/"/>
    <id>https://blog.quickso.cn/2025/03/01/%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E8%A3%85ProxmoxVE%E5%B9%B6%E9%85%8D%E7%BD%AENAT%E7%BD%91%E7%BB%9C%E8%BD%AC%E5%8F%91/</id>
    <published>2025-02-28T23:36:10.000Z</published>
    <updated>2026-02-06T13:40:34.783Z</updated>
    
    <content type="html"><![CDATA[<p>最近买了一台美国独服，只有一个IPv4，这里记录一下ProxmoxVE安装以及网络配置</p><h1 id="1-安装Debian12"><a href="#1-安装Debian12" class="headerlink" title="1.安装Debian12"></a>1.安装Debian12</h1><p>这里使用服务商提供的IPMI面板</p><h3 id="登陆-ipmi，获取-jnlp-文件"><a href="#登陆-ipmi，获取-jnlp-文件" class="headerlink" title="登陆 ipmi，获取 jnlp 文件"></a>登陆 ipmi，获取 jnlp 文件</h3><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi1.png" alt="img"></p><p>根据上图，点击监视窗口下载 jnlp。第一步完成</p><h3 id="安装-jdk-环境，用来打开-jnlp-文件"><a href="#安装-jdk-环境，用来打开-jnlp-文件" class="headerlink" title="安装 jdk 环境，用来打开 jnlp 文件"></a>安装 jdk 环境，用来打开 jnlp 文件</h3><p>这里推荐 jdk 版本 1.7 版本。这里也贴心的准备两个直连下载地址</p><ol><li>win 32 位： <a href="http://iso.nomao.top/iso/jdk1.732.exe">http://iso.nomao.top/iso/jdk1.732.exe</a></li><li>win 64 位：<a href="http://iso.nomao.top/iso/jdk1.7.exe">http://iso.nomao.top/iso/jdk1.7.exe</a></li></ol><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301075419142.png" alt="image-20250301075419142"></p><h3 id="双击打开-jnlp-文件，挂载-iso，进行安装"><a href="#双击打开-jnlp-文件，挂载-iso，进行安装" class="headerlink" title="双击打开 jnlp 文件，挂载 iso，进行安装"></a>双击打开 jnlp 文件，挂载 iso，进行安装</h3><h3 id="ipmi-白名单"><a href="#ipmi-白名单" class="headerlink" title="ipmi 白名单"></a>ipmi 白名单</h3><p>ipmi 为了安全，都会启用白名单 ip 访问，因此 java ikvm 也需要使用此白名单 ip 访问。<br>但是国外的服务器，使用国内的 ip 访问 java ikvm 会很缓慢，连接失败都问题。<br>因此：解决方案有两个<br>①使用真全局代理（我使用的是这个)</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301074925018.png" alt="image-20250301074925018">②使用国外 win 机器，连接 java ikvm</p><p>成功连接 java ikvm 后，你会看到以下画面，请看图！</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi2.png" alt="img"></p><ol><li>选择 virtual storage</li><li>选择 cdrom&amp;iso</li><li>选择 iso 文件</li><li>打开文件夹选择 iso 文件</li><li>插入</li></ol><p>这里为了方便，使用Netboot安装镜像(在线安装)</p><p><a href="https://netboot.xyz/downloads/">https://netboot.xyz/downloads/</a></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301075155342.png" alt="image-20250301075155342"></p><h3 id="重启服务器，狂按-F11，进入-启动项菜单"><a href="#重启服务器，狂按-F11，进入-启动项菜单" class="headerlink" title="重启服务器，狂按 F11，进入 启动项菜单"></a>重启服务器，狂按 F11，进入 启动项菜单</h3><p>怕有人不会，上一张图</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi3.png" alt="img"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/ipmi4.png" alt="img"></p><p>根据你选择挂载，我刚刚挂载是 cdrom，因此选择是 cdrom 这个启动项。</p><p>进入后填写你的公网IP、子网掩码、网关、DNS安装即可，具体步骤略</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/netboot.xyz-d976acd5e46c61339230d38e767fbdc2.gif" alt="netboot.xyz menu"></p><h1 id="2-安装Proxmox-VE"><a href="#2-安装Proxmox-VE" class="headerlink" title="2.安装Proxmox VE"></a>2.安装Proxmox VE</h1><h3 id="1-配置hosts文件"><a href="#1-配置hosts文件" class="headerlink" title="1.配置hosts文件"></a>1.配置hosts文件</h3><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">nano /etc/hosts<br>修改为下面格式，prox4m1为你的主机名，可以自定义。<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">15</span>.<span class="hljs-number">77</span>为公网IP<br><span class="hljs-number">127.0.0.1</span>       localhost<br><span class="hljs-number">192.168.15.77</span>   prox4m1.proxmox.com prox4m1<br><br># The following lines are desirable for IPv6 capable hosts<br>::<span class="hljs-number">1</span>     localhost ip6-localhost ip6-loopback<br>ff02::<span class="hljs-number">1</span> ip6-allnodes<br>ff02::<span class="hljs-number">2</span> ip6-allrouters<br></code></pre></td></tr></table></figure><h3 id="2-安装Proxmox-VE-1"><a href="#2-安装Proxmox-VE-1" class="headerlink" title="2.安装Proxmox VE"></a>2.安装Proxmox VE</h3><p>添加 Proxmox VE 仓库</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">echo <span class="hljs-string">&quot;deb [arch=amd64] http://download.proxmox.com/debian/pve bookworm pve-no-subscription&quot;</span> &gt; /etc/apt/sources<span class="hljs-meta">.list</span>.d/pve-install-repo<span class="hljs-meta">.list</span><br></code></pre></td></tr></table></figure><p>添加仓库 key </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">wget https://enterprise.proxmox.com/debian/proxmox-<span class="hljs-keyword">release</span>-bookworm.gpg -O /etc/apt/<span class="hljs-keyword">trusted</span>.gpg.d/proxmox-<span class="hljs-keyword">release</span>-bookworm.gpg <br># verify<br>sha512sum /etc/apt/<span class="hljs-keyword">trusted</span>.gpg.d/proxmox-<span class="hljs-keyword">release</span>-bookworm.gpg <br><span class="hljs-number">7</span>da6fe34168adc6e479327ba517796d4702fa2f8b4f0a9833f5ea6e6b48f6507a6da403a274fe201595edc86a84463d50383d07f64bdde2e3658108db7d6dc87 /etc/apt/<span class="hljs-keyword">trusted</span>.gpg.d/proxmox-<span class="hljs-keyword">release</span>-bookworm.gpg <br></code></pre></td></tr></table></figure><p>更新软件源和系统:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">apt <span class="hljs-keyword">update</span> &amp;&amp; apt <span class="hljs-keyword">full</span>-upgrade<br></code></pre></td></tr></table></figure><p>安装 Proxmox VE 内核</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nsis">apt install proxmox-default-kernel<br><br><span class="hljs-params">system</span>ctl <span class="hljs-keyword">reboot</span><br></code></pre></td></tr></table></figure><p>安装 Proxmox VE 软件包</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">apt install proxmox<span class="hljs-operator">-</span>ve <span class="hljs-keyword">postfix</span> <span class="hljs-keyword">open</span><span class="hljs-operator">-</span>iscsi chrony<br></code></pre></td></tr></table></figure><p>移除Debian内核</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">apt <span class="hljs-built_in">remove</span> linux-<span class="hljs-built_in">image</span>-amd64 &#x27;linux-<span class="hljs-built_in">image</span>-<span class="hljs-number">6.1</span>*&#x27;<br></code></pre></td></tr></table></figure><p>更新grub配置</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">update-grub</span><br></code></pre></td></tr></table></figure><p>移除os-prober包</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">apt <span class="hljs-built_in">remove</span> <span class="hljs-built_in">os</span>-prober<br></code></pre></td></tr></table></figure><p>Proxmox VE 网页访问</p><p>连接到管理Web界面（<code>https：// your-ip-address：8006</code>）。如果尚未添加任何用户，则应选择PAM身份验证领域并使用“ root”用户帐户登录。</p><h3 id="3-配置网络"><a href="#3-配置网络" class="headerlink" title="3.配置网络"></a>3.配置网络</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/network<br><span class="hljs-built_in">cp</span> interfaces interfaces.bk <span class="hljs-comment">#备份一下</span><br></code></pre></td></tr></table></figure><p>修改interfaces</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># network interface settings; autogenerated</span><br><span class="hljs-comment"># Please do NOT modify this file directly, unless you know what</span><br><span class="hljs-comment"># you&#x27;re doing.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># If you want to manage parts of the network configuration manually,</span><br><span class="hljs-comment"># please utilize the &#x27;source&#x27; or &#x27;source-directory&#x27; directives to do</span><br><span class="hljs-comment"># so.</span><br><span class="hljs-comment"># PVE will preserve these directives, but will NOT read its network</span><br><span class="hljs-comment"># configuration from sourced files, so do not attempt to move any of</span><br><span class="hljs-comment"># the PVE managed interfaces into external files!</span><br><br><span class="hljs-attribute">source</span> /etc/network/interfaces.d/*<br><br><span class="hljs-attribute">auto</span> lo<br><span class="hljs-attribute">iface</span> lo inet loopback<br><br><span class="hljs-attribute">auto</span> eno1<br><span class="hljs-attribute">iface</span> eno1 inet static<br><span class="hljs-attribute">address</span> 公网IP/<span class="hljs-number">31</span><br><span class="hljs-attribute">gateway</span> 公网网关<br><span class="hljs-attribute">dns</span>-nameservers <span class="hljs-number">8.8.8.8</span><br><span class="hljs-comment"># dns-* options are implemented by the resolvconf package, if installed</span><br><br><span class="hljs-attribute">iface</span> enp0s25 inet manual<br><br><span class="hljs-attribute">auto</span> vmbr0<br><span class="hljs-comment">#private sub network</span><br><span class="hljs-attribute">iface</span> vmbr0 inet static<br>        <span class="hljs-attribute">address</span>  <span class="hljs-number">10.10.10.1</span>/<span class="hljs-number">24</span><br>        <span class="hljs-attribute">bridge</span>-ports none<br>        <span class="hljs-attribute">bridge</span>-stp <span class="hljs-literal">off</span><br>        <span class="hljs-attribute">bridge</span>-fd <span class="hljs-number">0</span><br><br>        <span class="hljs-attribute">post</span>-up   echo <span class="hljs-number">1</span> &gt; /proc/sys/net/ipv4/ip_forward<br>        <span class="hljs-attribute">post</span>-up   iptables -t nat -A POSTROUTING -s &#x27;<span class="hljs-number">10.10.10.0</span>/<span class="hljs-number">24</span>&#x27; -o eno1 -j MASQUERADE<br>        <span class="hljs-attribute">post</span>-down iptables -t nat -D POSTROUTING -s &#x27;<span class="hljs-number">10.10.10.0</span>/<span class="hljs-number">24</span>&#x27; -o eno1 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>重启网络</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">systemctl restart networking</span><br></code></pre></td></tr></table></figure><p>配置好后是这样</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">执行 route -n<br>Kernel IP routing table<br>Destination     Gateway         Genmask         Flags Metric Ref    Use Iface<br><span class="hljs-number">0.0.0.0</span>         x.x.x.x   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>         UG    <span class="hljs-number">0</span>      <span class="hljs-number">0</span>        <span class="hljs-number">0</span> eno1<br><span class="hljs-number">10.10.10.0</span>      <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>         <span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">0</span>   U     <span class="hljs-number">0</span>      <span class="hljs-number">0</span>        <span class="hljs-number">0</span> vmbr0<br>x.x.x.x   <span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>         <span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">255</span>.<span class="hljs-number">254</span> U     <span class="hljs-number">0</span>      <span class="hljs-number">0</span>        <span class="hljs-number">0</span> eno1<br></code></pre></td></tr></table></figure><h1 id="3-创建kvm虚拟机"><a href="#3-创建kvm虚拟机" class="headerlink" title="3.创建kvm虚拟机"></a>3.创建kvm虚拟机</h1><blockquote><p>不是CT，pve直接可下载CT的模版</p><p>除了下面的方法，你也可以使用iso镜像安装</p></blockquote><h3 id="1-创建一个新的虚拟机"><a href="#1-创建一个新的虚拟机" class="headerlink" title="1.创建一个新的虚拟机"></a>1.创建一个新的虚拟机</h3><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">qm create 103</span> <span class="hljs-literal">--</span><span class="hljs-comment">memory 2048</span> <span class="hljs-literal">--</span><span class="hljs-comment">core 2</span> <span class="hljs-literal">--</span><span class="hljs-comment">name ubuntu</span><span class="hljs-literal">-</span><span class="hljs-comment">cloud</span> <span class="hljs-literal">--</span><span class="hljs-comment">net0 virtio</span><span class="hljs-string">,</span><span class="hljs-comment">bridge=vmbr0</span><br></code></pre></td></tr></table></figure><p>这里是创建 id 为 103 的虚拟机，内存大小为 2G ， CPU 核心数量 2，名称是 ubuntu-cloud </p><p>并设置网卡桥接到 vmbr0</p><h3 id="2-准备-Cloud-Init-镜像"><a href="#2-准备-Cloud-Init-镜像" class="headerlink" title="2.准备 Cloud-Init 镜像"></a>2.准备 Cloud-Init 镜像</h3><p>Cloud-Init 需要特定镜像支持。推荐使用官方提供的预装 Cloud-Init 的镜像，例如：</p><ul><li><a href="https://cloud.debian.org/images/cloud/">https://cloud.debian.org/images/cloud/</a></li><li><a href="https://cloud-images.ubuntu.com/releases/">https://cloud-images.ubuntu.com/releases/</a></li><li><a href="https://down.idc.wiki/Image/realServer-Template/current/qcow2/">https://down.idc.wiki/Image/realServer-Template/current/qcow2/</a></li></ul><p>下载镜像后，上传到 PVE 存储：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># 示例：将 镜像上传到 PVE 的 `<span class="hljs-keyword">local</span>` 存储<br>qm importdisk &lt;VMID&gt; /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/xxx.img <span class="hljs-keyword">local</span><br>或者<br>qm importdisk &lt;VMID&gt; /<span class="hljs-type">path</span>/<span class="hljs-keyword">to</span>/xxx.qcow2 <span class="hljs-keyword">local</span> <span class="hljs-comment">--format=qcow</span><br></code></pre></td></tr></table></figure><p>例如</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">qm importdisk <span class="hljs-number">103</span> noble-<span class="hljs-keyword">server</span>-cloudimg-amd64.img <span class="hljs-keyword">local</span><br></code></pre></td></tr></table></figure><p>将新导入的磁盘以 scsi 驱动器的方式装载到新建的虚拟机的 scsi 控制器</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qm</span> set <span class="hljs-number">103</span> --scsihw virtio-scsi-pci --scsi0 local-lvm/vm-<span class="hljs-number">103</span>-disk-<span class="hljs-number">0</span><br><span class="hljs-attribute">qm</span> set <span class="hljs-number">103</span> --scsihw virtio-scsi-pci --scsi0 local:<span class="hljs-number">103</span>/vm-<span class="hljs-number">103</span>-disk-<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250301101749350.png" alt="image-20250301101749350"></p><h3 id="添加-cloud-init-驱动器"><a href="#添加-cloud-init-驱动器" class="headerlink" title="添加 cloud init 驱动器"></a>添加 cloud init 驱动器</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">qm <span class="hljs-keyword">set</span> <span class="hljs-number">103</span> <span class="hljs-comment">--ide2 local:cloudinit</span><br></code></pre></td></tr></table></figure><h3 id="将-cloud-init-驱动器设置为可启动并限制-BIOS-仅从磁盘启动"><a href="#将-cloud-init-驱动器设置为可启动并限制-BIOS-仅从磁盘启动" class="headerlink" title="将 cloud init 驱动器设置为可启动并限制 BIOS 仅从磁盘启动"></a>将 cloud init 驱动器设置为可启动并限制 BIOS 仅从磁盘启动</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">qm <span class="hljs-keyword">set</span> 103 <span class="hljs-params">--boot</span> c <span class="hljs-params">--bootdisk</span> scsi0<br></code></pre></td></tr></table></figure><h3 id="添加串口控制台"><a href="#添加串口控制台" class="headerlink" title="添加串口控制台"></a>添加串口控制台</h3><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">qm <span class="hljs-keyword">set</span> 103 <span class="hljs-params">--serial0</span> socket <span class="hljs-params">--vga</span> serial0<br></code></pre></td></tr></table></figure><h2 id="现在先不要启动虚拟机"><a href="#现在先不要启动虚拟机" class="headerlink" title="现在先不要启动虚拟机"></a>现在先不要启动虚拟机</h2><p>现在可以配置新虚拟机的硬件和 cloud init 选项，配置好之后转换成模板。磁盘大小的调整可以在转换成模板前调整，或者从模板克隆出新的虚拟机时候再调整。</p><ul><li>用户：root</li><li>密码：改为你想要的root密码</li><li>IP配置：<br>IPv4&#x2F;CIDR：填你想要的静态IP，如：10.10.10.2&#x2F;24<br>网关：第2步你自己配置的虚拟网卡，如：10.10.10.1</li></ul><h3 id="创建模板（也可以在-Web-UI-操作）"><a href="#创建模板（也可以在-Web-UI-操作）" class="headerlink" title="创建模板（也可以在 Web UI 操作）"></a>创建模板（也可以在 Web UI 操作）</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qm</span> template <span class="hljs-number">103</span><br></code></pre></td></tr></table></figure><h3 id="克隆模板（也可以在-Web-UI-操作）"><a href="#克隆模板（也可以在-Web-UI-操作）" class="headerlink" title="克隆模板（也可以在 Web UI 操作）"></a>克隆模板（也可以在 Web UI 操作）</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">qm <span class="hljs-keyword">clone</span> <span class="hljs-title">103</span> <span class="hljs-number">135</span> --name huihui --full<br></code></pre></td></tr></table></figure><h2 id="排障"><a href="#排障" class="headerlink" title="排障"></a>排障</h2><p>如果需要重置机器 id</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -f /etc/machine-id<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">rm</span> -f /var/lib/dbus/machine-id<br></code></pre></td></tr></table></figure><p>然后关机，下次启动会生成新的机器 id，如果没有生成，可以运行以下命令：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">sudo systemd-machine-<span class="hljs-built_in">id</span>-setup<br></code></pre></td></tr></table></figure><p>也可以使用我的脚本快速创建模板</p><p><a href="https://github.com/muzihuaner/ProxmoxVE-template-maker">https://github.com/muzihuaner/ProxmoxVE-template-maker</a></p><h3 id="5-开机"><a href="#5-开机" class="headerlink" title="5.开机"></a>5.开机</h3><p>点启动，开机后先用pve控制台打开登录你设置的root和密码</p><ul><li>运行<code>ip a</code>，看下静态IP类似10.10.10.2</li><li>看下外网通吗，再运行<code>ping 8.8.8.8</code></li></ul><h3 id="6-配置nat端口转发"><a href="#6-配置nat端口转发" class="headerlink" title="6.配置nat端口转发"></a>6.配置nat端口转发</h3><p><a href="https://github.com/muzihuaner/NATScript/">https://github.com/muzihuaner/NATScript/</a></p><blockquote><p>[!NOTE]</p><p>没网？<br>如果到最后一步，你发现nat机无法连接外网，可能是转发规则设置错了<br>在宿主机运行 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> iptables -t nat -A POSTROUTING -s <span class="hljs-string">&#x27;你的内网网关ip/24&#x27;</span> -o 你宿主机的网卡接口 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>例如：<code>sudo iptables -t nat -A POSTROUTING -s &#39;10.10.10.0/24&#39; -o eno1 -j MASQUERADE</code></p></blockquote><p>大概就这些…有其他的我再更新…未完待续</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近买了一台美国独服，只有一个IPv4，这里记录一下ProxmoxVE安装以及网络配置&lt;/p&gt;
&lt;h1 id=&quot;1-安装Debian12&quot;&gt;&lt;a href=&quot;#1-安装Debian12&quot; class=&quot;headerlink&quot; title=&quot;1.安装Debian12&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="运维" scheme="https://blog.quickso.cn/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="独立服务器" scheme="https://blog.quickso.cn/tags/%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
    <category term="ProxmoxVE" scheme="https://blog.quickso.cn/tags/ProxmoxVE/"/>
    
  </entry>
  
  <entry>
    <title>VMwareESXI密钥/ISO镜像</title>
    <link href="https://blog.quickso.cn/2025/02/28/VMwareESXI%E5%AF%86%E9%92%A5-ISO%E9%95%9C%E5%83%8F/"/>
    <id>https://blog.quickso.cn/2025/02/28/VMwareESXI%E5%AF%86%E9%92%A5-ISO%E9%95%9C%E5%83%8F/</id>
    <published>2025-02-28T14:28:54.000Z</published>
    <updated>2026-02-06T13:40:34.770Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VMwareESXI密钥-ISO镜像"><a href="#VMwareESXI密钥-ISO镜像" class="headerlink" title="VMwareESXI密钥&#x2F;ISO镜像"></a>VMwareESXI密钥&#x2F;ISO镜像</h1><p>它们应该可以工作。适用于主机系统的所有核心。也可以从此处下载 ESXi。</p><h2 id="下载链接"><a href="#下载链接" class="headerlink" title="下载链接:"></a>下载链接:</h2><h4 id="vCenter"><a href="#vCenter" class="headerlink" title="vCenter"></a>vCenter</h4><ul><li><a href="#vcenter-server-8-standard">vCenter Server 8 Standard</a></li><li><a href="#vcenter-server-7">vCenter Server 7</a></li></ul><h4 id="ESXi"><a href="#ESXi" class="headerlink" title="ESXi"></a>ESXi</h4><ul><li><a href="#esxi-8">ESXi 8</a></li><li><a href="#esxi-7-enterprise-plus">ESXi 7 Enterprise Plus</a></li><li><a href="#esxi-6-enterprise-plus">ESXi 6 Enterprise Plus</a></li></ul><h4 id="Workstation"><a href="#Workstation" class="headerlink" title="Workstation"></a>Workstation</h4><ul><li><a href="#workstation-17">Workstation 17</a></li><li><a href="#workstation-16">Workstation 16</a></li></ul><h4 id="Fusion"><a href="#Fusion" class="headerlink" title="Fusion"></a>Fusion</h4><ul><li><a href="#fusion-13-pro">Fusion 13 Pro</a></li></ul><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><h3 id="ESXi-1"><a href="#ESXi-1" class="headerlink" title="ESXi"></a>ESXi</h3><div>    <img src="https://gist.github.com/user-attachments/assets/facf84ef-ba73-47c8-9e37-e531dc8602a7" width="24" height="24" alt="VMWare ESXi 8 Current logo icon"/>    <br>    <a href="https://dl.hausmer.com/pub/VMware-VMvisor-Installer-8.0U3b-24280767.iso">ESXi 8.0U3b</a> (build 24280767)  <p>   <a href="https://dl.hausmer.com/pub/ESXI-8.0U2b.iso">ESXi 8.0U2b</a> (build 23305546)</p></div><div>    <img src="https://gist.github.com/user-attachments/assets/e916f8b4-9c7f-49f9-a777-ba4be2226cef" width="24" height="24" alt="VMWare ESXi 7 Old logo icon"/>    <br>    <a href="https://dl.hausmer.com/pub/VMware-VMvisor-Installer-7.0U3n-21930508.iso">ESXi 7.0U3n</a> (build 21930508)</div><h3 id="工作站"><a href="#工作站" class="headerlink" title="工作站"></a>工作站</h3><div>   <img src="https://gist.github.com/user-attachments/assets/4440ff01-70a2-4698-8984-f2eb1cb9d80f" width="24" height="24" alt="VMWare Workstation logo icon"/>    <br>    <a href="https://dl.hausmer.com/pub/VMware-workstation-full-17.5.1-23298084.exe">Workstation 17.5.1 Windows</a> (build 23298084)     <br>    <a href="https://dl.hausmer.com/pub/VMware-Workstation-Full-17.5.1-23298084.x86_64.bundle">Workstation 17.5.1 Linux</a> (build 23298084)</div><h2 id="vCenter-Server"><a href="#vCenter-Server" class="headerlink" title="vCenter Server"></a>vCenter Server</h2><h3 id="vCenter-Server-8-Standard"><a href="#vCenter-Server-8-Standard" class="headerlink" title="vCenter Server 8 Standard"></a>vCenter Server 8 Standard</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>4F282-0MLD2-M8869-T89G0-CF240</td><td>✅</td></tr><tr><td>0F41K-0MJ4H-M88U1-0C3N0-0A214</td><td>✅</td></tr></tbody></table><h3 id="vCenter-Server-7"><a href="#vCenter-Server-7" class="headerlink" title="vCenter Server 7"></a>vCenter Server 7</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>4F282-0MLD2-M8869-T89G0-CF240</td><td>✅</td></tr><tr><td>0F41K-0MJ4H-M88U1-0C3N0-0A214</td><td>✅</td></tr></tbody></table><h2 id="ESXi-2"><a href="#ESXi-2" class="headerlink" title="ESXi"></a>ESXi</h2><h3 id="ESXi-8"><a href="#ESXi-8" class="headerlink" title="ESXi 8"></a>ESXi 8</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>4V492-44210-48830-931GK-2PRJ4</td><td>✅</td></tr><tr><td>HG00K-03H8K-48929-8K1NP-3LUJ4</td><td>✅</td></tr></tbody></table><h3 id="ESXi-7-Enterprise-Plus"><a href="#ESXi-7-Enterprise-Plus" class="headerlink" title="ESXi 7 Enterprise Plus"></a>ESXi 7 Enterprise Plus</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>JJ2WR-25L9P-H71A8-6J20P-C0K3F</td><td>✅</td></tr><tr><td>HN2X0-0DH5M-M78Q1-780HH-CN214</td><td>✅</td></tr><tr><td>JH09A-2YL84-M7EC8-FL0K2-3N2J2</td><td>✅</td></tr></tbody></table><h3 id="ESXi-6-Enterprise-Plus"><a href="#ESXi-6-Enterprise-Plus" class="headerlink" title="ESXi 6 Enterprise Plus"></a>ESXi 6 Enterprise Plus</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>1G4WK-4YH54-080P9-C9AZP-9GHQF</td><td>✅</td></tr></tbody></table><h2 id="Workstation-1"><a href="#Workstation-1" class="headerlink" title="Workstation"></a>Workstation</h2><h3 id="Workstation-17"><a href="#Workstation-17" class="headerlink" title="Workstation 17"></a>Workstation 17</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>ZV3JH-4LXE1-M88MZ-HQXXX-XG0FD</td><td>✅</td></tr><tr><td>AG5RU-6AXDL-H81FZ-KQYN9-M32E0</td><td>✅</td></tr></tbody></table><h3 id="Workstation-16"><a href="#Workstation-16" class="headerlink" title="Workstation 16"></a>Workstation 16</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>4F40H-4ML1K-M89U0-0C2N4-1AKL4</td><td>❓</td></tr></tbody></table><h2 id="Fusion-1"><a href="#Fusion-1" class="headerlink" title="Fusion"></a>Fusion</h2><h3 id="Fusion-13-Pro"><a href="#Fusion-13-Pro" class="headerlink" title="Fusion 13 Pro"></a>Fusion 13 Pro</h3><table><thead><tr><th>Key</th><th>Tested</th></tr></thead><tbody><tr><td>4A4RR-813DK-M81A9-4U35H-06KND</td><td>✅</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;VMwareESXI密钥-ISO镜像&quot;&gt;&lt;a href=&quot;#VMwareESXI密钥-ISO镜像&quot; class=&quot;headerlink&quot; title=&quot;VMwareESXI密钥&amp;#x2F;ISO镜像&quot;&gt;&lt;/a&gt;VMwareESXI密钥&amp;#x2F;ISO镜像&lt;/h1</summary>
      
    
    
    
    <category term="资源" scheme="https://blog.quickso.cn/categories/%E8%B5%84%E6%BA%90/"/>
    
    
    <category term="VMware" scheme="https://blog.quickso.cn/tags/VMware/"/>
    
    <category term="ESXI" scheme="https://blog.quickso.cn/tags/ESXI/"/>
    
  </entry>
  
  <entry>
    <title>Minecraft服务器搭建资源大杂烩</title>
    <link href="https://blog.quickso.cn/2025/02/22/Minecraft%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E8%B5%84%E6%BA%90%E5%A4%A7%E6%9D%82%E7%83%A9/"/>
    <id>https://blog.quickso.cn/2025/02/22/Minecraft%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E8%B5%84%E6%BA%90%E5%A4%A7%E6%9D%82%E7%83%A9/</id>
    <published>2025-02-22T13:45:53.000Z</published>
    <updated>2026-02-06T13:40:34.766Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Java下载"><a href="#Java下载" class="headerlink" title="Java下载"></a>Java下载</h3><p><a href="https://docs.papermc.io/misc/java-install">https://docs.papermc.io/misc/java-install</a></p><p><a href="http://mirror.nju.edu.cn/openjdk/">http://mirror.nju.edu.cn/openjdk/</a></p><h3 id="Minecraft-Paper服务端"><a href="#Minecraft-Paper服务端" class="headerlink" title="Minecraft Paper服务端"></a>Minecraft Paper服务端</h3><p><a href="https://papermc.io/software/paper">https://papermc.io/software/paper</a></p><table><thead><tr><th>Paper 版本</th><th>推荐Java版本</th></tr></thead><tbody><tr><td>1.8 to 1.11</td><td>Java 8</td></tr><tr><td>1.12 to 1.16.4</td><td>Java 11</td></tr><tr><td>1.16.5</td><td>Java 16</td></tr><tr><td>1.17.1-1.18.1+</td><td>Java 21</td></tr></tbody></table><p>启动脚本生成器</p><p><a href="https://docs.papermc.io/misc/tools/start-script-gen">https://docs.papermc.io/misc/tools/start-script-gen</a></p><p>启动脚本示例</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">java -Xms2048M -Xmx2048M -XX:+AlwaysPreTouch -XX:+DisableExplicitGC -XX:+ParallelRefProcEnabled -XX:+PerfDisableSharedMem -XX:+UnlockExperimentalVMOptions -XX:+UseG1GC -XX:G1HeapRegionSize=8M -XX:G1HeapWastePercent=5 -XX:G1MaxNewSizePercent=40 -XX:G1MixedGCCountTarget=4 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1NewSizePercent=30 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:G1ReservePercent=20 -XX:InitiatingHeapOccupancyPercent=15 -XX:MaxGCPauseMillis=200 -XX:MaxTenuringThreshold=1 -XX:SurvivorRatio=32 -Dusing.aikars.flags=https://mcflags.emc.gs -Daikars.new.flags=<span class="hljs-literal">true</span> -jar server.jar nogui<br></code></pre></td></tr></table></figure><h3 id="插件下载"><a href="#插件下载" class="headerlink" title="插件下载"></a>插件下载</h3><p><a href="https://hangar.papermc.io/">https://hangar.papermc.io/</a></p><p><a href="https://modrinth.com/plugins">https://modrinth.com/plugins</a></p><p><a href="https://dev.bukkit.org/bukkit-plugins">https://dev.bukkit.org/bukkit-plugins</a></p><p><a href="https://www.spigotmc.org/resources/">https://www.spigotmc.org/resources/</a></p><h3 id="插件推荐"><a href="#插件推荐" class="headerlink" title="插件推荐"></a>插件推荐</h3><table><thead><tr><th align="left">插件名称</th><th align="left">主要功能概述</th><th align="left">备注&#x2F;常见用途</th></tr></thead><tbody><tr><td align="left"><strong>AuthMe (5.7.0-FORK-b53)</strong></td><td align="left">玩家登录与注册系统。要求玩家设置密码并在每次进入服务器时登录。</td><td align="left">防止盗号，基础服务器安全必备。Fork 版本可能包含特定优化或功能。</td></tr><tr><td align="left"><strong>BlueMap (5.7)</strong></td><td align="left">为你的 Minecraft 世界生成实时、交互式的网页地图。</td><td align="left">玩家可以在浏览器中查看服务器地图、定位地标等。</td></tr><tr><td align="left"><strong>CMI (9.7.15.5)</strong></td><td align="left"><strong>综合管理插件 (Comprehensive Management Interface)</strong>。提供大量功能，如传送、经济、飞行、邮件、公告板、传送点等。</td><td align="left">旨在替代多个单一功能插件。功能非常庞大。</td></tr><tr><td align="left"><strong>CMIEInjector (1.0.2.3)</strong></td><td align="left">CMI 的扩展&#x2F;依赖组件。处理 CMI 与其他插件的集成和事件注入。</td><td align="left">通常与 CMI 主插件一起安装，是其运行所必需的。</td></tr><tr><td align="left"><strong>CMILib (1.5.5.5)</strong></td><td align="left">CMI 的核心库。提供 CMI 及其扩展插件运行所需的基础代码和 API。</td><td align="left">是 CMI 主插件和其相关插件（如 CMIEInjector）运行的基础依赖。</td></tr><tr><td align="left"><strong>Citizens (2.0.37-SNAPSHOT)</strong></td><td align="left"><strong>NPC 系统</strong>。允许创建和管理非玩家角色（NPC）。</td><td align="left">用于创建商人、向导、守卫、任务NPC等。是许多 RPG 或功能服务器的核心。需要配合其他插件赋予 NPC 更多功能。</td></tr><tr><td align="left"><strong>CoreProtect (22.4)</strong></td><td align="left"><strong>方块&#x2F;容器&#x2F;命令记录与回滚</strong>。记录玩家和自然事件的方块破坏、放置、容器交互、命令执行等。</td><td align="left">用于查熊、恢复破坏、回滚地形、查看物品去向等。服务器管理和安全的重要工具。</td></tr><tr><td align="left"><strong>Dominion (4.3.5-beta)</strong></td><td align="left"><strong>领地&#x2F;区域保护插件</strong>。允许玩家创建私人领地，控制领地内的权限（PVP、建造、方块交互等）。</td><td align="left">保护玩家建筑和资源不被他人破坏或盗窃。</td></tr><tr><td align="left"><strong>Jobs (5.2.6.1)</strong></td><td align="left"><strong>职业与经济系统</strong>。玩家可以选择职业（如矿工、农夫、伐木工），通过完成相应活动（挖矿、种植、砍树）赚钱。</td><td align="left">增加游戏目标和玩法，驱动服务器经济。通常需要配合经济插件（如 CMI 内置经济或 Vault 兼容的经济插件）。</td></tr><tr><td align="left"><strong>LiveKit (1.4.8)</strong></td><td align="left">将 <strong>Livekitapp</strong> 与 Minecraft 游戏内语音聊天连接起来。</td><td align="left">允许玩家在游戏内通过指定的 APP文字交流。增强社交体验。</td></tr><tr><td align="left"><strong>LuckPerms (5.4.40)</strong></td><td align="left"><strong>现代权限管理插件</strong>。用于管理玩家和用户组的权限节点。</td><td align="left">服务器权限系统的核心，控制玩家能执行什么命令、拥有什么功能。强大、高效、可扩展。</td></tr><tr><td align="left"><strong>MOTD (2.3.11)</strong></td><td align="left"><strong>自定义服务器列表信息</strong>。修改玩家在服务器列表中看到的服务器名称、描述、图标、玩家数量显示等。</td><td align="left">使服务器在列表里更吸引人，提供更多信息或个性化展示。</td></tr><tr><td align="left"><strong>Multiverse-Core (5.0.1)</strong></td><td align="left"><strong>多世界管理</strong>。创建和管理多个不同的世界（主世界、资源世界、地狱、末地、小游戏世界等）。</td><td align="left">实现服务器多世界架构的基础。控制世界的生成、传送规则、环境设置等。</td></tr><tr><td align="left"><strong>PlaceholderAPI (2.11.6)</strong></td><td align="left"><strong>占位符 API</strong>。提供一套标准化的 <code>%placeholder%</code> 变量，供其他插件使用和扩展。</td><td align="left">是众多插件之间信息沟通的桥梁。允许在聊天、计分板、Tab列表、插件消息中显示来自其他插件的数据（如金钱、等级）。</td></tr><tr><td align="left"><strong>ProtocolLib (5.3.0)</strong></td><td align="left"><strong>底层数据包操作库</strong>。允许其他插件修改客户端和服务器之间传输的网络数据包。</td><td align="left">许多高级插件（如 ViaVersion, ViaBackwards, TAB, LiveKit, SkinsRestorer）的基础依赖，用于实现复杂功能。</td></tr><tr><td align="left"><strong>QuickShop-Hikari (6.2.0.9)</strong></td><td align="left"><strong>箱子商店系统</strong>。玩家可以创建基于箱子&#x2F;容器的商店进行物品买卖（收购&#x2F;出售）。</td><td align="left">建立玩家驱动的市场经济。Hikari 版本优化了数据库性能。</td></tr><tr><td align="left"><strong>SkinsRestorer (15.7.7)</strong></td><td align="left"><strong>皮肤修复与自定义</strong>。恢复正版皮肤显示，允许离线模式玩家设置自定义皮肤。</td><td align="left">解决非正版服务器皮肤显示问题，提升玩家个性化。</td></tr><tr><td align="left"><strong>TAB (5.2.0)</strong></td><td align="left"><strong>自定义玩家列表 (Tablist)</strong>。修改玩家按 Tab 键看到的玩家列表格式、内容、动画等。</td><td align="left">美化玩家列表，显示更多信息（如Ping、金钱、等级、服务器时间等），通常依赖 PlaceholderAPI。</td></tr><tr><td align="left"><strong>UnifiedMetrics (0.3.8)</strong></td><td align="left"><strong>服务器性能监控</strong>。收集并展示服务器性能指标（TPS, MSPT, 内存使用、实体数量等）。</td><td align="left">帮助管理员监控服务器运行状况，诊断性能瓶颈。</td></tr><tr><td align="left"><strong>Vault (1.7.3-CMI)</strong></td><td align="left"><strong>经济&#x2F;权限&#x2F;聊天 API</strong>。提供一个标准接口，让其他插件可以兼容不同的经济、权限、聊天插件。</td><td align="left"><strong>本身不提供经济&#x2F;权限&#x2F;聊天功能</strong>，是插件兼容性的桥梁。例如，让商店插件兼容各种经济插件。CMI 版表明 CMI 可能内置了兼容的 Vault API。</td></tr><tr><td align="left"><strong>ViaBackwards (5.4.1)</strong></td><td align="left"><strong>旧版本客户端兼容</strong>。允许 <strong>旧版本</strong> Minecraft 客户端（如 1.9-1.18.x）连接到使用 <strong>更新版本</strong> 的服务器。</td><td align="left">需要配合 ViaVersion 使用。扩大服务器支持的客户端范围。</td></tr><tr><td align="left"><strong>ViaVersion (5.4.2)</strong></td><td align="left"><strong>新版本客户端兼容</strong>。允许 <strong>新版本</strong> Minecraft 客户端（如 1.19+）连接到使用 <strong>旧版本</strong> 的服务器。也支持旧版客户端连新版服务器。</td><td align="left">实现跨版本游玩的核心插件。ViaBackwards 是其功能的扩展（专门处理旧客户端连新服务器）。</td></tr><tr><td align="left"><strong>Welcomer_Plus (2.6.6)</strong></td><td align="left"><strong>进服&#x2F;离服消息管理</strong>。自定义玩家加入和退出服务器时显示的欢迎&#x2F;告别消息、标题、动作栏等。</td><td align="left">提升玩家初次体验和仪式感。</td></tr><tr><td align="left"><strong>WorldEdit (7.3.14+…)</strong></td><td align="left"><strong>强大的世界编辑工具</strong>。提供大量命令用于快速选择、复制、粘贴、填充、替换地形和建筑方块。</td><td align="left">服务器建筑、地形改造、地图制作的必备神器。功能极其强大。</td></tr><tr><td align="left"><strong>eBackup (1.3.1)</strong></td><td align="left"><strong>服务器世界备份</strong>。定时自动备份服务器地图&#x2F;世界文件夹。</td><td align="left">防止数据丢失，在服务器崩溃或重大错误后可以回档。</td></tr><tr><td align="left"><strong>packetevents (2.8.0)</strong></td><td align="left"><strong>低级网络数据包处理库</strong>。提供比 ProtocolLib 更底层、更高效的 API 来处理网络数据包。</td><td align="left">通常被需要极致性能或特定数据包操作的插件（如 ViaVersion 系列、某些反作弊）使用。是 ProtocolLib 的现代替代或补充。</td></tr></tbody></table><h3 id="SCHEMATICS投影下载"><a href="#SCHEMATICS投影下载" class="headerlink" title="SCHEMATICS投影下载"></a>SCHEMATICS投影下载</h3><p><a href="https://www.minecraft-schematics.com/">https://www.minecraft-schematics.com/</a></p><p><a href="https://mcbuild.org/schematics/">https://mcbuild.org/schematics/</a></p><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p><strong>HMCL</strong></p><p><a href="https://hmcl.huangyuhui.net/">https://hmcl.huangyuhui.net/</a></p><p><strong>PCL2</strong></p><p><a href="https://afdian.com/p/0164034c016c11ebafcb52540025c377">https://afdian.com/p/0164034c016c11ebafcb52540025c377</a></p><p><a href="https://pan.aoe.top/Tools/PCL2">https://pan.aoe.top/Tools/PCL2</a></p><p><strong>XMCL</strong></p><p><a href="https://xmcl.app/zh/">https://xmcl.app/zh/</a></p><h3 id="光影下载"><a href="#光影下载" class="headerlink" title="光影下载"></a>光影下载</h3><p><a href="https://modrinth.com/shaders">https://modrinth.com/shaders</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;Java下载&quot;&gt;&lt;a href=&quot;#Java下载&quot; class=&quot;headerlink&quot; title=&quot;Java下载&quot;&gt;&lt;/a&gt;Java下载&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://docs.papermc.io/misc/java-install&quot;&gt;ht</summary>
      
    
    
    
    <category term="科普" scheme="https://blog.quickso.cn/categories/%E7%A7%91%E6%99%AE/"/>
    
    
    <category term="Minecraft" scheme="https://blog.quickso.cn/tags/Minecraft/"/>
    
    <category term="我的世界" scheme="https://blog.quickso.cn/tags/%E6%88%91%E7%9A%84%E4%B8%96%E7%95%8C/"/>
    
    <category term="Paper" scheme="https://blog.quickso.cn/tags/Paper/"/>
    
  </entry>
  
  <entry>
    <title>docker部署开源企业级远程办公VPN及软件安装-AnyLink</title>
    <link href="https://blog.quickso.cn/2025/02/11/docker%E9%83%A8%E7%BD%B2%E5%BC%80%E6%BA%90%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%ACVPN-%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85-AnyLink/"/>
    <id>https://blog.quickso.cn/2025/02/11/docker%E9%83%A8%E7%BD%B2%E5%BC%80%E6%BA%90%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%ACVPN-%E5%8F%8A%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85-AnyLink/</id>
    <published>2025-02-11T11:01:27.000Z</published>
    <updated>2026-02-06T13:40:34.772Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>AnyLink是一个企业级远程办公 ssl vpn 软件，可以支持多人同时在线使用。基于 openconnect 协议开发，并且借鉴了 ocserv 的开发思路，可以完全兼容 AnyConnect 客户端。</p></blockquote><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/online.jpg" alt="online"></p><p>开源仓库：<a href="https://github.com/bjdgyc/anylink">https://github.com/bjdgyc/anylink</a></p><p><strong>AnyLink</strong> 最主要的功能莫过于<code>用户分组功能</code>.通过设置分组权限可以使不同用户或员工能访问的网段和路由也不同,加上支持 <strong>SMTP</strong> 邮件来分发密码,同时也支持 <strong>TOTP 动态令牌</strong> ,确实更适合小型企业的远程访问管理.但是<code>并不能</code>像 <strong>Openconnect VPN</strong> 一样支持证书登录,<strong>所以每次连接都需要手动输入密码</strong>.</p><h2 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h2><h4 id="1-安装Docker环境-解析域名"><a href="#1-安装Docker环境-解析域名" class="headerlink" title="1.安装Docker环境&amp;解析域名"></a>1.安装Docker环境&amp;解析域名</h4><p>参考 <a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn/</a></p><p>将你的域名解析到服务器</p><h4 id="2-拉取镜像"><a href="#2-拉取镜像" class="headerlink" title="2.拉取镜像"></a>2.拉取镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull bjdgyc/anylink:latest<br></code></pre></td></tr></table></figure><h4 id="3-生成密码和-jwt-secret"><a href="#3-生成密码和-jwt-secret" class="headerlink" title="3.生成密码和 jwt secret"></a>3.生成密码和 jwt secret</h4><p>首次运行以下命令来创建管理员密码.以下命令中含<code>rm</code>参数,仅用于执行创建密码的命令,会自行删除.将生成的<code>Passwd</code>和<code>secret</code>保存.</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs applescript">docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-comment">--rm bjdgyc/anylink tool -p your_password</span><br><span class="hljs-comment"># 生成 Passwd</span><br><span class="hljs-comment"># Passwd:$2a$10$iKPApINPOwuyUhZC/b7P0eI8chEukkpyxPEbYxqdS3BPTtImqStGW</span><br><br>docker <span class="hljs-built_in">run</span> -<span class="hljs-keyword">it</span> <span class="hljs-comment">--rm bjdgyc/anylink tool -s</span><br><span class="hljs-comment"># 生成 jwt secret</span><br><span class="hljs-comment"># Secret:r4-21-eDOrSAjtXL4k06PK0NFudNshMKh9euV09EQrsa9oEYlKaSgoa-CdY</span><br></code></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/3933217940.jpg" alt="img"></p><h4 id="4-获取配置目录"><a href="#4-获取配置目录" class="headerlink" title="4.获取配置目录"></a>4.获取配置目录</h4><p>复制以下命令,首次启动容器,拷贝配置文件到宿主机后删除容器.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -itd --name anylink --privileged=<span class="hljs-literal">true</span> bjdgyc/anylink<br></code></pre></td></tr></table></figure><p>使用 docker cp 将配置文件目录拷贝到当前目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">cp</span> anylink:/app/conf .<br></code></pre></td></tr></table></figure><p>删除容器</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">docker stop anylink<br>docker rm anylink<br></code></pre></td></tr></table></figure><h4 id="5-正式启动容器"><a href="#5-正式启动容器" class="headerlink" title="5.正式启动容器"></a>5.正式启动容器</h4><p>将 docker cp 拷贝出来的<code>conf</code>目录中的<code>server.toml</code>，进行修改</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250211191625076.png" alt="image-20250211191625076"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250211191655733.png" alt="image-20250211191655733"></p><p>参考以下命令正式启动容器,注意本文示例<code>conf</code>目录存放于<code>/root</code>下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>    --name anylink \<br>    --restart always \<br>    --privileged=<span class="hljs-literal">true</span> \<br>    -p 55555:443 \<br>    -p 8800:8800 \<br>    -v /root/conf:/app/conf \<br>bjdgyc/anylink -c=/app/conf/server.toml<br></code></pre></td></tr></table></figure><h4 id="6-管理后台"><a href="#6-管理后台" class="headerlink" title="6.管理后台"></a>6.管理后台</h4><p>访问<code>内网IP:端口</code>,例如<code>https://IP:8800</code>输入<code>admin</code>密码登陆后台管理系统.</p><p><a href="https://ip:55555/">https://IP:55555</a> 即为VPN首页，可以自定义</p><p>后台管理非常简单明了,只需要配置<code>用户组</code>,<code>用户</code>即可开始使用,如需邮件分发密码功能可以在<code>邮件设置</code>中配置.</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250211191205518.png" alt="image-20250211191205518"></p><p><code>其他设置</code>中可以配置Banner信息、自定义首页（支持HTML代码）、邮件分发模版等，可以根据自己的需求修改</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250211191032651.png" alt="image-20250211191032651"></p><h4 id="7-用户组信息"><a href="#7-用户组信息" class="headerlink" title="7.用户组信息"></a>7.用户组信息</h4><p><code>添加用户组</code>只需要填写组名,其他保持默认,则表示该组用户所有流量都将被 VPN 服务器代理,属于完整的<code>全局代理</code>.</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250209113308300.png" alt="image-20250209113308300"></p><p><code>包含路由</code>如果添加内网网段,例如网段为<code>10.0.0.0/24</code>,则表示该组用户<strong>可以访问内网设备</strong>,而互联网请求依旧使用<code>客户端本地的网络访问</code>.</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250211191743260.png" alt="image-20250211191743260"></p><p><code>DNS 服务器</code>可根据需求自行设置</p><h4 id="8-用户信息"><a href="#8-用户信息" class="headerlink" title="8.用户信息"></a>8.用户信息</h4><p><code>添加新用户</code>并且分配<strong>用户组</strong>,<code>PIN 码</code>为客户端的登录密码,如果配置了 <strong>SMTP</strong> 并勾选了<code>发送邮件</code>,则会创建随机密码以邮件的形式发送.也可以手动设置密码.<code>OTP</code>功能如果没有需求关闭即可.</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250209113446838.png" alt="image-20250209113446838"></p><p>自定义首页模板</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;zh-CN&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>XXXVPN系统<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css">        * &#123;</span><br><span class="language-css">            <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;</span><br><span class="language-css">            <span class="hljs-attribute">box-sizing</span>: border-box;</span><br><span class="language-css">            <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&#x27;Segoe UI&#x27;</span>, Arial, sans-serif;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f4f8</span>;</span><br><span class="language-css">            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.header</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#1a73e8</span>, <span class="hljs-number">#0d47a1</span>);</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span> <span class="hljs-number">1rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.container</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin</span>: <span class="hljs-number">2rem</span> auto;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">1rem</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.card</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: white;</span><br><span class="language-css">            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1.5rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">15px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.download-btn</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">display</span>: inline-block;</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1a73e8</span>;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">30px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">25px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">text-decoration</span>: none;</span><br><span class="language-css">            <span class="hljs-attribute">font-weight</span>: bold;</span><br><span class="language-css">            <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.download-btn</span><span class="hljs-selector-pseudo">:hover</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1557b0</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">h2</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: <span class="hljs-number">#1a73e8</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">1rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#1a73e8</span>;</span><br><span class="language-css">            <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">1rem</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">ul</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">list-style</span>: none;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">li</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">0.5rem</span> <span class="hljs-number">0</span>;</span><br><span class="language-css">            <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">            <span class="hljs-attribute">align-items</span>: center;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">li</span><span class="hljs-selector-pseudo">::before</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;✔&quot;</span>;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: <span class="hljs-number">#1a73e8</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">1rem</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-class">.notice</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: <span class="hljs-number">#fff3cd</span>;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;</span><br><span class="language-css">            <span class="hljs-attribute">margin</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;</span><br><span class="language-css">            <span class="hljs-attribute">border-left</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#ffc107</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-selector-tag">footer</span> &#123;</span><br><span class="language-css">            <span class="hljs-attribute">text-align</span>: center;</span><br><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">1.5rem</span>;</span><br><span class="language-css">            <span class="hljs-attribute">background</span>: <span class="hljs-number">#1a273e</span>;</span><br><span class="language-css">            <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">            <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">3rem</span>;</span><br><span class="language-css">        &#125;</span><br><span class="language-css"></span><br><span class="language-css">        <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) &#123;</span><br><span class="language-css">            <span class="hljs-selector-class">.container</span> &#123;</span><br><span class="language-css">                <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">0.5rem</span>;</span><br><span class="language-css">            &#125;</span><br><span class="language-css">            </span><br><span class="language-css">            <span class="hljs-selector-class">.card</span> &#123;</span><br><span class="language-css">                <span class="hljs-attribute">padding</span>: <span class="hljs-number">1.5rem</span>;</span><br><span class="language-css">            &#125;</span><br><span class="language-css">        &#125;</span><br><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;header&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>XXXVPN系统<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>安全连接 · 高效访问<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;container&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>客户端下载<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://ocserv.yydy.link:2023/&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;download-btn&quot;</span>&gt;</span>立即下载VPN客户端<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>支持版本：Windows / macOS / Linux / Android / iOS<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>支持客户端<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>Cisco AnyConnect 客户端<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>OpenConnect 客户端<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>兼容标准SSL VPN协议<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>使用说明<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;notice&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>🔔 首次使用请先下载安装客户端，使用公司账号登录<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;padding-left: 2rem;&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>下载并安装对应客户端软件<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>输入服务器地址：vpn.abc.com<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>使用公司分配的账号密码登录<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>连接成功后即可访问内部资源<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© 2025 欢哥科技 版权所有<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>技术支持：admin@huangetech.com<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="客户端安装"><a href="#客户端安装" class="headerlink" title="客户端安装"></a>客户端安装</h2><p><strong>下载客户端</strong></p><p><a href="https://www.cisco.com/">AnyConnect Secure Client</a> ( Windows&#x2F;macOS&#x2F;Linux&#x2F;Android&#x2F;iOS)</p><p><a href="https://gitlab.com/openconnect/openconnect">OpenConnect</a> (Windows&#x2F;macOS&#x2F;Linux)</p><p><a href="https://github.com/tlslink/anylink-client">三方 AnyLink Secure Client</a> (Windows&#x2F;macOS&#x2F;Linux)</p><p>【推荐】三方客户端下载地址( Windows&#x2F;macOS&#x2F;Linux&#x2F;Android&#x2F;iOS) <a href="https://ocserv.yydy.link:2023/">国内地址</a> <a href="https://cisco.yydy.link/#/">国外地址</a></p><p>OpenConnect Linux 客户端登陆脚本 （NAS可用）</p><p> <a href="https://github.com/muzihuaner/Openconnect-Login-Linux-ShellScript">https://github.com/muzihuaner/Openconnect-Login-Linux-ShellScript</a></p><p><strong>使用客户端</strong></p><p>安装客户端后，输入VPN服务器地址（有端口加端口）</p><p>点击链接，输入用户组、用户名、密码链接即可…</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;AnyLink是一个企业级远程办公 ssl vpn 软件，可以支持多人同时在线使用。基于 openconnect 协议开发，并且借鉴了 ocserv 的开发思路，可以完全兼容 AnyConnect 客户端。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="Docker" scheme="https://blog.quickso.cn/tags/Docker/"/>
    
    <category term="VPN" scheme="https://blog.quickso.cn/tags/VPN/"/>
    
    <category term="Anylink" scheme="https://blog.quickso.cn/tags/Anylink/"/>
    
  </entry>
  
  <entry>
    <title>Termux + Debian + Ollama 实现在手机上部署 DeepSeek-R1-1.5B</title>
    <link href="https://blog.quickso.cn/2025/02/02/Termux%20+%20Debian%20+%20Ollama%20%E5%AE%9E%E7%8E%B0%E5%9C%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E9%83%A8%E7%BD%B2%20DeepSeek-R1-1.5B/"/>
    <id>https://blog.quickso.cn/2025/02/02/Termux%20+%20Debian%20+%20Ollama%20%E5%AE%9E%E7%8E%B0%E5%9C%A8%E6%89%8B%E6%9C%BA%E4%B8%8A%E9%83%A8%E7%BD%B2%20DeepSeek-R1-1.5B/</id>
    <published>2025-02-02T04:53:08.000Z</published>
    <updated>2026-02-06T13:40:34.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="📱-环境要求"><a href="#📱-环境要求" class="headerlink" title="📱 环境要求"></a>📱 环境要求</h2><ul><li>Android 8.0+ 设备</li><li>剩余存储空间 ≥5GB</li><li>RAM ≥4GB（推荐6GB+）</li><li>稳定（国际）网络连接</li></ul><h2 id="一、Termux基础配置"><a href="#一、Termux基础配置" class="headerlink" title="一、Termux基础配置"></a>一、Termux基础配置</h2><h3 id="1-安装Termux"><a href="#1-安装Termux" class="headerlink" title="1. 安装Termux"></a>1. 安装Termux</h3><p>从 <a href="https://f-droid.org/packages/com.termux/">F-Droid</a> 下载最新版Termux（或者Google Play Store版本）</p><p>Github下载地址：<a href="https://github.com/termux/termux-app/releases">https://github.com/termux/termux-app/releases</a></p><h3 id="2-初始化环境"><a href="#2-初始化环境" class="headerlink" title="2. 初始化环境"></a>2. 初始化环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">termux-setup-storage <span class="hljs-comment">#获取存储权限</span><br>pkg update -y &amp;&amp; pkg upgrade -y <span class="hljs-comment">#更新</span><br>pkg install git cmake golang proot-distro <span class="hljs-comment">#安装用到的软件依赖</span><br></code></pre></td></tr></table></figure><h2 id="二、安装Debian系统"><a href="#二、安装Debian系统" class="headerlink" title="二、安装Debian系统"></a>二、安装Debian系统</h2><h3 id="1-部署Debian"><a href="#1-部署Debian" class="headerlink" title="1. 部署Debian"></a>1. 部署Debian</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">proot-distro install debian <span class="hljs-comment">#安装Debian</span><br>proot-distro login debian <span class="hljs-comment">#登陆Debian系统</span><br></code></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131439387.png" alt="image-20250202131439387"></p><h3 id="2-配置Debian环境"><a href="#2-配置Debian环境" class="headerlink" title="2. 配置Debian环境"></a>2. 配置Debian环境</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update &amp;&amp; apt upgrade -y<br></code></pre></td></tr></table></figure><h3 id="3-安装Ollama（ARM64兼容版）"><a href="#3-安装Ollama（ARM64兼容版）" class="headerlink" title="3.安装Ollama（ARM64兼容版）"></a>3.安装Ollama（ARM64兼容版）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -fsSL https://ollama.com/install.sh | sh<br></code></pre></td></tr></table></figure><p>这个过程稍微有点慢~</p><h3 id="4-启动服务"><a href="#4-启动服务" class="headerlink" title="4.启动服务"></a>4.启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ollama serve<br><span class="hljs-comment"># 保持此终端运行</span><br></code></pre></td></tr></table></figure><h3 id="5-安装模型"><a href="#5-安装模型" class="headerlink" title="5.安装模型"></a>5.安装模型</h3><p>退回到桌面，不要关闭刚才的终端页面</p><p>长按 <strong>Termux</strong> 图标选择 “<strong>New session</strong>” 新建一个终端</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131401181.png" alt="image-20250202131401181"></p><p>执行下面的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">proot-distro login debian <span class="hljs-comment">#登录安装的Debian系统</span><br>ollama run deepseek-r1:1.5b <span class="hljs-comment">#拉取模型</span><br></code></pre></td></tr></table></figure><p>拉取完毕就可以在命令行页面进行对话了</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131617757.png" alt="image-20250202131617757"></p><h3 id="6-开启API"><a href="#6-开启API" class="headerlink" title="6.开启API"></a>6.开启API</h3><p>为了更方便使用，我们可以执行下面的命令开启API</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">OLLAMA_HOST=0.0.0.0<br>OLLAMA_ORIGINS=*<br>ollama serve<br></code></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131758742.png" alt="image-20250202131758742"></p><h3 id="7-配置chatbox"><a href="#7-配置chatbox" class="headerlink" title="7.配置chatbox"></a>7.配置chatbox</h3><p>下载安装chatbox<br>chatbox下载地址：<a href="https://chatboxai.app/zh/install?download=android_apk">https://chatboxai.app/zh/install?download=android_apk</a></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131921087.png" alt="image-20250202131921087"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202131953494.png" alt="image-20250202131953494"></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202132018691.png" alt="image-20250202132018691"></p><p>点“保存”即可。</p><p>最后，关闭chatbox和termux（可以直接划后台）<br>此时，准备工作就结束了。</p><p>部署完成之后，每次使用前，需要打开termux，执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">proot-distro login debian<br>ollama serve<br></code></pre></td></tr></table></figure><p>然后打开chatbox，就可以与deepseek对话了</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250202132125763.png" alt="image-20250202132125763"></p><p>由于手机会限制后台应用的运行速度，且容易杀后台，使用时建议把termux放在前台，chatbox挂在小窗，这样模型才能快速流畅回答问题。</p><h3 id="8-结语"><a href="#8-结语" class="headerlink" title="8.结语"></a>8.结语</h3><p>快去折腾吧~ 碎碎念：要是能调用 手机GPU就好了~</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;📱-环境要求&quot;&gt;&lt;a href=&quot;#📱-环境要求&quot; class=&quot;headerlink&quot; title=&quot;📱 环境要求&quot;&gt;&lt;/a&gt;📱 环境要求&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Android 8.0+ 设备&lt;/li&gt;
&lt;li&gt;剩余存储空间 ≥5GB&lt;/li&gt;
&lt;l</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="DeepSeek" scheme="https://blog.quickso.cn/tags/DeepSeek/"/>
    
    <category term="大模型" scheme="https://blog.quickso.cn/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="Termux" scheme="https://blog.quickso.cn/tags/Termux/"/>
    
  </entry>
  
  <entry>
    <title>本地部署免费开源DeepSeek-R1大模型</title>
    <link href="https://blog.quickso.cn/2025/01/27/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E5%85%8D%E8%B4%B9%E5%BC%80%E6%BA%90DeepSeek-R1%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    <id>https://blog.quickso.cn/2025/01/27/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2%E5%85%8D%E8%B4%B9%E5%BC%80%E6%BA%90DeepSeek-R1%E5%A4%A7%E6%A8%A1%E5%9E%8B/</id>
    <published>2025-01-27T04:47:32.000Z</published>
    <updated>2026-02-06T13:40:34.782Z</updated>
    
    <content type="html"><![CDATA[<p>近期，杭州深度求索人工智能基础技术研究有限公司正式发布了其最新研发的高性能AI推理模型——<strong>DeepSeekR1</strong>。该模型在数学、代码和自然语言推理等任务上表现卓越，性能直接对标OpenAI的o1正式版，同时以开源形式向全球开发者开放，并使用MIT协议开源，支持免费商用，无需申请授权，为LLM大模型开源世界又补给了满满一仓库弹药。</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250127133659012.png"></p><h4 id="DeepSeek-R1的核心优势"><a href="#DeepSeek-R1的核心优势" class="headerlink" title="DeepSeek R1的核心优势"></a>DeepSeek R1的核心优势</h4><p>DeepSeek R1的最大亮点在于其通过强化学习（RL）技术显著提升了模型的推理能力，且仅需极少量标注数据即可实现高效训练。与OpenAI的o1相比，R1在多个基准测试中表现优异，同时价格仅为o1的几十分之一，具有极高的性价比。</p><ol><li><strong>强化学习驱动的推理能力</strong><br>R1在后训练阶段大规模应用了强化学习技术，无需依赖大量监督微调（SFT）数据，即可显著提升模型的推理能力。这一创新方法不仅降低了训练成本，还使模型在复杂任务中表现出色。</li><li><strong>长链推理与模型蒸馏</strong><br>R1采用了长链推理（Chain-of-Thought, CoT）技术，能够逐步分解复杂问题，并通过多步骤逻辑推理解决问题。此外，R1支持模型蒸馏，开发者可以将其推理能力迁移到更小型的模型中，满足特定场景需求。</li><li><strong>开源与灵活的许可证</strong><br>R1遵循MIT License开源协议，允许用户自由使用、修改和商用。同时，DeepSeek还开源了R1-Zero和多个蒸馏后的小模型，进一步推动了AI技术的普及与创新。</li></ol><p>各项性能指标更是和OpenAI-o1 模型不相上下，甚至做到了小部分的超越，关键是开源的，我们可以本地部署使用</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250127130112854.png"></p><h2 id="1、本地部署"><a href="#1、本地部署" class="headerlink" title="1、本地部署"></a>1、本地部署</h2><p>我们这里使用Ollama来进行模型部署,安装你的系统对应的客户端</p><h3 id="安装Ollama"><a href="#安装Ollama" class="headerlink" title="安装Ollama"></a>安装Ollama</h3><p>Ollama 官方版：<a href="https://ollama.com/">ollama.com&#x2F;</a></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/20250127130631788.png"></p><h3 id="安装模型"><a href="#安装模型" class="headerlink" title="安装模型"></a>安装模型</h3><blockquote><p>如果使用 <strong>4-bit 量化</strong>，显存需求：</p><ul><li><p><strong>1.5B</strong>：约 <strong>1 GB</strong></p></li><li><p><strong>7B</strong>：约 <strong>4 GB</strong></p></li><li><p><strong>8B</strong>：约 <strong>4.5 GB</strong></p></li><li><p><strong>14B</strong>：约 <strong>8 GB</strong></p></li><li><p><strong>32B</strong>：约 <strong>18 GB</strong></p></li><li><p><strong>70B</strong>：约 <strong>40 GB</strong> </p></li><li><p>对于资源有限的用户，推荐使用 <strong>1.5B</strong> 或 <strong>7B</strong> 模型，它们可以在单张消费级显卡上运行。</p></li><li><p>如果需要更高的性能，可以选择 <strong>14B</strong> 或 <strong>32B</strong> 模型，但需要多 GPU 配置。</p></li><li><p><strong>70B</strong> 模型适合高端计算环境，需要多张高端 GPU 支持。</p></li></ul></blockquote><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250127131814855.png" alt="image-20250127131814855"></p><p><strong>1.5B Qwen DeepSeek R1</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ollama</span> run deepseek-r1:<span class="hljs-number">1</span>.<span class="hljs-number">5</span>b<br></code></pre></td></tr></table></figure><p><strong>7B Qwen DeepSeek R1</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ollama <span class="hljs-built_in">run</span> deepseek-r1:7b<br></code></pre></td></tr></table></figure><p><strong>8B Llama DeepSeek R1</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ollama <span class="hljs-built_in">run</span> deepseek-r1:8b<br></code></pre></td></tr></table></figure><p><strong>14B Qwen DeepSeek R1</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ollama <span class="hljs-built_in">run</span> deepseek-r1:14b<br></code></pre></td></tr></table></figure><p><strong>32B Qwen DeepSeek R1</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ollama <span class="hljs-built_in">run</span> deepseek-r1:32b<br></code></pre></td></tr></table></figure><p><strong>70B Llama DeepSeek R1</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">ollama <span class="hljs-built_in">run</span> deepseek-r1:70b<br></code></pre></td></tr></table></figure><p>安装完就可以使用终端去聊天了</p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250127131814855.png" alt="image-20250127131814855"></p><h3 id="安装控制端"><a href="#安装控制端" class="headerlink" title="安装控制端"></a>安装控制端</h3><p>为了更方便使用我们安装一个控制端，也可以使用其他的</p><p>浏览器<strong>Web UI 控制端【<a href="https://chromewebstore.google.com/detail/page-assist-%E6%9C%AC%E5%9C%B0-ai-%E6%A8%A1%E5%9E%8B%E7%9A%84-web/jfgfiigpkhlkbnfnbobbkinehhfdhndo">点击安装</a>】</strong></p><p><img src="https://gcore.jsdelivr.net/gh/muzihuaner/huancdn@main/img/image-20250127130936244.png" alt="image-20250127130936244"></p><h2 id="2-更多模型下载"><a href="#2-更多模型下载" class="headerlink" title="2. 更多模型下载"></a>2. 更多模型下载</h2><h3 id="DeepSeek-R1"><a href="#DeepSeek-R1" class="headerlink" title="DeepSeek-R1"></a>DeepSeek-R1</h3><table><thead><tr><th align="center"><strong>模型</strong></th><th align="center"><strong>#总参数</strong></th><th align="center"><strong>#已激活参数</strong></th><th align="center"><strong>上下文长度</strong></th><th align="center"><strong>下载</strong></th></tr></thead><tbody><tr><td align="center">DeepSeek-R1-Zero</td><td align="center">671B</td><td align="center">37B</td><td align="center">128千</td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Zero">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1</td><td align="center">671B</td><td align="center">37B</td><td align="center">128千</td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1">🤗 HuggingFace</a></td></tr></tbody></table><p>DeepSeek-R1-Zero 和 DeepSeek-R1 基于 DeepSeek-V3-Base 进行训练。有关模型架构的更多详细信息，请参阅<a href="https://github.com/deepseek-ai/DeepSeek-V3">DeepSeek-V3</a>存储库。</p><h3 id="DeepSeek-R1-Distill-模型"><a href="#DeepSeek-R1-Distill-模型" class="headerlink" title="DeepSeek-R1-Distill 模型"></a>DeepSeek-R1-Distill 模型</h3><table><thead><tr><th align="center"><strong>模型</strong></th><th align="center"><strong>基础模型</strong></th><th align="center"><strong>下载</strong></th></tr></thead><tbody><tr><td align="center">DeepSeek-R1-Distill-Qwen-1.5B</td><td align="center"><a href="https://huggingface.co/Qwen/Qwen2.5-Math-1.5B">Qwen2.5-Math-1.5B</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-7B</td><td align="center"><a href="https://huggingface.co/Qwen/Qwen2.5-Math-7B">Qwen2.5-Math-7B</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-7B">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1-Distill-Llama-8B</td><td align="center"><a href="https://huggingface.co/meta-llama/Llama-3.1-8B">Llama-3.1-8B</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Llama-8B">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-14B</td><td align="center"><a href="https://huggingface.co/Qwen/Qwen2.5-14B">Qwen2.5-14B</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-14B">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-32B</td><td align="center"><a href="https://huggingface.co/Qwen/Qwen2.5-32B">Qwen2.5-32B</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Qwen-32B">🤗 HuggingFace</a></td></tr><tr><td align="center">DeepSeek-R1-Distill-Llama-70B</td><td align="center"><a href="https://huggingface.co/meta-llama/Llama-3.3-70B-Instruct">Llama-3.3-70B-Instruct</a></td><td align="center"><a href="https://huggingface.co/deepseek-ai/DeepSeek-R1-Distill-Llama-70B">🤗 HuggingFace</a></td></tr></tbody></table><p>DeepSeek-R1-Distill 模型基于开源模型进行了微调，使用了 DeepSeek-R1 生成的样本。我们对其配置和分词器进行了轻微更改。请使用我们的设置来运行这些模型。</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="4-评估结果"><a href="#4-评估结果" class="headerlink" title="4.评估结果"></a>4.评估结果</h2><h3 id="DeepSeek-R1-评估"><a href="#DeepSeek-R1-评估" class="headerlink" title="DeepSeek-R1-评估"></a>DeepSeek-R1-评估</h3><p>对于我们所有的模型，最大生成长度设置为 32,768 个 token。对于需要采样的基准，我们使用的温度为0.6，top-p 值为0.95，并为每个查询生成 64 个响应来估计 pass@1。</p><table><thead><tr><th align="center">类别</th><th align="center">基准（公制）</th><th align="center">克劳德-3.5-十四行诗-1022</th><th align="center">GPT-4o 0513</th><th align="center">DeepSeek V3</th><th align="center">OpenAI o1-mini</th><th align="center">OpenAI o1-1217</th><th align="center">DeepSeek R1</th></tr></thead><tbody><tr><td align="center"></td><td align="center">建筑学</td><td align="center">–</td><td align="center">–</td><td align="center">教育部</td><td align="center">–</td><td align="center">–</td><td align="center">教育部</td></tr><tr><td align="center"></td><td align="center"># 激活参数</td><td align="center">–</td><td align="center">–</td><td align="center">37B</td><td align="center">–</td><td align="center">–</td><td align="center">37B</td></tr><tr><td align="center"></td><td align="center"># 总参数</td><td align="center">–</td><td align="center">–</td><td align="center">671B</td><td align="center">–</td><td align="center">–</td><td align="center">671B</td></tr><tr><td align="center">英语</td><td align="center">MMLU（通过@1）</td><td align="center">88.3</td><td align="center">87.2</td><td align="center">88.5</td><td align="center">85.2</td><td align="center"><strong>91.8</strong></td><td align="center">90.8</td></tr><tr><td align="center"></td><td align="center">MMLU-Redux（EM）</td><td align="center">88.9</td><td align="center">88.0</td><td align="center">89.1</td><td align="center">86.7</td><td align="center">–</td><td align="center"><strong>92.9</strong></td></tr><tr><td align="center"></td><td align="center">MMLU-Pro（EM）</td><td align="center">78.0</td><td align="center">72.6</td><td align="center">75.9</td><td align="center">80.3</td><td align="center">–</td><td align="center"><strong>84.0</strong></td></tr><tr><td align="center"></td><td align="center">掉落 (3 发 F1)</td><td align="center">88.3</td><td align="center">83.7</td><td align="center">91.6</td><td align="center">83.9</td><td align="center">90.2</td><td align="center"><strong>92.2</strong></td></tr><tr><td align="center"></td><td align="center">IF-Eval（提示严格）</td><td align="center"><strong>86.5</strong></td><td align="center">84.3</td><td align="center">86.1</td><td align="center">84.8</td><td align="center">–</td><td align="center">83.3</td></tr><tr><td align="center"></td><td align="center">GPQA-钻石级 (Pass@1)</td><td align="center">65.0</td><td align="center">49.9</td><td align="center">59.1</td><td align="center">60.0</td><td align="center"><strong>75.7</strong></td><td align="center">71.5</td></tr><tr><td align="center"></td><td align="center">SimpleQA（正确）</td><td align="center">28.4</td><td align="center">38.2</td><td align="center">24.9</td><td align="center">7.0</td><td align="center"><strong>47.0</strong></td><td align="center">30.1</td></tr><tr><td align="center"></td><td align="center">框架（配件）</td><td align="center">72.5</td><td align="center">80.5</td><td align="center">73.3</td><td align="center">76.9</td><td align="center">–</td><td align="center"><strong>82.5</strong></td></tr><tr><td align="center"></td><td align="center">AlpacaEval2.0 (LC-胜率)</td><td align="center">52.0</td><td align="center">51.1</td><td align="center">70.0</td><td align="center">57.8</td><td align="center">–</td><td align="center"><strong>87.6</strong></td></tr><tr><td align="center"></td><td align="center">ArenaHard（GPT-4-1106）</td><td align="center">85.2</td><td align="center">80.4</td><td align="center">85.5</td><td align="center">92.0</td><td align="center">–</td><td align="center"><strong>92.3</strong></td></tr><tr><td align="center">代码</td><td align="center">LiveCodeBench (Pass@1-COT)</td><td align="center">33.8</td><td align="center">34.2</td><td align="center">–</td><td align="center">53.8</td><td align="center">63.4</td><td align="center"><strong>65.9</strong></td></tr><tr><td align="center"></td><td align="center">Codeforces（百分位数）</td><td align="center">20.3</td><td align="center">23.6</td><td align="center">58.7</td><td align="center">93.4</td><td align="center"><strong>96.6</strong></td><td align="center">96.3</td></tr><tr><td align="center"></td><td align="center">Codeforces（评级）</td><td align="center">717</td><td align="center">759</td><td align="center">1134</td><td align="center">1820</td><td align="center"><strong>2061</strong></td><td align="center">2029</td></tr><tr><td align="center"></td><td align="center">SWE 已验证（已解决）</td><td align="center"><strong>50.8</strong></td><td align="center">38.8</td><td align="center">42.0</td><td align="center">41.6</td><td align="center">48.9</td><td align="center">49.2</td></tr><tr><td align="center"></td><td align="center">Aider-Polyglot (Acc.)</td><td align="center">45.3</td><td align="center">16.0</td><td align="center">49.6</td><td align="center">32.9</td><td align="center"><strong>61.7</strong></td><td align="center">53.3</td></tr><tr><td align="center">数学</td><td align="center">AIME 2024（通行证@1）</td><td align="center">16.0</td><td align="center">9.3</td><td align="center">39.2</td><td align="center">63.6</td><td align="center">79.2</td><td align="center"><strong>79.8</strong></td></tr><tr><td align="center"></td><td align="center">数学-500 (通过@1)</td><td align="center">78.3</td><td align="center">74.6</td><td align="center">90.2</td><td align="center">90.0</td><td align="center">96.4</td><td align="center"><strong>97.3</strong></td></tr><tr><td align="center"></td><td align="center">CNMO 2024 (通行证@1)</td><td align="center">13.1</td><td align="center">10.8</td><td align="center">43.2</td><td align="center">67.6</td><td align="center">–</td><td align="center"><strong>78.8</strong></td></tr><tr><td align="center">中文</td><td align="center">CLUEWSC（EM）</td><td align="center">85.4</td><td align="center">87.9</td><td align="center">90.9</td><td align="center">89.9</td><td align="center">–</td><td align="center"><strong>92.8</strong></td></tr><tr><td align="center"></td><td align="center">C-评估（EM）</td><td align="center">76.7</td><td align="center">76.0</td><td align="center">86.5</td><td align="center">68.9</td><td align="center">–</td><td align="center"><strong>91.8</strong></td></tr><tr><td align="center"></td><td align="center">C-SimpleQA（正确）</td><td align="center">55.4</td><td align="center">58.7</td><td align="center"><strong>68.0</strong></td><td align="center">40.3</td><td align="center">–</td><td align="center">63.7</td></tr></tbody></table><h3 id="蒸馏模型评估"><a href="#蒸馏模型评估" class="headerlink" title="蒸馏模型评估"></a>蒸馏模型评估</h3><table><thead><tr><th align="center">模型</th><th align="center">AIME 2024 通行证@1</th><th align="center">AIME 2024 缺点@64</th><th align="center">MATH-500 通过@1</th><th align="center">GPQA 钻石通行证@1</th><th align="center">LiveCodeBench 通行证@1</th><th align="center">CodeForces 评级</th></tr></thead><tbody><tr><td align="center">GPT-4o-0513</td><td align="center">9.3</td><td align="center">13.4</td><td align="center">74.6</td><td align="center">49.9</td><td align="center">32.9</td><td align="center">759</td></tr><tr><td align="center">克劳德-3.5-十四行诗-1022</td><td align="center">16.0</td><td align="center">26.7</td><td align="center">78.3</td><td align="center">65.0</td><td align="center">38.9</td><td align="center">717</td></tr><tr><td align="center">o1-迷你</td><td align="center">63.6</td><td align="center">80.0</td><td align="center">90.0</td><td align="center">60.0</td><td align="center">53.8</td><td align="center"><strong>1820</strong></td></tr><tr><td align="center">QwQ-32B-预览</td><td align="center">44.0</td><td align="center">60.0</td><td align="center">90.6</td><td align="center">54.5</td><td align="center">41.9</td><td align="center">1316</td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-1.5B</td><td align="center">28.9</td><td align="center">52.7</td><td align="center">83.9</td><td align="center">33.8</td><td align="center">16.9</td><td align="center">954</td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-7B</td><td align="center">55.5</td><td align="center">83.3</td><td align="center">92.8</td><td align="center">49.1</td><td align="center">37.6</td><td align="center">1189</td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-14B</td><td align="center">69.7</td><td align="center">80.0</td><td align="center">93.9</td><td align="center">59.1</td><td align="center">53.1</td><td align="center">1481</td></tr><tr><td align="center">DeepSeek-R1-Distill-Qwen-32B</td><td align="center"><strong>72.6</strong></td><td align="center">83.3</td><td align="center">94.3</td><td align="center">62.1</td><td align="center">57.2</td><td align="center">1691</td></tr><tr><td align="center">DeepSeek-R1-Distill-Llama-8B</td><td align="center">50.4</td><td align="center">80.0</td><td align="center">89.1</td><td align="center">49.0</td><td align="center">39.6</td><td align="center">1205</td></tr><tr><td align="center">DeepSeek-R1-Distill-Llama-70B</td><td align="center">70.0</td><td align="center"><strong>86.7</strong></td><td align="center"><strong>94.5</strong></td><td align="center"><strong>65.2</strong></td><td align="center"><strong>57.5</strong></td><td align="center">1633</td></tr></tbody></table><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="模型加载失败"><a href="#模型加载失败" class="headerlink" title="模型加载失败"></a>模型加载失败</h3><ul><li>确保模型名称正确。</li><li>检查网络连接，确保能够访问模型仓库。</li></ul><h3 id="GPU-不支持"><a href="#GPU-不支持" class="headerlink" title="GPU 不支持"></a>GPU 不支持</h3><ul><li>检查 CUDA 和驱动是否安装正确。</li><li>确保 Ollama 版本支持 GPU。</li></ul><h3 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h3><ul><li>尝试减少批量大小或使用更小的模型变体。</li><li>确保硬件资源充足。</li></ul><hr><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul><li><a href="https://ollama.ai/docs">Ollama 官方文档</a></li><li><a href="https://huggingface.co/models">Hugging Face 模型仓库</a></li><li><a href="https://github.com/deepseek-ai/DeepSeek-R1">DeepSeek-R1官方仓库</a></li></ul><hr><p>使用 Ollama 客户端轻松部署和运行 DeepSeek-R1 模型。如果有任何问题，可以参考官方文档或联系支持团队。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;近期，杭州深度求索人工智能基础技术研究有限公司正式发布了其最新研发的高性能AI推理模型——&lt;strong&gt;DeepSeekR1&lt;/strong&gt;。该模型在数学、代码和自然语言推理等任务上表现卓越，性能直接对标OpenAI的o1正式版，同时以开源形式向全球开发者开放，并使用M</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="大模型" scheme="https://blog.quickso.cn/tags/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    
    <category term="Deepseek" scheme="https://blog.quickso.cn/tags/Deepseek/"/>
    
    <category term="人工智能" scheme="https://blog.quickso.cn/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/"/>
    
  </entry>
  
  <entry>
    <title>使用tunasync搭建自己的开源软件镜像仓库</title>
    <link href="https://blog.quickso.cn/2025/01/03/%E4%BD%BF%E7%94%A8tunasync%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/"/>
    <id>https://blog.quickso.cn/2025/01/03/%E4%BD%BF%E7%94%A8tunasync%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93/</id>
    <published>2025-01-03T15:43:01.000Z</published>
    <updated>2026-02-06T13:40:34.774Z</updated>
    
    <content type="html"><![CDATA[<p>在开源软件的使用中，镜像仓库（Mirror Repository）扮演着至关重要的角色。它们为全球用户提供快速、可靠的软件下载服务。特别是在国内，由于网络限制，访问官方仓库往往较为缓慢，因此搭建一个自己的镜像仓库就显得尤为重要。而 <strong><a href="https://github.com/tuna/tunasync/">TunaSync</a></strong>，作为一个开源的同步工具，提供了简便的方式来搭建和管理自己的镜像仓库。</p><p><a href="https://github.com/tuna/tunasync">tunasync</a> 是<a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学 TUNA 镜像源</a>目前使用的镜像方案。</p><h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2><p>镜像站需要一台服务器，如果有条件，建议准备一台专用的X86物理服务器作为镜像站的服务器。服务器推荐配置：</p><blockquote><p>CPU: 8 核心 2.5GHz 以上</p><p>内存: 64 GB以上</p><p>硬盘: 3TB 以上，越大越好</p><p>网络: 千兆上行带宽及以上</p><p>系统：Centos8&#x2F;9及其衍生版本、Debian10&#x2F;11&#x2F;12及其衍生版本</p></blockquote><p>当然，如果条件不具备，以上配置可以无视，选择自己最好配置的机器即可，毕竟服务器配置还是取决于最终用户的需求。</p><p>特别说要说明的是，硬盘大小要求必须超过需要同步的源文件大小，比如需要同时同步 CentOS 与 Ubuntu，就需要准备一块 1.6T 以上大小的硬盘。每个镜像的具体大小可以在清华大学开源软件镜像站 <a href="https://mirrors.tuna.tsinghua.edu.cn/status/#syncing-status">同步状态</a> 页面查到。</p><h2 id="2-同步源与架构选择"><a href="#2-同步源与架构选择" class="headerlink" title="2. 同步源与架构选择"></a>2. 同步源与架构选择</h2><p>在官方提供的源列表中选择最方便的同步源（最好是支持 rsync 的国内镜像源，但国内目前提供 rsync 服务的镜像源不多，以下是网络收集的部分 rsync 源）。</p><p>Ubuntu 源列表：<a href="https://launchpad.net/ubuntu/+archivemirrors">https://launchpad.net/ubuntu/+archivemirrors</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">rsync:<span class="hljs-regexp">//mi</span>rrors.shuosc.org<span class="hljs-regexp">/ubuntu/</span><br>rsync:<span class="hljs-regexp">//mi</span>rrors.sohu.com<span class="hljs-regexp">/ubuntu/</span><br>rsync:<span class="hljs-regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="hljs-regexp">/ubuntu/</span><br>rsync:<span class="hljs-regexp">//mi</span>rrors.ustc.edu.cn<span class="hljs-regexp">/ubuntu/</span><br>rsync:<span class="hljs-regexp">//mi</span>rrors.yun-idc.com<span class="hljs-regexp">/ubuntu/</span><br></code></pre></td></tr></table></figure><p>CentOS 源列表：<a href="https://www.centos.org/download/mirrors/">https://www.centos.org/download/mirrors/</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">rsync:<span class="hljs-regexp">//mi</span>rrors.tuna.tsinghua.edu.cn<span class="hljs-regexp">/centos/</span><br>rsync:<span class="hljs-regexp">//mi</span>rror.es.its.nyu.edu<span class="hljs-regexp">/centos/</span><br>rsync:<span class="hljs-regexp">//</span>centos.sonn.com<span class="hljs-regexp">/CentOS/</span><br></code></pre></td></tr></table></figure><p>EPEL 源列表：<a href="https://www.centos.org/download/mirrors/">https://admin.fedoraproject.org/mirrormanager/mirrors/EPEL</a></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">rsync:</span><span class="hljs-comment">//mirrors.yun-idc.com/epel</span><br><span class="hljs-symbol">rsync:</span><span class="hljs-comment">//rsync.mirrors.ustc.edu.cn/epel</span><br></code></pre></td></tr></table></figure><h2 id="3-开始安装"><a href="#3-开始安装" class="headerlink" title="3.开始安装"></a>3.开始安装</h2><h4 id="安装需要的软件"><a href="#安装需要的软件" class="headerlink" title="安装需要的软件"></a>安装需要的软件</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> rsync wget<br></code></pre></td></tr></table></figure><h4 id="下载tunasync"><a href="#下载tunasync" class="headerlink" title="下载tunasync"></a>下载tunasync</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget https:<span class="hljs-regexp">//g</span>h-proxy.com<span class="hljs-regexp">/https:/</span><span class="hljs-regexp">/github.com/</span>tuna<span class="hljs-regexp">/tunasync/</span>releases<span class="hljs-regexp">/download/</span>v0.<span class="hljs-number">8.0</span>/tunasync-linux-amd64-bin.tar.gz<br><span class="hljs-comment">#基于amd64，如果是ARM系列，请去https://github.com/tuna/tunasync/releases自行替换下载一个</span><br>tar xf tunasync-linux-amd64-bin.tar.gz<br>mv tunasync <span class="hljs-regexp">/usr/</span>bin/<br>mv tunasynctl <span class="hljs-regexp">/usr/</span>bin/<br></code></pre></td></tr></table></figure><h4 id="创建仓库文件夹"><a href="#创建仓库文件夹" class="headerlink" title="创建仓库文件夹"></a>创建仓库文件夹</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/www/mirrors<br></code></pre></td></tr></table></figure><h4 id="创建日志文件夹"><a href="#创建日志文件夹" class="headerlink" title="创建日志文件夹"></a>创建日志文件夹</h4><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/www/mirrors/logs<br></code></pre></td></tr></table></figure><h4 id="创建配置文件夹"><a href="#创建配置文件夹" class="headerlink" title="创建配置文件夹"></a>创建配置文件夹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> /etc/tunasync<br></code></pre></td></tr></table></figure><h4 id="创建manager的配置文件"><a href="#创建manager的配置文件" class="headerlink" title="创建manager的配置文件"></a>创建manager的配置文件</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/tunasync/manager.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>将以下内容根据自己的需求修改后写入manager的配置文件内</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">debug</span> = <span class="hljs-literal">false</span><br> <br><span class="hljs-section">[server]</span><br><span class="hljs-attr">addr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span> <span class="hljs-comment">#manager服务的监听地址，默认127.0.0.1一般就可以了</span><br><span class="hljs-attr">port</span> = <span class="hljs-number">12345</span> <span class="hljs-comment"># manager服务监听端口</span><br><span class="hljs-attr">ssl_cert</span> = <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment">#证书配置，可为空</span><br><span class="hljs-attr">ssl_key</span> = <span class="hljs-string">&quot;&quot;</span> <span class="hljs-comment">#证书配置，可为空</span><br> <br><span class="hljs-section">[files]</span><br><span class="hljs-attr">db_type</span> = <span class="hljs-string">&quot;bolt&quot;</span><br><span class="hljs-attr">db_file</span> = <span class="hljs-string">&quot;/etc/tunasync/manager.db&quot;</span> <span class="hljs-comment">#数据库文件位置</span><br><span class="hljs-attr">ca_cert</span> = <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><h4 id="创建worker-conf配置文件"><a href="#创建worker-conf配置文件" class="headerlink" title="创建worker.conf配置文件"></a>创建worker.conf配置文件</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/tunasync/worker.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>将以下内容根据自己的需求修改后写入worker的配置文件内，mirrors部分仅作示范写了两个，可以根据自身需要自由添加或删减</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[global]</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;worker&quot;</span> <span class="hljs-comment"># worker名字</span><br><span class="hljs-attr">log_dir</span> = <span class="hljs-string">&quot;/home/www/mirrors/logs/&#123;&#123;.Name&#125;&#125;&quot;</span> <span class="hljs-comment"># 日志存储位置</span><br><span class="hljs-attr">mirror_dir</span> = <span class="hljs-string">&quot;/home/www/mirrors&quot;</span> <span class="hljs-comment"># 仓库存储位置</span><br><span class="hljs-attr">concurrent</span> = <span class="hljs-number">10</span> <span class="hljs-comment"># 线程数</span><br><span class="hljs-attr">interval</span> = <span class="hljs-number">240</span> <span class="hljs-comment"># 同步周期，单位分钟</span><br> <br><span class="hljs-section">[manager]</span><br><span class="hljs-attr">api_base</span> = <span class="hljs-string">&quot;http://127.0.0.1:12345&quot;</span> <span class="hljs-comment"># manager的API地址</span><br><span class="hljs-attr">token</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">ca_cert</span> = <span class="hljs-string">&quot;&quot;</span><br> <br><span class="hljs-section">[cgroup]</span><br><span class="hljs-attr">enable</span> = <span class="hljs-literal">false</span><br><span class="hljs-attr">base_path</span> = <span class="hljs-string">&quot;/sys/fs/cgroup&quot;</span><br><span class="hljs-attr">group</span> = <span class="hljs-string">&quot;tunasync&quot;</span><br> <br><span class="hljs-section">[server]</span><br><span class="hljs-attr">hostname</span> = <span class="hljs-string">&quot;localhost&quot;</span><br><span class="hljs-attr">listen_addr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span><br><span class="hljs-attr">listen_port</span> = <span class="hljs-number">6000</span><br><span class="hljs-attr">ssl_cert</span> = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-attr">ssl_key</span> = <span class="hljs-string">&quot;&quot;</span><br> <br><span class="hljs-section">[[mirrors]]</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;centos&quot;</span><br><span class="hljs-attr">provider</span> = <span class="hljs-string">&quot;rsync&quot;</span><br><span class="hljs-attr">upstream</span> = <span class="hljs-string">&quot;rsync://ftp.kaist.ac.kr/CentOS/&quot;</span><br><span class="hljs-attr">use_ipv6</span> = <span class="hljs-literal">false</span><br> <br><span class="hljs-section">[[mirrors]]</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;ubuntu&quot;</span><br><span class="hljs-attr">provider</span> = <span class="hljs-string">&quot;rsync&quot;</span><br><span class="hljs-attr">upstream</span> = <span class="hljs-string">&quot;rsync://ftp.kaist.ac.kr/ubuntu/&quot;</span><br><span class="hljs-attr">use_ipv6</span> = <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h4 id="自定义同步脚本"><a href="#自定义同步脚本" class="headerlink" title="自定义同步脚本"></a>自定义同步脚本</h4><p>以Github为例</p><p>创建文件夹</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/www/mirrors/scripts<br></code></pre></td></tr></table></figure><p>在worker.conf文件添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[[mirrors]]</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;github-release&quot;</span><br><span class="hljs-attr">provider</span> = <span class="hljs-string">&quot;command&quot;</span><br><span class="hljs-attr">upstream</span> = <span class="hljs-string">&quot;https://api.github.com/repos/&quot;</span><br><span class="hljs-attr">command</span> = <span class="hljs-string">&quot;/home/www/mirrors/scripts/github-release.py&quot;</span><br><span class="hljs-attr">interval</span> = <span class="hljs-number">1440</span><br><span class="hljs-attr">docker_image</span> = <span class="hljs-string">&quot;tunathu/tunasync-scripts:latest&quot;</span><br></code></pre></td></tr></table></figure><p>下载同步脚本</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget -P scripts<span class="hljs-regexp">/ https:/</span><span class="hljs-regexp">/gh-proxy.com/</span>https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/muzihuaner/mi</span>rrors<span class="hljs-regexp">/refs/</span>heads<span class="hljs-regexp">/new/mi</span>rrors<span class="hljs-regexp">/scripts/gi</span>thub-release.py<br>wget -P scripts<span class="hljs-regexp">/ https:/</span><span class="hljs-regexp">/gh-proxy.com/</span>https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/muzihuaner/mi</span>rrors<span class="hljs-regexp">/refs/</span>heads<span class="hljs-regexp">/new/mi</span>rrors<span class="hljs-regexp">/scripts/gi</span>thub-release.json<br>chmod +x scripts/github-release.py<br>vim scripts/github-release.py<br>vim scripts/github-release.json <span class="hljs-comment">#修改你要同步的仓库</span><br></code></pre></td></tr></table></figure><p>可以先检验一下此脚本能否正常运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 scripts/github-release.py<br></code></pre></td></tr></table></figure><p>更多配置：<a href="https://github.com/tuna/tunasync/blob/master/docs/zh_CN/workers.conf">https://github.com/tuna/tunasync/blob/master/docs/zh_CN/workers.conf</a></p><p>更多脚本：<a href="https://github.com/tuna/tunasync-scripts">https://github.com/tuna/tunasync-scripts</a></p><h4 id="下载tunasync启动停止脚本"><a href="#下载tunasync启动停止脚本" class="headerlink" title="下载tunasync启动停止脚本"></a>下载tunasync启动停止脚本</h4><p><a href="https://github.com/whsir/tunasync-bin">https://github.com/whsir/tunasync-bin</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget -P <span class="hljs-regexp">/etc/i</span>nit.d<span class="hljs-regexp">/ https:/</span><span class="hljs-regexp">/gh-proxy.com/</span>https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/whsir/</span>tunasync-bin<span class="hljs-regexp">/master/</span>tunasync-manager<br>wget -P <span class="hljs-regexp">/etc/i</span>nit.d<span class="hljs-regexp">/ https:/</span><span class="hljs-regexp">/gh-proxy.com/</span>https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/whsir/</span>tunasync-bin<span class="hljs-regexp">/master/</span>tunasync-worker<br>chmod +x <span class="hljs-regexp">/etc/i</span>nit.d/tunasync-manager<br>chmod +x <span class="hljs-regexp">/etc/i</span>nit.d/tunasync-worker<br></code></pre></td></tr></table></figure><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">/etc/init.d/tuna<span class="hljs-built_in">sync-manager</span> <span class="hljs-built_in">start</span><br>/etc/init.d/tuna<span class="hljs-built_in">sync-worker</span> <span class="hljs-built_in">start</span><br></code></pre></td></tr></table></figure><h4 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-regexp">/etc/</span><span class="hljs-keyword">init</span>.d<span class="hljs-operator">/</span>tunasync<span class="hljs-operator">-</span>manager restart<br><span class="hljs-regexp">/etc/</span><span class="hljs-keyword">init</span>.d<span class="hljs-operator">/</span>tunasync<span class="hljs-operator">-</span>worker restart<br></code></pre></td></tr></table></figure><p>查看服务状态</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-regexp">/etc/</span><span class="hljs-keyword">init</span>.d<span class="hljs-operator">/</span>tunasync<span class="hljs-operator">-</span>manager status<br><span class="hljs-regexp">/etc/</span><span class="hljs-keyword">init</span>.d<span class="hljs-operator">/</span>tunasync<span class="hljs-operator">-</span>worker status<br></code></pre></td></tr></table></figure><p>到这里为止，自建仓库就算完成了，可以通过以下命令来查看进程</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tunasynctl</span> list -p <span class="hljs-number">12345</span> --<span class="hljs-literal">all</span><br></code></pre></td></tr></table></figure><h4 id="添加计划任务"><a href="#添加计划任务" class="headerlink" title="添加计划任务"></a>添加计划任务</h4><p>创建日志文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">touch <span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/mirrors/</span>logs/wget.log<br></code></pre></td></tr></table></figure><p> 获取任务状态信息并保存为 json 文件</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">crontab -e</span><br></code></pre></td></tr></table></figure><p>添加</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">*<span class="hljs-regexp">/1 * * * * wget -q http:/</span><span class="hljs-regexp">/127.0.0.1:12345/</span>jobs -O <span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/mirrors/</span>jobs.json -o <span class="hljs-regexp">/home/</span>www<span class="hljs-regexp">/mirrors/</span>logs/wget.log<br></code></pre></td></tr></table></figure><p>验证</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">crontab -l</span><br></code></pre></td></tr></table></figure><h4 id="安装-Caddy-Web服务器"><a href="#安装-Caddy-Web服务器" class="headerlink" title="安装 Caddy Web服务器"></a>安装 Caddy Web服务器</h4><h4 id="配置访问权限"><a href="#配置访问权限" class="headerlink" title="配置访问权限"></a>配置访问权限</h4><p>镜像目录权限设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> 755 /home/www/mirrors<br></code></pre></td></tr></table></figure><p>SELINUX权限设置(可选)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">chcon -R -t <span class="hljs-type">httpd_sys_content_t</span> /home/www/mirrors<br></code></pre></td></tr></table></figure><h4 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h4><p>如果你还没有安装 Docker，可以使用脚本安装 Docker：</p><p><a href="https://getdocker.quickso.cn/">https://getdocker.quickso.cn/</a></p><p>创建Caddy文件夹</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">mkdir -p /home/www/Caddy<br></code></pre></td></tr></table></figure><p>创建Caddyfile</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">:<span class="hljs-number">80</span> &#123;<br>    root * <span class="hljs-regexp">/usr/</span>share/caddy<br>    file_server browse<br>&#125;<br></code></pre></td></tr></table></figure><p>为了简化部署，可以使用 <code>Docker Compose</code> 来管理 Caddy 服务和配置。</p><h4 id="创建-docker-compose-yml"><a href="#创建-docker-compose-yml" class="headerlink" title="创建 docker-compose.yml"></a>创建 <code>docker-compose.yml</code></h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">caddy:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">caddy:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">caddy</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/home/www/Caddy/Caddyfile:/etc/caddy/Caddyfile</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/home/www/mirrors:/usr/share/caddy</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_data:/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">caddy_config:/config</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">caddy_data:</span><br>  <span class="hljs-attr">caddy_config:</span><br></code></pre></td></tr></table></figure><h4 id="启动-Caddy-服务"><a href="#启动-Caddy-服务" class="headerlink" title="启动 Caddy 服务"></a>启动 Caddy 服务</h4><p>运行以下命令启动 Caddy 服务：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker-compose up -d</span><br></code></pre></td></tr></table></figure><p>并根据需要补充 <code>index.html</code> 和配置的 web 文件到 <code>/mirrors</code> 目录。</p><p>网页文件可以在 <a href="https://github.com/muzihuaner/mirrors/tree/new/mirrors%E4%B8%8A%E4%B8%8B%E8%BD%BD%E4%BD%BF%E7%94%A8%EF%BC%88%E6%89%80%E6%9C%89">https://github.com/muzihuaner/mirrors/tree/new/mirrors上下载使用（所有</a> web 文件放到 <code>/mirrors</code> 目录即可）。</p><p>文件夹层级</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs axapta">.<br>└── www<br>    └── mirrors 网站根目录<br>        ├── <span class="hljs-keyword">index</span>.html 首页<br>        ├── jobs.json 状态信息<br>        ├── logs 日志<br>        ├── scripts 脚本<br>        ├── <span class="hljs-keyword">static</span> 网页静态资源<br>        ├── status 服务器状态网页目录<br></code></pre></td></tr></table></figure><p>至此，同步服务以及 web 访问服务全部搭建完成，内网的小伙伴们可以通过浏览器访问镜像站了 <a href="http://服务器ip/">http:&#x2F;&#x2F;服务器IP&#x2F;</a>。</p><h4 id="文章参考"><a href="#文章参考" class="headerlink" title="文章参考"></a>文章参考</h4><p><a href="http://weyo.me/pages/techs/how-to-make-a-mirror-site/">http://weyo.me/pages/techs/how-to-make-a-mirror-site/</a></p><p><a href="https://blog.lussac.net/archives/342/">https://blog.lussac.net/archives/342/</a></p><p><a href="https://github.com/tuna/tunasync">https://github.com/tuna/tunasync</a></p><p><a href="https://blog.whsir.com/post-5094.html">https://blog.whsir.com/post-5094.html</a></p><p><a href="https://www.shellop.com/archives/36">https://www.shellop.com/archives/36</a></p><p><a href="https://fangpsh.github.io/posts/2014/2014-01-01.html">https://fangpsh.github.io/posts/2014/2014-01-01.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;在开源软件的使用中，镜像仓库（Mirror Repository）扮演着至关重要的角色。它们为全球用户提供快速、可靠的软件下载服务。特别是在国内，由于网络限制，访问官方仓库往往较为缓慢，因此搭建一个自己的镜像仓库就显得尤为重要。而 &lt;strong&gt;&lt;a href=&quot;http</summary>
      
    
    
    
    <category term="教程" scheme="https://blog.quickso.cn/categories/%E6%95%99%E7%A8%8B/"/>
    
    
    <category term="开源" scheme="https://blog.quickso.cn/tags/%E5%BC%80%E6%BA%90/"/>
    
    <category term="tunasync" scheme="https://blog.quickso.cn/tags/tunasync/"/>
    
  </entry>
  
</feed>
